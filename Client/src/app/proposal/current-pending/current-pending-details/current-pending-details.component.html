<!-- Last updated by ARAVIND on 08-10-2020 -->
<ng-container *ngIf="_proposalService.proposalSectionConfig['316']?.isActive">
<div class="card mySkinDialog">
  <div class="card-header py-2 pr-2 pl-4">
    <h4 class="card-title align-items-center d-flex">
      <span class="pl-2 col-9">Generated Reports
        <span *ngIf="helpText?.currentAndPending && helpText?.currentAndPending['generatedReports']?.helpTextInfo" class="d-inline-block icon-hover">
            <a class="tooltip z-index-0 tooltip-helptext"><i class="fa fa-question-circle fa-med hand-cursor" aria-hidden="true"></i>
                <div class="tooltiptext-left card card-inner p-15 text-left">
                    <span class="font-cv">{{helpText?.currentAndPending['generatedReports']?.helpTextInfo}}</span>
                </div>
            </a>
        </span>
      </span>
      <span class=" ml-auto ">
        <span *ngIf="currentAndPendingDetails?.selectedPersons?.length" class="exportButton text-right">
          <span class="exportIcon-margin">Export All :</span>
          <a title="Export data to PDF document" (click)="exportAllCurrentAndPendingDetails()"
             class="exportIcon-margin  hand-cursor" id="export-prop-excel-btn" tabindex="0">
            <i aria-hidden="true" class="fa fa-file-pdf-o"></i>
          </a>
        </span>
        <button class="button-container nav-style mx-2" (click)="toggleToolkitVisibility()"
                title="{{(isPersonWidgetVisible? 'Hide Person List':'Show Person List')}}">
          <span class="fa-large fa fa-angle-double-right" *ngIf="isPersonWidgetVisible"></span>
          <span class="fa-large fa fa-angle-double-left" *ngIf="!isPersonWidgetVisible"></span>
        </button>
      </span>
            </h4>
        </div>
        <div class="card-content">
            <div *ngIf="currentAndPendingDetails?.selectedPersons?.length" class="card mySkinDialog">
                <div class="card-content pb-3">
                    <div *ngFor="let details of currentAndPendingDetails.selectedPersons;let personIndex = index"
                         class="card-body px-3 pt-3 pb-1">
                        <div id="{{details?.personId}}" class="row">
                            <div class="col-12">
                                <h4 class="card-title cp-header d-flex align-items-center px-3">
                <span class="py-1 mr-auto">
                  <label class="f-14 d-flex align-items-center flex-wrap">
                    <i aria-hidden="true" class="fa fa-user text-primary person-icon mr-4" aria-hidden="true"></i>
                    <div>
                    <span class="font-weight-bold">{{details?.personName}}</span>
                    <span class="text-info fw-500 mr-2">({{details?.roleName}})</span>
                    <span class="text-secondary d-block italian fs-12">Last Generated By
                      <span class="text-secondary  fw-600">{{details?.lastUpdatedUserFullName}}</span>
                      on {{details?.lastUpdatedTimestamp | dateFormatterWithTimeZone: 'long'}}
                    </span>
                    </div>
                  </label>
                </span>
                                    <span *ngIf="_proposalService.proposalMode == 'edit'" type="button" class="anchor-link fw-600 mr-4 fs-14 text-right" (click)="setExternalObject(details, personIndex)"
                                    >
                  <i class="fa fa-plus-circle mr-2" aria-hidden="true"></i> <ng-container i18n="@@PROPOSAL_ADD_EXTERNAL_FUNDING_SUPPORT"> Add External Funding Support</ng-container>  
                </span>
                                    <span *ngIf="_proposalService.proposalMode == 'edit'" type="button"
                                          class="anchor-link fw-600 mr-5 fs-14 text-right" [ngClass]="{'cursor-disable': !_eventService.$isGenerateOptionEnable.getValue()}">
                  <span [class.disabled]="!_eventService.$isGenerateOptionEnable.getValue()" (click)="preparePersonObject(details)"
                        data-toggle="modal" data-target="#regenerateReportModal">
                    <i class="fa fa-file-text mr-2" aria-hidden="true"></i><ng-container i18n="@@PROPOSAL_REGENERATE_REPORT">Regenerate Report</ng-container>
                  </span>
                  </span>
                                    <span class="exportButton text-right d-block d-sm-inline font-weight-normal mt-0 fs-14 mr-5">
                  <span class="exportIcon-margin">Export as :</span>
                  <a title="Export data to PDF document" class="exportIcon-margin  hand-cursor" id="export-excel-btn"
                     (click)="exportCurrentAndPendingDetails(details)" tabindex="0">
                    <i aria-hidden="true" class="fa fa-file-pdf-o"></i>
                  </a>
                </span>
                                    <button id="person-expand-btn" class="updown-arrow mr-3"
                                            (click)="isPersonViewData[personIndex] = !isPersonViewData[personIndex]">
                                        <i [ngClass]="!isPersonViewData[personIndex]?'fa fa-angle-double-up':'fa fa-angle-double-down'"
                                           class="fa-large" aria-hidden="true"></i>
                                    </button>
                                </h4>
                            </div>
                        </div>
                        <div *ngIf="!isPersonViewData[personIndex]" class="card-content">
                            <div class="row">
                                <div class="col-12 py-4 px-5">
                                    <h4 class="card-title"><ng-container i18n="@@PROPOSAL_CURRENT_AWARDS">Current Awards</ng-container>
                                        <ul class="actionButtonGroup d-inline">
                                            <li>
                                                <i class="ml-3"
                                                   [ngClass]="(isCurrentViewVisible[personIndex])?'fa fa-chevron-down':'fa fa-chevron-up '"
                                                   (click)="isCurrentViewVisible[personIndex] = !isCurrentViewVisible[personIndex]"
                                                   aria-hidden="true"></i>
                                            </li>
                                        </ul>
                                    </h4>
                                </div>
                                <div *ngIf="!isCurrentViewVisible[personIndex]" class="col-12">
                                    <div class="table-responsive ">
                                        <table *ngIf="(_proposalService.proposalMode == 'edit' &&
                  details?.currentAwards?.length) || (_proposalService.proposalMode != 'edit' &&
                  checkIncludeList(details.currentAwards))"
                                               class="table table-inner mb-0 tableSkin grid2 table-vertical-align">
                                            <caption class="sr-only"><ng-container i18n="@@PROPOSAL_CURRENT_AWARDS">Current Awards</ng-container></caption>
                                            <thead class="thead-light">
                                            <th style="width: 13%;" scope="col"><ng-container i18n="@@COMMON_SPONSOR_AWARD_NUMBER">Sponsor Award Number</ng-container></th>
                                            <th scope="col"><ng-container i18n="@@COMMON_AWARD_NUMBER">Award Number</ng-container></th>
                                            <th style="width: 13%;" scope="col">Title</th>
                                            <th style="width: 10%;" scope="col">Role Played</th>
                                            <th style="width: 13%;" *ngIf="!isPersonWidgetVisible" scope="col"><ng-container i18n="@@COMMON_SPONSOR">Sponsor</ng-container></th>
                                            <th style="width: 13%;" *ngIf="!isPersonWidgetVisible" scope="col">Lead Unit</th>
                                            <th style="width: 10%;" scope="col">Total Project Value</th>
                                            <th style="width: 11%;" scope="col">Project Period</th>
                                            <th style="width: 10%;"  scope="col">Status</th>
                                            <th *ngIf="_proposalService.proposalMode == 'edit'" scope="col">Exclude</th>
                                            <th style="width: 10%;" scope="col" class="w-10">Actions</th>
                                            </thead>
                                            <tbody>
                                            <ng-container *ngFor="let award of details.currentAwards;let currentIndex = index">
                                                <tr id="{{award.cpReportProjectDetailId}}" *ngIf="_proposalService.proposalMode == 'edit' ||(
                          _proposalService.proposalMode != 'edit' && !award?.isExcluded)">
                                                    <td>{{award?.sponsorAwardNumber}}</td>
                                                    <td>{{!award.isManuallyAdded ? award?.moduleItemKey: 'External'}}</td>
                                                    <td>{{award?.title}}</td>
                                                    <td *ngIf="!award.isManuallyAdded">{{award?.cpReportProjectDetailExt?.proposalPersonRole?.description}}</td>
                                                    <td *ngIf="award.isManuallyAdded">{{award?.proposalPersonRole?.description}}</td>
                                                    <td *ngIf="!isPersonWidgetVisible">{{award?.sponsor?.sponsorName}}</td>
                                                    <td *ngIf="!isPersonWidgetVisible">{{award?.department}}</td>
                                                    <td *ngIf="!award.isManuallyAdded">{{award?.cpReportProjectDetailExt?.totalAwardAmount | currency: _commonService.currencyFormat}}</td>
                                                    <td *ngIf="award.isManuallyAdded">{{award?.totalAwardAmount | currency: award?.currency?.currencySymbol}}</td>
                                                    <td>{{award?.startDate | dateFormatter}}
                                                        <span *ngIf="award?.startDate && award?.endDate"> - </span>
                                                        {{award?.endDate | dateFormatter}}
                                                    </td>
                                                    <td>{{award?.moduleStatus}}</td>
                                                    <td *ngIf="_proposalService.proposalMode == 'edit'">
                                                        <a *ngIf="!award?.isExcluded">
                                                            <label class="switch toggle-inactive">
                                                                <input type="checkbox"
                                                                       (click)="excludeCurrentAndPending(award, true, 'Award', !award.isManuallyAdded ? award?.moduleItemKey: 'External')">
                                                                <span class="slider round"><small class="deactivate-text">No</small></span>
                                                            </label>
                                                        </a>
                                                        <a *ngIf="award?.isExcluded">
                                                            <label class="switch toggle-active">
                                                                <input type="checkbox"
                                                                       (click)="excludeCurrentAndPending(award, false, 'Award', !award.isManuallyAdded ? award?.moduleItemKey: 'External')"
                                                                       checked>
                                                                <span class="slider round"><small>Yes</small></span>
                                                            </label>
                                                        </a>
                                                    </td>
                                                    <td>
                                                        <ul class="actionButtonGroup">
                                                            <li *ngIf="!award.isManuallyAdded">
                                                                <a [routerLink]="['/fibi/award/overview']"
                                                                   title="Click here to view Award {{award?.moduleItemKey}}"
                                                                   [queryParams]="{ 'awardId': award?.moduleItemId }" target="_blank"
                                                                   class="hand-cursor">
                                                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                                                </a>
                                                            </li>
                                                            <li *ngIf="award.isManuallyAdded">
                                                                <a (click)="viewExternalDetails(award)"
                                                                   title="Click here to view the declaration details" class="hand-cursor">
                                                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                                                </a>
                                                            </li>
                                                            <ng-container *ngIf="award.isManuallyAdded && _proposalService.proposalMode == 'edit'">
                                                                <li>
                                                                    <a (click)="editExternalDetails(award, personIndex , currentIndex)"
                                                                       id="award-association-view-btn" class="hand-cursor">
                                                                        <i class="fa fa-pencil" title="Click here to edit the declaration details" aria-hidden="true"></i>
                                                                    </a>
                                                                </li>
                                                                <li>
                                                                    <a id="awrd-declaration-delete-btn" data-toggle="modal" data-target="#deleteSponsor" (click)="setDeleteIndex(award, personIndex , currentIndex)">
                                                                        <i class="fa fa-trash-o" aria-hidden="true" title="Click here to delete the declaration details"></i>
                                                                    </a>
                                                                </li>
                                                            </ng-container>
                                                            <li *ngIf="!award.isManuallyAdded">
                                                                <a id="current-accordian-btn" title="Additional Details" class="hand-cursor">
                                                                    <i class="f-20"
                                                                       [ngClass]="(currentAdditionalDetailsVisible[personIndex][currentIndex])?' fa fa-angle-double-up':' fa fa-angle-double-down'"
                                                                       aria-hidden="true"
                                                                       (click)="hideCurrentAdditionalDetails(personIndex, currentIndex)"></i>
                                                                </a>
                                                            </li>
                                                        </ul>
                                                    </td>
                                                </tr>
                                                <tr *ngIf="currentAdditionalDetailsVisible[personIndex][currentIndex]" [@fadeDown]>
                                                    <td colspan="11">
                                                        <app-additional-details [moduleDetails]="award" [personDetails]='personDetails'
                                                                                *ngIf="_proposalService.proposalMode == 'edit'">
                                                        </app-additional-details>
                                                        <app-additional-details-view [moduleDetails]="award"
                                                                                     *ngIf="_proposalService.proposalMode != 'edit'">
                                                        </app-additional-details-view>
                                                    </td>
                                                </tr>
                                            </ng-container>
                                            </tbody>
                                        </table>
                                        <div *ngIf="!details?.currentAwards?.length || (_proposalService.proposalMode != 'edit' &&
                  !checkIncludeList(details.currentAwards))" class="noDataExists px-4">
                                            <ng-container i18n="@@PROPOSAL_NO_CURRENT_AWARDS_ERR">There are no current awards for this user.</ng-container></div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12  py-4 px-5">
                                    <h4 class="card-title">Pending Proposals
                                        <ul class="actionButtonGroup d-inline">
                                            <li>
                                                <i class="ml-3"
                                                   [ngClass]="(isPendingViewVisible[personIndex])?'fa fa-chevron-down':'fa fa-chevron-up '"
                                                   (click)="isPendingViewVisible[personIndex] = !isPendingViewVisible[personIndex]"
                                                   aria-hidden="true"></i>
                                            </li>
                                        </ul>
                                    </h4>
                                </div>
                                <div *ngIf='!isPendingViewVisible[personIndex]' class="col-12">
                                    <div class="table-responsive ">
                                        <table *ngIf="(_proposalService.proposalMode == 'edit' &&
                   details?.pendingProposals?.length) || (_proposalService.proposalMode != 'edit' &&
                   checkIncludeList(details.pendingProposals))"
                                               class="table table-inner tableSkin grid2 table-vertical-align">
                                            <caption class="sr-only">Pending Proposals</caption>
                                            <thead class="thead-light">
                                            <th scope="col">Proposal Id</th>
                                            <th scope="col" style="width: 15%;">Title</th>
                                            <th scope="col">Role Played</th>
                                            <th style="width: 15%;" *ngIf="!isPersonWidgetVisible" scope="col"><ng-container i18n="@@COMMON_SPONSOR">Sponsor</ng-container></th>
                                            <th style="width: 15%;" *ngIf="!isPersonWidgetVisible" scope="col">Lead Unit</th>
                                            <th scope="col">Total Project Value</th>
                                            <th scope="col">Project Period</th>
                                            <th style="width: 10%;"  scope="col">Status</th>
                                            <th *ngIf="_proposalService.proposalMode == 'edit'" scope="col">Exclude</th>
                                            <th style="width: 10%;" scope="col" class="w-10">Actions</th>
                                            </thead>
                                            <tbody>
                                            <ng-container *ngFor="let proposal of details.pendingProposals;let pendingIndex = index">
                                                <tr id="{{proposal.cpReportProjectDetailId}}" *ngIf="_proposalService.proposalMode == 'edit' ||(
                          _proposalService.proposalMode != 'edit' && !proposal?.isExcluded)">
                                                    <td>{{!proposal.isManuallyAdded ? proposal?.moduleItemId: 'External'}}</td>
                                                    <td>{{proposal?.title}}</td>
                                                    <td *ngIf="!proposal.isManuallyAdded">{{proposal?.cpReportProjectDetailExt?.proposalPersonRole?.description}}</td>
                                                    <td *ngIf="proposal.isManuallyAdded">{{proposal?.proposalPersonRole?.description}}</td>
                                                    <td *ngIf="!isPersonWidgetVisible">{{proposal?.sponsor?.sponsorName}}</td>
                                                    <td *ngIf="!isPersonWidgetVisible">{{proposal?.department}}</td>
                                                    <td *ngIf="!proposal.isManuallyAdded">{{proposal?.cpReportProjectDetailExt?.totalAwardAmount | currency: _commonService.currencyFormat}}</td>
                                                    <td *ngIf="proposal.isManuallyAdded">{{proposal?.totalAwardAmount | currency: proposal?.currency?.currencySymbol}}</td>
                                                    <td>
                                                        {{proposal?.startDate | dateFormatter}}
                                                        <span *ngIf="proposal?.startDate && proposal?.endDate"> - </span>
                                                        {{proposal?.endDate | dateFormatter}}
                                                    </td>
                                                    <td>{{proposal?.moduleStatus}}</td>
                                                    <td *ngIf="_proposalService.proposalMode == 'edit'">
                                                        <a *ngIf="!proposal?.isExcluded">
                                                            <label class="switch toggle-inactive">
                                                                <input type="checkbox"
                                                                       (click)="excludeCurrentAndPending(proposal, true, 'Proposal', !proposal.isManuallyAdded ? proposal?.moduleItemId: 'External')">
                                                                <span class="slider round"><small class="deactivate-text">No</small></span>
                                                            </label>
                                                        </a>
                                                        <a *ngIf="proposal?.isExcluded">
                                                            <label class="switch toggle-active">
                                                                <input type="checkbox"
                                                                       (click)="excludeCurrentAndPending(proposal, false, 'Proposal', !proposal.isManuallyAdded ? proposal?.moduleItemId: 'External')"
                                                                       checked>
                                                                <span class="slider round"><small>Yes</small></span>
                                                            </label>
                                                        </a>
                                                    </td>
                                                    <td>
                                                        <ul class="actionButtonGroup">
                                                            <li *ngIf="!proposal.isManuallyAdded">
                                                                <a (click)="viewProposalById(proposal?.moduleItemId) "
                                                                   title="Click here to view Proposal {{proposal?.moduleItemId}}" class="hand-cursor">
                                                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                                                </a>
                                                            </li>
                                                            <li *ngIf="proposal.isManuallyAdded">
                                                                <a (click)="viewExternalDetails(proposal)"
                                                                   title="Click here to view the declaration details" class="hand-cursor">
                                                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                                                </a>
                                                            </li>
                                                            <ng-container *ngIf="proposal.isManuallyAdded && _proposalService.proposalMode == 'edit'">
                                                                <li>
                                                                    <a (click)="editExternalDetails(proposal, personIndex ,pendingIndex)"
                                                                       id="award-association-view-btn" class="hand-cursor">
                                                                        <i class="fa fa-pencil" title="Click here to edit the declaration details" aria-hidden="true"></i>
                                                                    </a>
                                                                </li>
                                                                <li>
                                                                    <a id="prop-declaration-delete-btn" data-toggle="modal" data-target="#deleteSponsor" (click)="setDeleteIndex(proposal, personIndex , pendingIndex)">
                                                                        <i class="fa fa-trash-o" aria-hidden="true" title="Click here to delete the declaration details"></i>
                                                                    </a>
                                                                </li>
                                                            </ng-container>
                                                            <li *ngIf="!proposal.isManuallyAdded">
                                                                <a id="pending-accordian-btn" title="Additional Details" class="hand-cursor">
                                                                    <i class="f-20"
                                                                       [ngClass]="(pendingAdditionalDetailsVisible[personIndex][pendingIndex])?' fa fa-angle-double-up':' fa fa-angle-double-down'"
                                                                       aria-hidden="true"
                                                                       (click)="hidePendingAdditionalDetails(personIndex,pendingIndex)"></i>
                                                                </a>
                                                            </li>
                                                        </ul>
                                                    </td>
                                                </tr>
                                                <tr *ngIf="pendingAdditionalDetailsVisible[personIndex][pendingIndex]" [@fadeDown]>
                                                    <td colspan="10">
                                                        <app-additional-details [moduleDetails]="proposal" [personDetails]='personDetails'
                                                                                *ngIf="_proposalService.proposalMode == 'edit'">
                                                        </app-additional-details>
                                                        <app-additional-details-view [moduleDetails]="proposal"
                                                                                     *ngIf="_proposalService.proposalMode != 'edit'">
                                                        </app-additional-details-view>
                                                    </td>
                                                </tr>
                                            </ng-container>
                                            </tbody>
                                        </table>
                                        <div *ngIf="!details?.pendingProposals?.length || (_proposalService.proposalMode != 'edit' &&
                   !checkIncludeList(details.pendingProposals))" class="noDataExists px-4">
                                            There are no pending proposals for this user.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div *ngIf="!currentAndPendingDetails?.selectedPersons?.length"
                 class="d-flex align-items-center justify-content-center height-adjust">
                <div class="no-data-container">
        <span class="no-data-icon-outer">
          <div class="no-data-icon">
            <i class="fa fa-file-o" aria-hidden="true"></i>
            <i class="fa fa-times-circle-o" aria-hidden="true"></i>
          </div>
        </span>
                    <h4>There is no information in this section.</h4>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade show mySkinDialog" tabindex="-1" id="regenerateReportModal" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Regenerate</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to regenerate this report?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                    <button (click)="fetchCurrentAndPendingDetails([this.tempPersonDetails]);" type="button"
                            class="btn btn-primary-sub" data-dismiss="modal">Yes</button>
                </div>
            </div>
        </div>
    </div>
    <!-- DELETE SPONSOR WARNING MODAL -->
    <div class="modal fade mySkinDialog modal-opacity" tabindex="-1" id="deleteSponsor" role="dialog" aria-labelledby="deleteModalTitle"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Delete</h5>
                    <button type="button" class="close" id="prop-dlt-sponsor-dismiss" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this item?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="prop-dlt-sponsor-no-btn" data-dismiss="modal">No</button>
                    <button type="button" class="btn btn-primary-sub btn-sm" id="prop-dlt-sponsor-yes-btn" (click)="deleteSponsor()" data-dismiss="modal">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <app-declaration-section (externalResponse)='updateExternalDetails($event)' [sponsorObject]='sponsorObject'  [personDetails]='personDetails'></app-declaration-section>
    <app-declaration-view [externalProjectDetails]="sponsorObject"></app-declaration-view>
</ng-container>
