<!-- last updated by Ramlekshmy on 13-02-2020 -->
<!--Adds area of research-->
<div class="card" *ngIf="researchType" [class.input-field__modified]="hasUnsavedChanges"
    style="z-index: 1;">
    <div class="card-header px-4" [class.pb-0]="hasUnsavedChanges">
        <h4 class="card-title" id="proposal-research-area-edit-details">
            <ng-container i18n="@@COMMON_AREA_OF_RESEARCH/SOCIETAL_CHALLENGE_AREA">Area of Research/Societal Challenge
                Area</ng-container>
            <span *ngIf="helpText?.areaOfResearch?.helpTextInfo" class="d-inline-block icon-hover">
                <a class="tooltip z-index-0 tooltip-helptext"><i class="fa fa-question-circle fa-med hand-cursor"
                        aria-hidden="true"></i>
                    <div class="tooltiptext-left card card-inner p-15 text-left">
                        <span class="font-cv">{{helpText?.areaOfResearch?.helpTextInfo}}</span>
                    </div>
                </a>
            </span>
            <button id="area-of-research-expnd-btn" class="updown-arrow"
                (click)="dataVisibilityObj.isAreaOfResearchWidgetOpen = !dataVisibilityObj.isAreaOfResearchWidgetOpen">
                <i [ngClass]="dataVisibilityObj.isAreaOfResearchWidgetOpen?'fa fa-angle-double-up':'fa fa-angle-double-down'"
                    aria-hidden="true" class="fa-large"></i>
            </button>
        </h4>
        <app-unsaved-change-warning [hasUnsavedChanges]="hasUnsavedChanges"
            [buttonName]="isEditAreaOfResearch?'Update Area':'Add Area'">
        </app-unsaved-change-warning>
    </div>
    <div class="card-content" *ngIf="dataVisibilityObj.isAreaOfResearchWidgetOpen">
        <div class="card-body" [class.pb-0]="!hasUnsavedChanges">
            <div class="form-row">
                <div class="col-lg-2 col-sm-4 col-10">
                    <label for="prop-area-of-research-type">Type</label>
                    <select class="form-control" id="prop-area-of-research-type"
                        [(ngModel)]="researchType" (change)="researchTypeChange()">
                        <option *ngFor="let type of result?.researchTypes" [hidden]="type.isActive != true"
                            [value]="type.researchTypeCode">
                            {{type.description}}</option>
                    </select>
                </div>
                <div class="col-lg-5 col-sm-8 col-12">
                    <label>
                        <span class="mandatory">*</span>Area:
                    </label>
                    <div class="searchBox">
                        <app-endpoint-search [isError]="isError" id="prop-area-of-research"
                            [clearField]="clearAreaField" [httpOptions]="areaHttpOptions"
                            [placeHolder]="'Type here for Area'" (onSelect)="researchAreaSelectedFunction($event)"
                            [searchOnFocus]=true></app-endpoint-search>
                        <div class="invalid-feedback d-block" *ngIf="researchWarningMsg != null">
                            {{researchWarningMsg}}</div>
                    </div>
                </div>
                <div class="col-lg-5 col-12">
                    <label class="margin-left-label">
                        Sub-Area</label>
                    <app-endpoint-search id="prop-sub-area-of-research" [clearField]="clearSubAreaField"
                        [httpOptions]="subAreaHttpOptions" [placeHolder]="'Type here for Sub-Area'"
                        (onSelect)="researchSubAreaSelectedFunction($event)" [searchOnFocus]=true></app-endpoint-search>
                </div>
                <div class="col-12 text-center text-md-right">
                    <button id="prop-cancel-area-of-research-btn"
                        class="d-inline-block btn btn-secondary btn-xs mr-sm-2" (click)="resetAreaOfResearch()"
                        *ngIf="isEditAreaOfResearch || hasUnsavedChanges">Cancel</button>
                    <button class="btn btn-primary-sub btn-xs" id="prop-add-area-of-research-btn"
                        *ngIf="!isEditAreaOfResearch" (click)="validateAndSetReqObject()"
                        [class.input-field__modified]="hasUnsavedChanges">Add Area
                    </button>
                    <button *ngIf="isEditAreaOfResearch" class="btn btn-primary-sub btn-xs" title="Update Area"
                        id="prop-edit-area-of-research-btn" (click)="validateAndSetReqObject()"
                        [class.input-field__modified]="hasUnsavedChanges">Update Area</button>
                </div>
            </div>
            <table class="table tableSkin grid2 mt-2" aria-describedby="proposal-research-area-edit-details"
                *ngIf="dataVisibilityObj.isAreaOfResearchWidgetOpen && result?.proposalResearchAreas?.length > 0">
                <caption class="sr-only">Area of Research/Societal Challenge Area</caption>
                <thead class="thead-light">
                    <th scope="col">Type</th>
                    <th scope="col">Area</th>
                    <th scope="col">Sub-Area</th>
                    <th scope="col">Actions</th>
                </thead>
                <tbody>
                    <tr *ngFor="let researchArea of result?.proposalResearchAreas;let i = index;">
                        <td>{{researchArea?.researchType?.description}}</td>
                        <td>{{researchArea?.researchTypeArea?.description}}</td>
                        <td *ngIf="researchArea?.researchTypeSubArea?.description">
                            {{researchArea?.researchTypeSubArea?.description}}</td>
                        <td *ngIf="!researchArea?.researchTypeSubArea?.description"><span class="noDataExists">No
                                subarea selected</span></td>
                        <td>
                            <ul class="actionButtonGroup">
                                <li>
                                    <a id="prop-area-of-research-edit-btn">
                                        <i class="fa fa-pencil" aria-hidden="true"
                                            (click)="isEditAreaOfResearch = true;editAreaOfResearch(i)"
                                            title="Edit this Research Area"></i>
                                    </a>
                                </li>
                                <li><a href="#" id="prop-area-of-research-delete-btn" data-toggle="modal"
                                        *ngIf="!isEditAreaOfResearch || (isEditAreaOfResearch && editIndex !== i)"
                                        data-target="#deleteResearchArea"
                                        (click)="temporarySaveAreaOfResearch($event,researchArea)"><i
                                            class="fa fa-trash-o" aria-hidden="true"
                                            title="{{researchArea?.researchTypeCode == 1? 'Remove this Research Area' : 'Remove this Societal Challenge Area'}}"></i>
                                    </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<div class="bg-white card mb-3 px-2 pt-3" *ngIf="dataVisibilityObj.isMoreInfoWdgtOpen">
    <h4 class="card-title pb-3 f-13 px-3" id="area-more-information">More Information</h4>
    <div class="media-card gridSkin p-2 m-0">
        <div class="row">
            <div class="col-12">
                <label>
                    <ng-container i18n="@@COMMON_STUDY_SOCIETAL_CHALLENGE_DESCRIPTION_ERR">Elaborate on how the proposed
                        study may contribute to the Societal Challenge and/or
                        Research Area</ng-container>
                </label>
                <textarea id="prop-area-of-research-desc" name="description" autocomplete="off"
                    [(ngModel)]="result.proposal.researchDescription" class="form-control"
                    (ngModelChange)="dataVisibilityObj.dataChangeFlag = true;setUnsavedChanges(true, true)"
                    appLengthValidator [isShowLimiter]='true' [limit]=4000
                    i18n-placeholder='@@COMMON_STUDY_SOCIETAL_CHALLENGE_DESCRIPTION_PLHDR'
                    placeholder="Elaborate on how the proposed study may contribute to the Societal Challenge and/or Research Area"></textarea>
            </div>
            <div class="col-12">
                <label>Indicate if the application is a multi-disciplinary project and elaborate</label>
                <textarea id="prop-area-of-research-milti-desc" name="areadescription" autocomplete="off"
                    (ngModelChange)="dataVisibilityObj.dataChangeFlag = true;setUnsavedChanges(true, true)"
                    [(ngModel)]="result.proposal.multiDisciplinaryDescription" class="form-control" appLengthValidator
                    [isShowLimiter]='true' [limit]=4000
                    placeholder="Indicate if the application is a multi-disciplinary project and elaborate"></textarea>
            </div>
        </div>
    </div>
</div>

<!-- DELETE RESEARCH AREA WARNING MODAL -->
<div class="modal fade mySkinDialog" tabindex="-1" id="deleteResearchArea" tabindex="-1" role="dialog"
    aria-labelledby="deleteModalTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete</h5>
                <button type="button" id="prop-area-of-research-dismiss" class="close" data-dismiss="modal"
                    aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this item?</p>
            </div>
            <div class="modal-footer">
                <button type="button" id="prop-area-of-research-close-btn" class="btn btn-secondary"
                    data-dismiss="modal">No</button>
                <button type="button" id="prop-area-of-research-delete" class="btn btn-primary-sub btn-sm"
                    (click)="deleteAreaOfResearch()" data-dismiss="modal">Delete</button>
            </div>
        </div>
    </div>
</div>
