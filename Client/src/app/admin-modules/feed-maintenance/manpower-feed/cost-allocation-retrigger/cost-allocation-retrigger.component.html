<div class="card mb-3">
  <div class="card-content">
    <div class="card-body">
      <div class="form-row">
        <div class="col">
          <label class="d-block">From</label>
          <span class="dateField">
            <input matInput [matDatepicker]="startDate" placeholder="From {{datePlaceHolder}}" id="position-retrigger-start-date"
              class="form-control d-inline-block" autocomplete="off"
              [(ngModel)]="searchObject.startDate" (keypress)="_commonService._keyPress($event, 'date');"
              (click)="startDate.open()">
            <i aria-hidden="true" id="start-date-icon" class="fa fa-calendar fa-large insidePicker hand-cursor"
              (click)="startDate.open()"></i>
            <mat-datepicker #startDate (opened)="setFocusToElement('position-retrigger-start-date')">
            </mat-datepicker>
          </span>
        </div>
        <label class="d-none d-sm-inline-block p-2 mt-4 pt-3">-</label>
        <div class="col">
          <label class="d-block">To</label>
          <span class="dateField">
            <input matInput [matDatepicker]="endDate" placeholder="To {{datePlaceHolder}}" id="position-retrigger-end-date"
              class="form-control d-inline-block" autocomplete="off"
              [(ngModel)]="searchObject.endDate" (keypress)="_commonService._keyPress($event, 'date');"
              (click)="endDate.open()">
            <i aria-hidden="true" id="end-date-icon" class="fa fa-calendar fa-large insidePicker hand-cursor"
              (click)="endDate.open()"></i>
            <mat-datepicker #endDate (opened)="setFocusToElement('position-retrigger-end-date')">
            </mat-datepicker>
          </span>
        </div>
        <div class="col">
          <label class="d-block">Resource Name</label>
          <app-elastic [options]="personElasticOptions" [placeHolder]="'Type here for an resource name'"
            [clearField]="clearField" (selectedResult)="setPersonDetails($event)">
          </app-elastic>
        </div>
        <div class="col">
          <label class="d-block">L2 WBS</label>
          <input type="text" class="form-control" [(ngModel)]="searchObject.budgetReferenceNumber"
            id="position-retrigger-award-number" placeholder="Enter L2 WBS"
            (keyup.enter)="getCostAllocationTriggerDetails(1,'A')">
        </div>
        <div class="col-auto align-self-end">
          <button class="btn btn-secondary" (click)="clearSearch();getCostAllocationTriggerDetails()">Clear</button>
          <button class="btn btn-primary btn-sm btn-xs" (click)="getCostAllocationTriggerDetails(1,'A')">Search</button>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="card mt-3">
  <div class="font-bold px-4 pt-3">
    <label>List of Manpower Cost Allocation Errors</label>
  </div>
  <div *ngIf="allocationRetriggerList?.workdayInterfaceLogDtos?.length" class="table-responsive p-3">
    <table class="table tableSkin mb-0">
      <caption class="sr-only">Feed List</caption>
      <thead class="header-border">
        <th scope="col" (click)="sortResult('personId')" class="hand-cursor">Person Id
          <i aria-hidden="true" [ngClass]="((searchObject.sortBy == 'personId')  ? (!isDesc ? 'fa fa-sort-numeric-desc sortIcon' :
          'fa fa-sort-numeric-asc sortIcon') : 'fa fa-sort-numeric-asc blrcolor')">
          </i>
        </th>
        <th scope="col" style="width: 15%" (click)="sortResult('resourceName')" class="hand-cursor">Resource Name
          <i aria-hidden="true" [ngClass]="((searchObject.sortBy == 'resourceName')  ? (!isDesc ? 'fa fa-sort-alpha-desc sortIcon' :
          'fa fa-sort-alpha-asc sortIcon') : 'fa fa-sort-alpha-asc blrcolor')">
          </i>
        </th>
        <th scope="col" style="width: 10%" (click)="sortResult('budgetReferenceNumber')" class="hand-cursor">L2 WBS
          <i aria-hidden="true" [ngClass]="((searchObject.sortBy == 'budgetReferenceNumber')  ? (!isDesc ? 'fa fa-sort-numeric-desc sortIcon' :
          'fa fa-sort-numeric-asc sortIcon') : 'fa fa-sort-numeric-asc blrcolor')">
          </i>
        </th>
        <th scope="col" (click)="sortResult('chargeStartDate')" class="hand-cursor">Charge Start Date
          <i aria-hidden="true" [ngClass]="((searchObject.sortBy == 'chargeStartDate')  ? (!isDesc ? 'fa fa-sort-numeric-desc sortIcon' :
          'fa fa-sort-numeric-asc sortIcon') : 'fa fa-sort-numeric-asc blrcolor')">
          </i>
        </th>
        <th scope="col" (click)="sortResult('chargeEndDate')" class="hand-cursor">Charge End Date
          <i aria-hidden="true" [ngClass]="((searchObject.sortBy == 'chargeEndDate')  ? (!isDesc ? 'fa fa-sort-numeric-desc sortIcon' :
          'fa fa-sort-numeric-asc sortIcon') : 'fa fa-sort-numeric-asc blrcolor')">
          </i>
        </th>
        <th scope="col" (click)="sortResult('costAllocation')" class="hand-cursor">Cost Allocation
          <i aria-hidden="true" [ngClass]="((searchObject.sortBy == 'costAllocation')  ? (!isDesc ? 'fa fa-sort-numeric-desc sortIcon' :
          'fa fa-sort-numeric-asc sortIcon') : 'fa fa-sort-numeric-asc blrcolor')">
          </i>
        </th>
        <th scope="col" (click)="sortResult('jobProfileType')" class="hand-cursor">Job Profile
          <i aria-hidden="true" [ngClass]="((searchObject.sortBy == 'jobProfileType')  ? (!isDesc ? 'fa fa-sort-alpha-desc sortIcon' :
          'fa fa-sort-alpha-asc sortIcon') : 'fa fa-sort-alpha-asc blrcolor')">
          </i>
        </th>
        <th scope="col" (click)="sortResult('positionStatus')" class="hand-cursor">Position Status
          <i aria-hidden="true" [ngClass]="((searchObject.sortBy == 'positionStatus')  ? (!isDesc ? 'fa fa-sort-alpha-desc sortIcon' :
          'fa fa-sort-alpha-asc sortIcon') : 'fa fa-sort-alpha-asc blrcolor')">
          </i>
        </th>
        <th scope="col" (click)="sortResult('interfaceStatus')" class="hand-cursor">Interface Status
          <i aria-hidden="true" [ngClass]="((searchObject.sortBy == 'interfaceStatus')  ? (!isDesc ? 'fa fa-sort-alpha-desc sortIcon' :
          'fa fa-sort-alpha-asc sortIcon') : 'fa fa-sort-alpha-asc blrcolor')">
          </i>
        </th>
        <th scope="col" style="width: 15%">Action</th>
      </thead>
      <tbody>
        <ng-container
          *ngFor="let person of allocationRetriggerList?.workdayInterfaceLogDtos; let positionIndex = index">
          <tr [ngClass]="isFeedExpand && isFeedExpand[positionIndex] ? 'borderBoxHeading' : ''">
            <td>{{person?.personId}}</td>
            <td>{{person?.resourceName}}</td>
            <td>{{person?.budgetReferenceNumber}}</td>
            <td>{{(person?.chargeStartDate ? person?.chargeStartDate :
              person?.planStartDate) | dateFormatter}}</td>
            <td>{{(person?.chargeEndDate ? person?.chargeEndDate :
              person?.planEndDate) | dateFormatter}}</td>
            <td>{{person?.costAllocation}}</td>
            <td>{{person?.jobProfileType}}</td>
            <td>{{person?.positionStatus}}</td>
            <td>{{person?.interfaceStatusName}}</td>
            <td class="text-right">
              <div class="dropdown ml-3 d-inline mr-2" *ngIf="person?.comments">
                <a class="position-relative" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
                  aria-expanded="false">
                  <i class="fa fa-commenting-o hand-cursor hoverColor" aria-hidden="true" title="Comments"></i>
                  <div class="dropdown-menu details-comment-patch dropdown-menu-right fs-14"
                    aria-labelledby="dropdownMenuLink">
                    <div>
                      {{person?.comments}}
                    </div>
                  </div>
                </a>
              </div>
              <button *ngIf="person?.interfaceStatusCode == '2' && !person?.userActionCode"
                class="btn btn-outline-primary" (click)="manualUpdateIndex = positionIndex;callSyncAPI(person, '2')">
                Manual Process
              </button>
              <button *ngIf="person?.interfaceStatusCode == '2' && !person?.userActionCode"
                class="btn btn-outline-success" (click)="callSyncAPI(person, '1')">
                Re-trigger
              </button>
              <button class="updown-arrow position-static" id="sap-batch-details-expand-btn" (click)="isFeedExpand[positionIndex] = !isFeedExpand[positionIndex];
                              getCurrentCostAllocationDetails(person?.personId, positionIndex, person?.resourceUniqueId)">
                <i aria-hidden="true" class="fa-large fa"
                  [ngClass]="isFeedExpand[positionIndex] ? 'fa-angle-up' : 'fa-angle-down'"></i>
              </button>
            </td>
          </tr>
          <tr *ngIf="isFeedExpand[positionIndex]">
            <td colspan="100%">
              <table class="table tableSkin mb-0 card-inner mr-4">
                <caption class="sr-only">Information</caption>
                <thead>
                  <th scope="col">Award #</th>
                  <th scope="col" style="width: 10%">L2 WBS</th>
                  <th scope="col">Position Owned by Award</th>
                  <th scope="col">Charge Start Date</th>
                  <th scope="col">Charge End Date</th>
                  <th scope="col">Cost Allocation</th>
                  <th scope="col">Job Profile</th>
                  <th scope="col">Position Status</th>
                </thead>
                <tbody>
                  <ng-container *ngIf="previousCostAllocations[positionIndex]?.length">
                    <tr *ngFor="let costAllocation of previousCostAllocations[positionIndex]">
                      <td>{{costAllocation?.awardNumber}}</td>
                      <td>{{costAllocation?.budgetReferenceNumber}}</td>
                      <td>{{costAllocation?.positionOwnedByAward == 'Y' ? 'True' : 'False'}}</td>
                      <td>{{costAllocation?.chargeStartDate | dateFormatter}}</td>
                      <td>{{costAllocation?.chargeEndDate | dateFormatter}}</td>
                      <td>{{costAllocation?.costAllocation}}</td>
                      <td>{{costAllocation?.jobProfileType}}</td>
                      <td>{{costAllocation?.positionStatus}}</td>
                    </tr>
                  </ng-container>
                  <tr *ngIf="!previousCostAllocations[positionIndex]?.length">
                    <td colspan="100%" class="text-center">
                      <span class="noDataExists">No Interface Data Available</span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
      <nav class="pagination justify-content-end">
        <app-pagination [totalCount]="allocationRetriggerList?.pageCount"
          (pageChangeEvent)="getCostAllocationTriggerDetails($event, allocationRetriggerList?.advancedSearch)">
        </app-pagination>
      </nav>
    </div>
  </div>
  <!-- No data container -->
  <div *ngIf="!allocationRetriggerList?.workdayInterfaceLogDtos?.length" class="no-data-container">
    <span class="no-data-icon-outer">
      <div class="no-data-icon">
        <i class="fa fa-file-o" aria-hidden="true"></i>
        <i class="fa fa-times-circle-o" aria-hidden="true"></i>
      </div>
    </span>
    <h4>There is no information in this section.</h4>
  </div>
</div>
<!-- Confirmation modal -->
<div class="modal fade mySkinDialog" tabindex="-1" id="syncCostAllocationAPI" tabindex="-1" role="dialog"
  data-backdrop="static" data-keyboard="false" aria-labelledby="positionRetriggerConfirmation" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{userAction?.manpowerUserAction}}
          {{retriggerObject?.manpowerInterfaceType?.description}}
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div *ngIf="userAction?.description"
          class="success-banner px-3 d-flex justify-content-between align-items-center ng-star-inserted">
          <div>
            <i aria-hidden="true" class="fa fa-info-circle mr-1 info-icon"></i>
            <em class="ng-star-inserted"> {{userAction?.description}}</em>
          </div>
          <button aria-label="Close" class="close close-button" type="button">
          </button>
        </div>
        <ng-container>
          <label class="d-block"><span class="mandatory">*</span>Comments</label>
          <textarea class="form-control" [(ngModel)]="actionComment" placeholder="Comments"></textarea>
          <span class="mandatory" *ngIf="validationMap.has('comment')">*
            {{validationMap.get('comment')}}</span>
        </ng-container>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary-sub btn-sm" (click)="userAction?.manpowerUserActionCode == '1' ?
        retriggerWorkdayApi() : updateManpowerInterfaceManually()">
          {{userAction?.manpowerUserAction}} {{retriggerObject?.manpowerInterfaceType?.description}}</button>
      </div>
    </div>
  </div>
</div>
