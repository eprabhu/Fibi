<div class="card mb-3">
    <div class="card-content">
        <div class="card-body">
            <div class="form-row">
                <div class="col">
                    <label class="d-block">From</label>
                    <span class="dateField">
                        <input matInput [matDatepicker]="startDate" placeholder="From {{datePlaceHolder}}" id="position-retrigger-start-date"
                            class="form-control d-inline-block" autocomplete="off"
                            [(ngModel)]="searchObject.startDate" (keypress)="_commonService._keyPress($event, 'date');"
                            (click)="startDate.open()">
                        <i aria-hidden="true" id="start-date-icon"
                            class="fa fa-calendar fa-large insidePicker hand-cursor"
                            (click)="startDate.open()"></i>
                        <mat-datepicker #startDate (opened)="setFocusToElement('position-retrigger-start-date')"></mat-datepicker>
                    </span>
                </div>
                <label class="d-none d-sm-inline-block p-2 mt-4 pt-3">-</label>
                <div class="col">
                    <label class="d-block">To</label>
                    <span class="dateField">
                        <input matInput [matDatepicker]="endDate" placeholder="To {{datePlaceHolder}}" id="position-retrigger-end-date"
                            class="form-control d-inline-block" autocomplete="off"
                            [(ngModel)]="searchObject.endDate" (keypress)="_commonService._keyPress($event, 'date');"
                            (click)="endDate.open()" />
                        <i aria-hidden="true" id="end-date-icon"
                            class="fa fa-calendar fa-large insidePicker hand-cursor" (click)="endDate.open()"></i>
                        <mat-datepicker #endDate (opened)="setFocusToElement('position-retrigger-end-date')"></mat-datepicker>
                    </span>
                </div>
                <div class="col">
                    <label class="d-block">Award #</label>
                    <input type="text" class="form-control" [(ngModel)]="searchObject.awardNumber"
                        id="position-retrigger-award-number" placeholder="Type here for award"
                        (keyup.enter)="fetchPositionRetriggerList(1, 'A')">
                </div>
                <div class="col">
                    <label class="d-block">Position Id</label>
                    <input type="text" class="form-control" [(ngModel)]="searchObject.positionId"
                        id="position-retrigger-position-id" placeholder="Type here for position id"
                        (keyup.enter)="fetchPositionRetriggerList(1, 'A')">
                </div>
                <div class="col-auto align-self-end">
                    <button class="btn btn-secondary"
                        (click)="clearSearch();fetchPositionRetriggerList()">Clear</button>
                    <button class="btn btn-primary btn-sm btn-xs"
                        (click)="fetchPositionRetriggerList(1, 'A')">Search</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card mt-3">
    <div class="font-bold px-4 pt-3">
        <label>List of Manpower Position Errors</label>
    </div>

    <div *ngIf="positionRetriggerList?.workdayInterfaceLogDtos?.length" class="table-responsive p-3">
        <table class="table tableSkin mb-0">
            <caption class="sr-only">Feed List</caption>
            <thead class="header-border">
                <th scope="col" (click)="sortResult('positionId')" class="hand-cursor">Position ID
                    <i aria-hidden="true" [ngClass]="((searchObject.sortBy == 'positionId')  ? (!isDesc ? 'fa fa-sort-numeric-desc sortIcon' :
                    'fa fa-sort-numeric-asc sortIcon') : 'fa fa-sort-numeric-asc blrcolor')">
                    </i>
                </th>
                <th scope="col" (click)="sortResult('awardNumber')" class="hand-cursor">Award #
                    <i aria-hidden="true" [ngClass]="((searchObject.sortBy == 'awardNumber')  ? (!isDesc ? 'fa fa-sort-numeric-desc sortIcon' :
                    'fa fa-sort-numeric-asc sortIcon') : 'fa fa-sort-numeric-asc blrcolor')">
                    </i>
                </th>
                <th scope="col" (click)="sortResult('resourceName')" class="hand-cursor">Resource Name
                    <i aria-hidden="true" [ngClass]="((searchObject.sortBy == 'resourceName')  ? (!isDesc ? 'fa fa-sort-alpha-desc sortIcon' :
                    'fa fa-sort-alpha-asc sortIcon') : 'fa fa-sort-alpha-asc blrcolor')">
                    </i>
                </th>
                <th scope="col" (click)="sortResult('chargeStartDate')" class="hand-cursor">Charge Start Date
                    <i aria-hidden="true" [ngClass]="((searchObject.sortBy == 'chargeStartDate')  ? (!isDesc ? 'fa fa-sort-numeric-desc sortIcon' :
                    'fa fa-sort-numeric-asc sortIcon') : 'fa fa-sort-numeric-asc blrcolor')">
                    </i>
                </th>
                <th scope="col" (click)="sortResult('jobProfile')" class="hand-cursor">Job Profile
                    <i aria-hidden="true" [ngClass]="((searchObject.sortBy == 'jobProfile')  ? (!isDesc ? 'fa fa-sort-alpha-desc sortIcon' :
                    'fa fa-sort-alpha-asc sortIcon') : 'fa fa-sort-alpha-asc blrcolor')">
                    </i>
                </th>
                <th scope="col" (click)="sortResult('positionStatus')" class="hand-cursor">Position Status
                    <i aria-hidden="true" [ngClass]="((searchObject.sortBy == 'positionStatus')  ? (!isDesc ? 'fa fa-sort-alpha-desc sortIcon' :
                    'fa fa-sort-alpha-asc sortIcon') : 'fa fa-sort-alpha-asc blrcolor')">
                    </i>
                </th>
                <th scope="col" (click)="sortResult('interfaceStatus')" class="hand-cursor">Interface Status
                    <i aria-hidden="true" [ngClass]="((searchObject.sortBy == 'interfaceStatus')  ? (!isDesc ? 'fa fa-sort-alpha-desc sortIcon' :
                    'fa fa-sort-alpha-asc sortIcon') : 'fa fa-sort-alpha-asc blrcolor')">
                    </i>
                </th>
                <th scope="col" style="width: 3%"></th>
            </thead>
            <tbody>
                <ng-container
                    *ngFor="let position of positionRetriggerList?.workdayInterfaceLogDtos; let positionIndex = index">
                    <tr [ngClass]="isFeedExpand && isFeedExpand[positionIndex] ? 'borderBoxHeading' : ''">
                        <td>{{position?.positionId}}</td>
                        <td>{{position?.awardNumber}}</td>
                        <td>{{position?.resourceName}}</td>
                        <td>{{position?.chargeStartDate | dateFormatter}}</td>
                        <td>{{position?.jobProfileType}}</td>
                        <td>{{position?.positionStatus}}</td>
                        <td>{{position?.interfaceStatusName}}</td>
                        <td class="text-right">
                            <button class="updown-arrow position-static" id="sap-batch-details-expand-btn" (click)="isFeedExpand[positionIndex] = !isFeedExpand[positionIndex];
                                fetchPositionErrors(position?.resourceUniqueId, positionIndex)">
                                <i aria-hidden="true" class="fa-large fa"
                                    [ngClass]="isFeedExpand[positionIndex] ? 'fa-angle-up' : 'fa-angle-down'"></i>
                            </button>
                        </td>
                    </tr>
                    <tr *ngIf="isFeedExpand[positionIndex]">
                        <td colspan="8">
                            <table class="table tableSkin mb-0 card-inner mr-4">
                                <caption class="sr-only">Information</caption>
                                <thead>
                                    <th scope="col" style="width: 20%">Interface Type</th>
                                    <th scope="col" style="width: 55%">Error</th>
                                    <th scope="col" style="width: 10%">User Action</th>
                                    <th scope="col" style="width: 15%">Action</th>
                                </thead>
                                <tbody>
                                    <ng-container *ngIf="positionErrorList[positionIndex]?.length">
                                        <tr
                                            *ngFor="let error of positionErrorList[positionIndex]; let errorIndex = index">
                                            <td>{{error?.interfaceTypeName}}</td>
                                            <td>{{error?.errorMessage}}</td>
                                            <td>{{error?.userActionName}}</td>
                                            <td>
                                                <div class="dropdown ml-3 d-inline mr-2" *ngIf="error?.comments">
                                                    <a class="position-relative" id="dropdownMenuLink"
                                                        data-toggle="dropdown" aria-haspopup="true"
                                                        aria-expanded="false">
                                                        <i class="fa fa-commenting-o hand-cursor hoverColor"
                                                            aria-hidden="true" title="Comments"></i>
                                                        <div class="dropdown-menu details-comment-patch dropdown-menu-right fs-14"
                                                            aria-labelledby="dropdownMenuLink">
                                                            <div>
                                                                {{error?.comments}}
                                                            </div>
                                                        </div>
                                                    </a>
                                                </div>
                                                <button *ngIf="['TECHNICAL_ERROR', 'ERROR'].includes(error?.messageType) && !error?.userActionCode"
                                                    class="btn btn-outline-primary" (click)="manualUpdateIndex = errorIndex;callSyncAPI(error, '2');
                                                    expandIndex = positionIndex">Manual Process
                                                </button>
                                                <button *ngIf="['TECHNICAL_ERROR', 'ERROR'].includes(error?.messageType) && !error?.userActionCode"
                                                    class="btn btn-outline-success" (click)="callSyncAPI(error, '1');
                                                    expandIndex = positionIndex">Re-trigger
                                                </button>
                                                <span *ngIf="error?.messageType == 'RESP_PENDING'" class="noDataExists">No Action</span>
                                            </td>
                                        </tr>
                                    </ng-container>
                                    <tr *ngIf="!positionErrorList[positionIndex]?.length">
                                        <td colspan="3" class="text-center">
                                            <span class="noDataExists">No Interface Data Available</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </td>
                    </tr>
                </ng-container>
            </tbody>
        </table>
        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
            <nav class="pagination justify-content-end">
                <app-pagination [totalCount]="positionRetriggerList?.pageCount"
                    (pageChangeEvent)="fetchPositionRetriggerList($event, positionRetriggerList?.advancedSearch)">
                </app-pagination>
            </nav>
        </div>
    </div>
    <!-- No data container -->
    <div *ngIf="!positionRetriggerList?.workdayInterfaceLogDtos?.length" class="no-data-container">
        <span class="no-data-icon-outer">
            <div class="no-data-icon">
                <i class="fa fa-file-o" aria-hidden="true"></i>
                <i class="fa fa-times-circle-o" aria-hidden="true"></i>
            </div>
        </span>
        <h4>There is no information in this section.</h4>
    </div>
</div>
<!-- Confirmation modal -->
<div class="modal fade mySkinDialog" tabindex="-1" id="syncManpowerPositionAPI" tabindex="-1" role="dialog"
    data-backdrop="static" data-keyboard="false" aria-labelledby="positionRetriggerConfirmation" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{userAction?.manpowerUserAction}} {{manpowerLogData?.manpowerInterfaceType}}
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div *ngIf="userAction?.description"
                    class="success-banner px-3 d-flex justify-content-between align-items-center ng-star-inserted">
                    <div>
                        <i aria-hidden="true" class="fa fa-info-circle mr-1 info-icon"></i>
                        <em class="ng-star-inserted"> {{userAction?.description}}</em>
                    </div>
                    <button aria-label="Close" class="close close-button" type="button">
                    </button>
                </div>
                <ng-container>
                    <label class="d-block"><span class="mandatory">*</span>Comments</label>
                    <textarea class="form-control" [(ngModel)]="actionComment" placeholder="Comments"></textarea>
                    <span class="mandatory" *ngIf="validationMap.has('comment')">*
                        {{validationMap.get('comment')}}</span>
                </ng-container>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary-sub btn-sm" (click)="userAction?.manpowerUserActionCode == '1' ?
                    initiateRetriggerApi() : updateManpowerInterfaceManually()">
                    {{userAction?.manpowerUserAction}} {{manpowerLogData?.manpowerInterfaceType}}</button>
            </div>
        </div>
    </div>
</div>
