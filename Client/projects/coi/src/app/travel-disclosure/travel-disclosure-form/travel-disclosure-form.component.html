<div [@fadeInOutHeight]>
    <app-help-text [helpTextList]="helpText" [tooltip]="'Travel Disclosure Form'" [isReadMoreLess]="true"></app-help-text>

    <div class="card">
        <div class="row p-4 m-3 shadow-sm bg-white">
            <!-- Entity Name -->
            <div class="row d-flex px-0" tabindex="-1">
                <label class="fw-500 fs-14 col-custom" for="travel-disclosure-entity-name">Entity Name :</label>
                <div class="col">
                    <app-endpoint-search (onSelect)="selectedEntityEvent($event)" [clearField]="clearField"
                        [httpOptions]="entitySearchOptions" (change)="setUnSavedChangesTrue();"
                        [isError]="(mandatoryList?.has('entity'))" class="w-100"
                        [uniqueId]="'travel-disclosure-entity-name'" autocomplete="off">
                    </app-endpoint-search>
                    <span *ngIf="mandatoryList?.has('entity')" class="fs-13 invalid-msg d-block position-absolute">
                        {{mandatoryList?.get('entity')}}
                    </span>
                    <span *ngIf="!mandatoryList?.has('entity')" class="position-absolute fs-13 col text-secondary mb-0">
                        Type in the official name of the business or organization you need to report.
                        Entities to report include foreign, domestic, public or private entities, but not federal agencies.
                    </span>
                </div>
            </div>
            <ng-container *ngIf="isResultFromSearch">
                <div class="col-custom"></div>
                <div class="col p-0 me-4 mt-5">
                    <app-shared-entity-info-card [entityDetails]="entityDetails" [viewMore]="true"
                        (emitEntityId)="viewEntity($event)"></app-shared-entity-info-card>
                </div>
            </ng-container>

            <!-- traveller details -->
            <div class="row d-flex px-0 mt-20 pt-2">
                <label class="fw-500 fs-14 col-custom" for="travel-disclosure-traveller">Traveller :</label>
                <div class="col-10">
                    <div class="divCenter">
                        <span *ngFor="let details of travellerTypeLookup; let i = index" id="travel-disclosure-traveller"
                            class="mt-2 me-5">
                            <input class="travelDisclosure-radio-checkbox ms-1 me-3 hand-cursor border-secondary"
                                type="checkbox" value={{details.description}} id="traveller-checkbox{{i}}"
                                [(ngModel)]=details.isChecked
                                (ngModelChange)="getTravellerTypeCode(); setUnSavedChangesTrue();">
                            <label class="form-check-label fs-14 fw-normal hand-cursor" for="traveller-checkbox{{i}}">
                                {{details.description}}
                            </label>
                        </span>
                    </div>
                    <span *ngIf="mandatoryList?.has('traveller')" class="fs-13 invalid-msg d-block position-absolute col">
                        {{mandatoryList?.get('traveller')}}
                    </span>
                    <span *ngIf="!mandatoryList?.has('traveller')" class="position-absolute fs-13 col text-secondary mb-0">
                        Select the traveller (can choose multiple options)
                    </span>
                </div>
            </div>

            <!-- title -->
            <div class="row d-flex mt-5 px-0 pt-3">
                <label for="travelDisclosure-title" class="fw-500 fs-14 col-custom">Trip Title :</label>
                <div class="col">
                    <textarea id="travelDisclosure-title" appAutoGrow rows="1" appLengthValidator [isShowLimiter]='true' [limit]=200
                        class="form-control fs-14" autocomplete="off" [(ngModel)]="travelDisclosureRO.travelTitle"
                        (ngModelChange)="setUnSavedChangesTrue(); travelDisclosureRO.travelTitle = travelDisclosureRO.travelTitle.trim()"
                        [ngClass]="(mandatoryList?.get('title')) ? 'invalid-border':''">
                    </textarea>
                    <span *ngIf="mandatoryList?.has('title')" class="fs-13 invalid-msg d-block position-absolute">
                        {{mandatoryList?.get('title')}}
                    </span>
                    <span *ngIf="!mandatoryList?.has('title')" class="position-absolute fs-13 col text-secondary mb-0">
                        Type the title of your trip.
                    </span>
                </div>
            </div>

            <!-- destination -->
            <div class="row d-flex mt-4 px-0">
                <label for="travelDisclosure-destination" class="fw-500 fs-14 d-block col-custom">Destination :</label>
                <div class="divCenter ms-1 col">
                    <input class=" me-2 hand-cursor" type="radio" name="travelDisclosure-destination"
                        id="travelDisclosure-domestic" value="Domestic" [(ngModel)]="destination"
                        (ngModelChange)="setValuesForDestinationType(); setUnSavedChangesTrue(); ">
                    <label class="form-check-label fs-14 fw-normal hand-cursor" for="travelDisclosure-domestic">
                        Domestic
                    </label>
                    <input class=" ms-4 me-2 hand-cursor" type="radio" name="travelDisclosure-destination"
                        id="travelDisclosure-international" value="International" [(ngModel)]="destination"
                        (ngModelChange)="setValuesForDestinationType(); setUnSavedChangesTrue();">
                    <label class="form-check-label fs-14 fw-normal hand-cursor" for="travelDisclosure-international">
                        International
                    </label>
                </div>
            </div>

            <!-- country/state/city -->
            <div class="row mt-4 px-0 d-flex justify-content-between">
                <!-- City list -->
                <div class="row col-6">
                    <label for="travelDisclosure-cityList" class="fw-500 fs-14 col-custom">City :</label>
                    <div class="col">
                        <input type="text" id="travelDisclosure-cityList" autocomplete="off"
                            [(ngModel)]="travelDisclosureRO.destinationCity" class="form-control"
                            (ngModelChange)="setUnSavedChangesTrue(); travelDisclosureRO.destinationCity = travelDisclosureRO.destinationCity.trim()"
                            [ngClass]="(mandatoryList?.get('city')) ? 'invalid-border':''">
                        <span *ngIf="mandatoryList?.has('city')" class="fs-13 invalid-msg d-block position-absolute">
                            {{mandatoryList?.get('city')}}
                        </span>
                        <span *ngIf="!mandatoryList?.has('city')" class="position-absolute fs-13 col text-secondary mb-0">
                            Please enter the city.
                        </span>
                    </div>
                </div>
            
                <!-- Country and State list -->
                <div class="row col-6">
                    <ng-container *ngIf="destination === 'International'">
                        <!-- Country list -->
                        <label class="fw-500 fs-14 col-custom" for="travelDisclosure-countryList col-custom">Country :</label>
                        <div class="col">
                            <app-endpoint-search (onSelect)="selectTravelCountry($event)" [clearField]="countryClearField"
                                [httpOptions]="countrySearchOptions" [uniqueId]="'travelDisclosure-countryList'"
                                (change)="setUnSavedChangesTrue();" autocomplete="off"
                                [isError]="(mandatoryList?.has('country'))? true: false">
                            </app-endpoint-search>
                            <span *ngIf="mandatoryList?.has('country')" class="fs-13 invalid-msg d-block position-absolute">
                                {{mandatoryList?.get('country')}}
                            </span>
                            <span *ngIf="!mandatoryList?.has('country')" class="position-absolute fs-13 col text-secondary mb-0">
                                Select country from the search bar.
                            </span>
                        </div>
                    </ng-container>
            
                    <ng-container *ngIf="destination !== 'International' && destination !== null">
                        <!-- State list -->
                        <label for="travelDisclosure-stateList" class="fw-500 fs-14 col-custom">State :</label>
                        <div class="col">
                            <input type="text" id="travelDisclosure-destinationState" autocomplete="off"
                                [(ngModel)]="travelDisclosureRO.travelState" class="form-control col"
                                (ngModelChange)="setUnSavedChangesTrue();"
                                [ngClass]="(mandatoryList?.get('state')) ? 'invalid-border':''">
                            <span *ngIf="mandatoryList?.has('state')" class="fs-13 invalid-msg d-block position-absolute">
                                {{mandatoryList?.get('state')}}
                            </span>
                            <span *ngIf="!mandatoryList?.has('state')" class="position-absolute fs-13 col text-secondary mb-0">
                                Please enter the state.
                            </span>
                        </div>
                    </ng-container>
                </div>
            </div>
            <!-- Date -->
            <div class="row px-0 mt-5 pt-2 d-flex justify-content-between pb-2">
                <!-- start date -->
                <div class="row col-6">
                    <label for="travelDisclosure-startDate" class="fw-500 fs-14 col-custom">
                        Start Date :
                    </label>
                    <div class="col">
                        <span class="dateField w-100">
                            <input matInput [matDatepicker]="startDate" id="travelDisclosure-startDate"
                                placeholder={{datePlaceHolder}} (click)="startDate.open()" autocomplete="off"
                                class="d-inline-block form-control w-100" [(ngModel)]="travelDisclosureRO.travelStartDate"
                                (ngModelChange)="validateDates(); setUnSavedChangesTrue();"
                                (keypress)="commonService._keyPress($event, 'date')"
                                [ngClass]="(dateValidationList?.get('startDate')) ? 'invalid-border':''" />
                            <i (click)="startDate.open()" class="fa fa-calendar fa-large insidePicker hand-cursor me-2"></i>
                            <mat-datepicker #startDate></mat-datepicker>
                        </span>
                        <span *ngIf="(dateValidationList.get('startDate'))" class="fs-13 invalid-msg d-block position-absolute">
                            {{dateValidationList.get('startDate')}}
                        </span>
                        <span *ngIf="!dateValidationList?.has('startDate')" class="position-absolute fs-13 col text-secondary mb-0">
                            Type your travel start date.
                        </span>
                    </div>
                </div>

                <!-- end date -->
                <div class="row col-6">
                    <label for="travelDisclosure-endDate" class="fw-500 fs-14 col-custom">
                        End Date :
                    </label>
                    <div class="col">
                        <span class="dateField">
                            <input matInput [matDatepicker]="endDate" id="travelDisclosure-endDate"
                                placeholder="{{datePlaceHolder}}" (click)="endDate.open()" autocomplete="off"
                                class="d-inline-block form-control w-100" [(ngModel)]="travelDisclosureRO.travelEndDate"
                                (keypress)="commonService._keyPress($event, 'date')"
                                (ngModelChange)="validateDates(); setUnSavedChangesTrue();"
                                [ngClass]="(dateValidationList?.get('endDate')) ? 'invalid-border':''" />
                            <i (click)="endDate.open()" class="fa fa-calendar fa-large insidePicker hand-cursor me-2"></i>
                            <mat-datepicker #endDate></mat-datepicker>
                        </span>
                        <span *ngIf="(dateValidationList.get('endDate'))" class="fs-13 invalid-msg d-block position-absolute">
                            {{dateValidationList.get('endDate')}}
                        </span>
                        <span *ngIf="!dateValidationList?.has('endDate')" class="position-absolute fs-13 col text-secondary mb-0">
                            Type your travel end date.
                        </span>
                    </div>
                </div>
            </div>

            <!-- Trip purpose -->
            <div class="row mt-5 px-0">
                <label for="travelDisclosure-tripPurpose" class="fw-500 fs-14 col-12 mb-1">
                    Purpose of the Trip :
                </label>
                <div class="col-12">
                    <textarea id="travelDisclosure-tripPurpose" appAutoGrow rows="1" appLengthValidator [isShowLimiter]='true' [limit]=500
                        class="form-control" autocomplete="off" [(ngModel)]="travelDisclosureRO.purposeOfTheTrip"
                        (ngModelChange)="setUnSavedChangesTrue(); travelDisclosureRO.purposeOfTheTrip = travelDisclosureRO.purposeOfTheTrip.trim()"
                        [ngClass]="(mandatoryList?.get('purpose')) ? 'invalid-border':''">
                        </textarea>
                    <span *ngIf="mandatoryList?.has('purpose')" class="fs-13 invalid-msg d-block position-absolute">
                        {{mandatoryList?.get('purpose')}}
                    </span>
                    <span *ngIf="!mandatoryList?.has('purpose')" class="position-absolute fs-13 col text-secondary mb-0">
                        Type purpose of the trip.
                    </span>
                </div>
            </div>

            <!-- relationship with research -->
            <div class="row px-0 mt-5">
                <label for="travelDisclosure-relationship" class="fw-500 fs-14 col-12 mb-1">
                    Relationship to Your Research :
                </label>
                <div class="col-12">
                    <textarea id="travelDisclosure-relationship" appAutoGrow rows="1" appLengthValidator [isShowLimiter]='true' [limit]=500
                        class="form-control" autocomplete="off" [(ngModel)]="travelDisclosureRO.relationshipToYourResearch"
                        (ngModelChange)="setUnSavedChangesTrue(); travelDisclosureRO.relationshipToYourResearch = travelDisclosureRO.relationshipToYourResearch.trim()"
                        [ngClass]="(mandatoryList?.get('relationship')) ? 'invalid-border':''">
                    </textarea>
                    <span *ngIf="mandatoryList?.has('relationship')" class="fs-13 invalid-msg d-block position-absolute">
                        {{mandatoryList?.get('relationship')}}
                    </span>
                    <span *ngIf="!mandatoryList?.has('relationship')" class="position-absolute fs-13 col text-secondary mb-0">
                        Type relationship to your research.
                    </span>
                </div>
            </div>

            <!-- Estimated amount -->
            <div class="row px-0 mt-5 pb-4 justify-content-between d-flex align-items-center">
                <label for="travelDisclosure-estimation" class="fw-500 fs-14 col-12 mb-1">
                    Actual U.S. dollar amount reimbursed and/or paid on your behalf :
                </label>
                <div class="col-12">
                    <input appCurrencyFormat class="form-control" type="text"
                        oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1').replace(/^0(?=[^.])/g, '0');"
                        [(ngModel)]="travelDisclosureRO.travelAmount" [initialValue]="travelDisclosureRO.travelAmount"
                        id="travelDisclosure-estimation" autocomplete="off" (ngModelChange)="setUnSavedChangesTrue();"
                        [ngClass]="(mandatoryList?.get('amount')) ? 'invalid-border' : ''">
                    <span *ngIf="mandatoryList?.has('amount')" class="fs-13 invalid-msg d-block position-absolute">
                        {{mandatoryList?.get('amount')}}
                    </span>
                    <span *ngIf="!mandatoryList?.has('amount')" class="position-absolute fs-13 col text-secondary mb-0">
                        Please enter the amount.
                    </span>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Entity Details Modal -->
<button class="d-none" data-bs-toggle="modal" data-bs-target="#travel-entity-details" id="persondetails">
</button>

<div class="modal fade mySkinDialog modal-lg" id="travel-entity-details" tabindex="-1" aria-labelledby="exampleModalLabel"
  data-bs-backdrop="static" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header headerStyle">
        <h5 class="modal-title userDetail " id="entityDetails">{{addEntityConfirmation?.entityName}}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" (click)="clearEntityDetails()"></button>
      </div>
      <div class="modal-body">
        <div class="mx-1 row pt-1 d-flex mb-3">
          <div class="text-secondary fs-14 col-4 mb-15">
            <label class="grey-text me-2"> Country</label>
            <span class="d-flex fs-14 fw-normal"> {{addEntityConfirmation?.country?.countryName}}</span>
          </div>
          <div class="text-secondary fs-14 col-4 mb-15">
            <label class="grey-text me-2">Entity Type</label>
            <span class="d-flex fs-14 fw-normal"> {{addEntityConfirmation?.entityType?.description}}</span>
          </div>
          <div class="text-secondary fs-14 col-4">
            <label class="grey-text me-2">Entity Status</label>
            <span class="fs-14 fw-400 d-flex entity-risk-badge px-3"
              [ngClass]="addEntityConfirmation?.isActive ? 'active' : 'inactive'">{{addEntityConfirmation?.isActive
              ?'Active':'Inactive'}}</span>
          </div>
          <div class="text-secondary fs-14 col-8 mt-2">
            <label class="grey-text me-2"> Address</label>
            <span class="d-flex fs-14 fw-normal" *ngIf="!isAddressReadMore && addEntityConfirmation?.address?.length > 55; else showFullInfo">
              <span> {{(addEntityConfirmation?.address |
                slice:0:55)}}
              <span (click)="isAddressReadMore = !isAddressReadMore" class="hand-cursor"><span class="fw-medium">...<u>Read more</u></span>
              </span></span>
            </span>
            <ng-template #showFullInfo>
              <span class="word-break-all d-flex fs-14 fw-normal">{{addEntityConfirmation?.address}}</span>
              <span *ngIf="addEntityConfirmation?.address?.length > 55" (click)="isAddressReadMore = !isAddressReadMore" aria-hidden="true"
                class="d-flex hand-cursor"><span class="fw-medium"><u>Read Less</u></span>
              </span>
            </ng-template>
          </div>
          <div class="col text-secondary fs-14 align-items-center mt-2">
            <label class="fw-bold me-2">Risk </label>
            <span class="fw-normal">
              <div class="text-color fs-14 d-flex">
                <span>
                  <mat-icon
                    class="{{getWarningClass(addEntityConfirmation?.entityRiskCategory?.riskCategoryCode)}} material-icons-round">warning</mat-icon>
                </span>
                <span class="ml-2">{{addEntityConfirmation?.entityRiskCategory.description}}</span>
              </div>
            </span>
          </div>
        </div>
      </div>
      <div class="modal-footer ct-footer-padding">
        <button (click)="clearEntityDetails()" class="btn btn-outline-secondary btn-sm" id="claim-sumbit-no-btn"
          data-bs-dismiss="modal" type="button">Clear
        </button>
        <button (click)="confirmEntityDetails()" data-bs-dismiss="modal"
          class="btn btn-primary btn-sm fs-14 btn-primary-submit" type="button">Confirm</button>
      </div>
    </div>
  </div>
</div>