<div class="border-top-0 mb-3 mx-3 row">
    <div class="col-9 p-0">
        <div class="border shadow-sm">
            <div class="disclosure-heading px-3 d-flex">
                <div class="align-self-center flex-fill">
                    <p class="m-0"><strong>{{coiData?.coiDisclosure?.coiDisclosureCategoryType?.description}} by <span class="text-primary"><u>{{coiData?.person?.fullName}}</u></span></strong>
                        -
                        (Home Unit: <strong>{{coiData?.person?.unit?.unitName}}</strong>)</p>
                </div>
                <div class="d-flex">
                    <ng-container *ngIf="isCreateMode">
                        <div class="align-items-center d-flex">
                            <mat-icon class="green-label">bookmark</mat-icon>
                        </div>
                        <div class="flex-fill ps-3">
                            <div class="three-pixel-padding-top">
                                <p class="m-0 fs-14">COI Training: <strong>Completed</strong></p>
                            </div>
                            <div>
                                <p class="mb-0 fs-14 negative-three-pixel-margin">Expiration Date: 23/02/2024</p>
                            </div>
                        </div>
                    </ng-container>

                    <ng-container *ngIf="!isCreateMode">
                        <div class="align-items-center d-flex">
                            <button (click)="isCardExpanded=!isCardExpanded"
                                    class="toggle-header-btn align-items-center bg-white border btn d-flex justify-content-center p-0 rounded-5 shadow-sm">
                                <mat-icon>{{isCardExpanded ? 'expand_less' : 'expand_more'}}</mat-icon>
                            </button>
                        </div>
                    </ng-container>
                </div>
            </div>
            <div *ngIf="isCardExpanded" class="d-flex p-3 triple-card bg-white">
                <div class="col">
                    <div class="border h-100 rounded-1">
                        <span class="status-pill">Status</span>
                        <div class="ps-4 table-negative-margin">
                            <table class="fs-14 fw-medium spaced-table">
                                <tr>
                                    <td>Disposition:</td>
                                    <td class="ps-4"><span
                                            class="bg-{{getDispositionStatusBadge(coiData?.coiDisclosure?.coiDispositionStatus?.dispositionStatusTypeCode)}} text-{{ getDispositionStatusTextColor(coiData?.coiDisclosure?.coiDispositionStatus?.dispositionStatusTypeCode)}} px-3 py-1 rounded-5 ">{{coiData?.coiDisclosure?.coiDispositionStatus?.description}}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Review:</td>
                                    <td class="ps-4"><span
                                            class="bg-{{getReviewStatusBadge(coiData?.coiDisclosure?.coiReviewStatus?.reviewStatusTypeCode)}} text-{{getReviewStatusBadgeTextColor(coiData?.coiDisclosure?.coiReviewStatus?.reviewStatusTypeCode)}} px-3 py-1 rounded-5">{{coiData?.coiDisclosure?.coiReviewStatus?.description}}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Disclosure:</td>
                                    <td class="ps-4"><span
                                            class="bg-{{getDisclosureStatusBadge(coiData?.coiDisclosure?.coiDisclosureStatus?.disclosureStatusCode)}} text-{{getDisclosureStatusBadgeTextColor(coiData?.coiDisclosure?.coiDisclosureStatus?.disclosureStatusCode)}} px-3 py-1 rounded-5 text-black">{{coiData?.coiDisclosure?.coiDisclosureStatus?.description}}</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="border h-100 mx-3 rounded-1">
                        <span class="status-pill">Date</span>
                        <div class="ps-4 table-negative-margin">
                            <table class="fs-14 fw-medium spaced-table">
                                <tr>
                                    <td>Create:</td>
                                    <td class="ps-4">{{coiData?.coiDisclosure?.createTimestamp ? (coiData?.coiDisclosure?.createTimestamp |
                                        dateFormatterWithTimeZone) : ''}}</td>
                                </tr>
                                <tr>
                                    <td>Certification:</td>
                                    <td class="ps-4">{{coiData?.coiDisclosure?.certifiedTimestamp ?
                                        (coiData?.coihideRelationshipModalDisclosure?.certifiedTimestamp | dateFormatter) : ''}}</td>
                                </tr>
                                <tr>
                                    <td>Expiration:</td>
                                    <td class="ps-4">{{coiData?.coiDisclosure?.expirationDate ? (coiData?.coiDisclosure?.expirationDate |
                                        dateFormatter) : ''}}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="border h-100 rounded-1">
                        <span class="status-pill">Relationship with</span>
                        <div class="ps-4 table-negative-margin">
                            <table class="fs-14 fw-medium">
                                <tr>
                                    <td><span
                                            class="bold-blue-color">{{coiData?.numberOfSFI ? coiData?.numberOfSFI : 0}}</span>
                                    </td>
                                    <td class="ps-2">Significant Financial Interest</td>
                                </tr>
                                <tr *ngIf="!coiData.proposalIdlinkedInDisclosure && coiData.coiDisclosure.coiDisclosureCategoryType.disclosureCategoryTypeCode != '3'">
                                    <td><span
                                            class="bold-blue-color">{{coiData?.numberOfProposal ? coiData?.numberOfProposal : 0}}</span>
                                    </td>
                                    <td class="ps-2">Proposals</td>
                                </tr>
                                <tr *ngIf="!coiData.proposalIdlinkedInDisclosure && coiData.coiDisclosure.coiDisclosureCategoryType.disclosureCategoryTypeCode != '3'">
                                    <td><span
                                            class="bold-blue-color">{{coiData?.numberOfAward ? coiData?.numberOfAward : 0}}</span>
                                    </td>
                                    <td class="ps-2">Awards</td>
                                </tr>

                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <ng-container *ngIf="isCreateMode">
                <div class="nav-progress navigation-tabs row">
                    <div (click)="goToStep(1)" [class.complete]="currentStepNumber > 0" [routerLink]="['screening']"
                         class="col h-100 m-0" queryParamsHandling='merge'
                         title="Goto step Screening Questionnaire">
                        Screening Questionnaire
                        <div class="arrow-wrapper">
                            <div class="arrow-cover">
                                <div class="arrow"></div>
                            </div>
                        </div>
                    </div>
                    <div (click)="goToStep(2)" [class.complete]="currentStepNumber > 1" [routerLink]="['sfi']"
                         class="col ps-5 text-nowrap" queryParamsHandling='merge'
                         title="Goto step Significant Financial Interest(SFIs)">
                        Significant Financial Interest(SFIs)
                        <div class="arrow-wrapper">
                            <div class="arrow-cover">
                                <div class="arrow"></div>
                            </div>
                        </div>
                    </div>
                    <div (click)="goToStep(3)" [class.complete]="currentStepNumber > 2" [routerLink]="['relationship']"
                         class="col" queryParamsHandling='merge' title="Goto step Relationships">
                        <span class="align-self-center">Relationships</span>
                        <div class="arrow-wrapper">
                            <div class="arrow-cover">
                                <div class="arrow"></div>
                            </div>
                        </div>
                    </div>
                    <div (click)="goToStep(4)" [class.complete]="currentStepNumber > 3" [routerLink]="['certification']"
                         class="col" queryParamsHandling='merge' title="Goto step Certification">
                        <span class="align-self-center">Certification</span>
                    </div>
                </div>
            </ng-container>

            <ng-container *ngIf="!isCreateMode">
                <div class="navigation-tabs d-flex align-items-center">
                    <div [routerLink]="['summary']" class="navigation-box border-end" queryParamsHandling='merge'
                         role="button">
                        <div class="navigation-box-content" routerLinkActive="active">Disclosure</div>
                    </div>
                    <div [routerLink]="['relationship']" class="navigation-box border-end" queryParamsHandling='merge'
                         role="button">
                        <div class="navigation-box-content" routerLinkActive="active">Relationships</div>
                    </div>
                    <div [routerLink]="['conflict-management']" class="navigation-box border-end"
                         queryParamsHandling='merge' role="button">
                        <div class="navigation-box-content" routerLinkActive="active">Conflict Management</div>
                    </div>
                    <div [routerLink]="['review']" class="navigation-box border-end" queryParamsHandling='merge'
                         role="button">
                        <div class="navigation-box-content" routerLinkActive="active">Reviews</div>
                    </div>
                    <div [routerLink]="['history']" class="navigation-box" queryParamsHandling='merge' role="button">
                        <div class="navigation-box-content" routerLinkActive="active">History</div>
                    </div>
                </div>
            </ng-container>
        </div>
    </div>
    <div [class.p-0]="isCreateMode" class="col-3 pe-0">
        <div *ngIf="isCreateMode" class="d-flex flex-column p-0 bg-white min-height-189 border-end shadow-sm">
            <div class="flex-fill h-100">
                <div class="d-flex justify-content-between p-3">
                    <button [routerLink]="['/coi/user-dashboard']" class="btn btn-outline-grey pb-0 fs-14 col-2">
                        <mat-icon>home</mat-icon>
                    </button>
                    <button (click)="goBackStep()" [disabled]="currentStepNumber==1"
                            class="mx-2 fs-14 align-items-center btn btn-outline-grey d-flex pb-0 pt-0 col justify-content-center">
                        <mat-icon class="me-2">undo</mat-icon>
                        Previous
                    </button>
                    <button (click)="goToStep()" [disabled]="currentStepNumber==4"
                            class="fs-14 align-items-center btn btn-outline-grey d-flex pb-0 pt-0 col justify-content-center">
                        <mat-icon class="me-2">redo</mat-icon>
                        Next
                    </button>
                </div>
                <div class="d-flex justify-content-around px-3 pb-3">
                    <button (click)="sfiService.isShowSfiNavBar = true"
                            class="fs-14 btn btn-primary d-flex justify-content-center w-100 align-items-center">
                        <mat-icon class="me-2">add</mat-icon>
                        Add Significant Financial Interest
                    </button>
                </div>
                <div *ngIf="router.url.includes('create-disclosure/screening') && dataStore.getEditModeForCOI()"
                     class="d-flex justify-content-around px-3 pb-3">
                    <button (click)="triggerSave()" class="fs-14 btn btn-primary d-flex justify-content-center w-100 align-items-center">
                        <mat-icon class="me-2">save</mat-icon>
                        Save
                    </button>
                </div>
                <div *ngIf="router.url.includes('create-disclosure/certification') && !coiData.coiDisclosure.certifiedBy"
                     class="d-flex justify-content-around px-3">
                    <button (click)="certifyDisclosure()" [disabled]="!coiService.isCertified"
                            class="fs-14 btn btn-primary d-flex justify-content-center w-100 align-items-center">
                        <mat-icon class="me-2">done</mat-icon>
                        Submit
                    </button>
                </div>
            </div>
            <div class="fs-14 fw-medium align-items-center d-flex justify-content-center notes">
                Notes & Attachments

            </div>
            <div *ngIf="sfiService.isShowSfiNavBar" class="task-nav-div" id="task-navigation-bar">
                <app-add-sfi></app-add-sfi>
            </div>
        </div>
        <div *ngIf="!isCreateMode" class="d-flex flex-column p-0">
            <div class="flex-fill h-100 border-end bg-white shadow-sm">
                <div class="d-flex justify-content-between p-3">
                    <button [routerLink]="['/coi/user-dashboard']" class="btn btn-outline-secondary pb-0 fs-14 col-2">
                        <mat-icon>home</mat-icon>
                    </button>
                    <button (click)="location.back()" [disabled]="router.url.includes('coi/disclosure/summary')"
                            class="mx-2 fs-14 align-items-center btn btn-outline-secondary d-flex pb-0 pt-0 col justify-content-center">
                        <mat-icon class="me-2">undo</mat-icon>
                        Previous
                    </button>
                    <button class="fs-14 align-items-center btn btn-outline-secondary d-flex pb-0 pt-0 col justify-content-center">
                        <mat-icon class="me-2">rate_review</mat-icon>
                        Comments
                    </button>
                </div>
                <div class="d-flex justify-content-around px-3 pb-3">
                    <button *ngIf="isCOIAdministrator && coiData?.coiDisclosure?.reviewStatusTypeCode == '2'"
                            class="fs-14 btn btn-outline-grey d-flex justify-content-center w-100 align-items-center"
                            data-bs-target="#add-location-modal" data-bs-toggle="modal"
                            title="Add Review Location">
                        <mat-icon class="me-2">person_add</mat-icon>
                        Assign Reviewer
                    </button>
                </div>
                <div class="d-flex justify-content-around px-3">
                    <button *ngIf="isCOIAdministrator && coiData?.coiDisclosure?.reviewStatusTypeCode == '2'"
                            class="me-2 fs-14 btn btn-outline-grey d-flex justify-content-center w-100 align-items-center" data-bs-target="#completeReviewModalFromDashboard"
                            data-bs-toggle="modal">
                        <mat-icon class="me-2">done</mat-icon>
                        Complete Review
                    </button>

                    <button aria-expanded="false"
                            class="align-items-center btn btn-outline-grey col d-flex fs-14 justify-content-center p-0 w-100"
                            data-bs-toggle="dropdown" id="moreActions" role="button">
                        <mat-icon>more_vert</mat-icon>
                    </button>
                    <ul class="border dropdown-menu p-0 rounded-0" style="" aria-labelledby="moreActions">
                        <li class="ash-text border-bottom"><span class="dropdown-item fs-15 fw-medium">
                            <mat-icon class="me-2 ash-text">notifications</mat-icon> Notify</span>
                        </li>
                        <li class="ash-text"><span class="dropdown-item fs-15 fw-medium">
                            <mat-icon class="me-2 ash-text">print</mat-icon> Print</span>
                        </li>
                    </ul>
                </div>
                <div class="px-3 my-3 fs-14 ash-text"><span class="fw-medium me-1">Last Updated by:</span>
                    {{coiData?.coiDisclosure?.updateUser}}
                    on {{coiData?.coiDisclosure?.updateTimestamp | dateFormatterWithTimeZone:'long'}}
                </div>
            </div>
            <ng-container *ngIf="router.url.includes('/coi/disclosure/summary')">
            </ng-container>
        </div>
    </div>
</div>

<!-- Complete review modal -->
<div class="modal modal-coi fade mySkinDialog" id="completeReviewModalFromDashboard" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header pe-0">
                <h4 class="modal-title">Complete Review
                </h4>
                <button aria-label="Close" class="close btn m-0" data-bs-dismiss="modal" id="dissmiss-btn"
                        type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row mt-2 mb-0">
                    <div class="col-lg-12">
                        <p>Are you sure you want to complete the review of this disclosure?</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-secondary fs-14" data-bs-dismiss="modal"
                        type="button">Cancel
                </button>
                <button (click)="completeDisclosureReview()" class="btn btn-outline-primary fs-14"
                        data-bs-dismiss="modal"
                        type="button">Complete Review
                </button>
            </div>
        </div>
    </div>
</div>
<!-- Complete review modal -->
<div class="modal modal-coi fade mySkinDialog" id="completeReviewModalFromDashboardErrorModal" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header pe-0">
                <h4 class="modal-title">Warning!
                </h4>
                <button aria-label="Close" class="close btn m-0" data-bs-dismiss="modal" id="dissmiss-btn" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row mt-2 mb-0">
                    <div class="col-lg-12">
                        <div class="alert alert-danger fs-12">
                            <i aria-hidden="true" class="fa fa-exclamation-circle icon text-danger mr-3"></i>
                            There still are some pending reviews for the reviewers to complete. Please wait until all
                            the reviews are completed.
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-secondary fs-14" data-bs-dismiss="modal"
                        type="button">Close
                </button>
            </div>
        </div>
    </div>
</div>
<div class="mx-3">
    <router-outlet></router-outlet>
</div>
<app-coi-review-comment-modal></app-coi-review-comment-modal>
