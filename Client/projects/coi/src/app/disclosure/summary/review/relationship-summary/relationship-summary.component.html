
<div [id]= selectedProject?.moduleItemId class="card border shadow mt-2" *ngIf="selectedProject?.moduleCode">
    <div class="card-header px-4 d-flex align-items-center justify-content-between">
      <div class="col-12 d-flex align-items-center">
        <ng-container  *ngIf="selectedProject?.moduleCode == 3">
          <span class="active-ribbon shadow-sm align-items-center d-flex ps-2">Proposal</span>
          <p class="entity-title mt-3">
              <strong class="fs-16">{{selectedProject?.moduleItemId}} - {{selectedProject?.title}} </strong>
          </p>
        </ng-container>
        <ng-container *ngIf="selectedProject?.moduleCode == 1">
          <span class="active-ribbon shadow-sm align-items-center d-flex ps-2">Award</span>
          <p class="entity-title mt-3">
              <strong class="fs-16">#{{selectedProject?.moduleItemKey}} - {{selectedProject?.title}} </strong>
          </p>
        </ng-container>
        <button type="button" class="btn btn-outline-primary btn-sm header-buttons">
          <mat-icon role="img">rate_review</mat-icon>
        </button>
      </div>
      </div>
      <div class="card-body">
            <div class="row m-2">
            <div class="col-4">
              <label class="label-text">PI :</label>
              <span class="ml-2 grey-text">{{selectedProject?.principalInvestigator}}</span>
            </div>
            <div class="col-8">
              <label class="label-text">Sponsor :</label>
              <span class="ml-2 grey-text">{{selectedProject?.sponsor}}</span>
            </div>
            <div class="col-4">
              <label class="label-text">Period :</label>
              <span class="ml-2 grey-text">{{selectedProject?.startDate | dateFormatter}} - {{selectedProject?.endDate | dateFormatter}}</span>
            </div>
            <div class="col-8">
              <label class="label-text">Prime Sponsor :</label>
            <span *ngIf="selectedProject?.primeSponsor" class="ml-2 grey-text">{{selectedProject?.primeSponsor}}</span>
            <span *ngIf="!selectedProject?.primeSponsor" class="noDataExists">No Prime Sponsor exist</span>
            </div>
            <div class="col-4">
              <label class="label-text">Proposal Status : </label>
              <span class="ml-2 grey-text">{{selectedProject?.moduleStatus}}</span>
            </div>
            <div class="col-8">
              <label class="label-text">Lead Unit :</label>
            <span class="ml-2 grey-text" *ngIf="selectedProject?.unitName">{{selectedProject?.unitNumber}} - {{selectedProject?.unitName}}</span>
            <span *ngIf="!selectedProject?.unitName" class="noDataExists">No Lead Unit exist</span>
            </div>
            </div>
            <table class="table fs-14 fw-medium" *ngIf="projectRelations.length > 0">
              <!-- <caption class="sr-only">List of Awards/Proposal</caption> -->
              <thead>
                  <tr class="header-border table-light">
                    <th style="width: 30%;" class="border-end px-3">Significant Financial Interest</th>
                    <th style="width: 35%;" class="border-end px-3">Define relationship between SFIs and Projects</th>
                    <th style="width: 15%;" class="border-end px-3">COI Status</th>
                    <th style="width: 10%;" class="border-end px-3">Actions</th>
                  </tr>
              </thead>
              <tbody class="white-bg" >
                <tr *ngFor="let test of projectRelations; let i = index" class="tr-hover">
                  <td class="table-data border-end fw-600 px-3" [class.border-0]="i != projectRelations?.length-1">{{test?.personEntity?.coiEntity?.entityName}}</td>
                  <td class="border-end px-3" [class.border-0]="i != projectRelations?.length-1">{{test?.comment?.comments}}</td>
                  <td class="border-end px-3" [class.border-0]="i != projectRelations?.length-1">
                    <span class="badge rounded-pill bg-danger mt-2" *ngIf="test?.coiProjConflictStatusType?.projectConflictStatusCode == 1">{{test?.coiProjConflictStatusType?.description}}</span>
                    <span class="badge rounded-pill bg-success mt-2" *ngIf="test?.coiProjConflictStatusType?.projectConflictStatusCode == 2">{{test?.coiProjConflictStatusType?.description}}</span>
                    <span class="badge rounded-pill bg-warning mt-2" *ngIf="test?.coiProjConflictStatusType?.projectConflictStatusCode == 3">{{test?.coiProjConflictStatusType?.description}}</span>
                  </td>
                  <td class="px-3" [class.border-0]="i!= projectRelations?.length-1">
                    <button type="button" (mouseenter)="isShowHoverWhite[i]= true" (mouseout)="isShowHoverWhite[i]= false" class="btn btn-outline-primary btn-sm action-buttons mr-15"  (click)="isOpenSlider = true">
                      <img *ngIf= "!isShowHoverWhite[i]" src="{{deployMap}}assets/images/conflict-history.svg">
                      <img *ngIf= "isShowHoverWhite[i]" src="{{deployMap}}assets/images/conflict-history-hover.svg">
                    </button>
                    <button type="button" class="btn btn-outline-primary btn-sm action-buttons comment-icon p-0">
                      <mat-icon role="img">rate_review</mat-icon>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
            <div *ngIf="projectRelations.length == 0">
              <app-no-information> </app-no-information>
            </div>
      </div>
</div>

<app-add-comment-slider *ngIf="isOpenSlider" (closePage)="closePage()" [isOpenSlider]="isOpenSlider"></app-add-comment-slider>
<!-- Reviewer Conflict Modal -->
<div class="modal modal-coi fade mySkinDialog" id="reviewer-conflict-modal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Project Conflict Review
                </h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" id="dissmiss-btn" aria-label="Close" (click)="clearConflictModal()">
                </button>
            </div>
            <div class="modal-body pt-0">
                <div class="my-3 mx-0 row">
                    <div class="col-12 p-3 highlight-node font">
                      <p>Reviewers can update the conflict status of each projectâ€™s relationship with the SFIs. Please note that the system will overwrite the latest conflict status captured in the disclosure. Use the History button next to the conflict status to track the conflict data changes.</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="col-12">
                        <label for="Conflict Status"><span class="mandatory">*</span> Conflict Status</label>
                        <select [(ngModel)]="reviewerConflict.coiReviewerStatusCode" class="form-control"
                            [ngClass]="projectConflictValidationMap?.has('coiReviewerStatusCode') ? 'is-invalid d-block' : ''">
                            <option value=undefined>--Select--</option>
                            <option *ngFor="let status of _dataStoreAndEventsService.conflictStatusList"
                                [value]="status.discDetStatusCode">
                                {{status?.description}}
                            </option>
                        </select>
                        <div *ngIf="projectConflictValidationMap?.has('coiReviewerStatusCode')" class="invalid-feedback d-block">
                            {{projectConflictValidationMap?.get('coiReviewerStatusCode')}}
                        </div>
                    </div>
                    <div class="col-12 my-0">
                        <label><span class="mandatory">*</span> Comments</label>
                        <textarea class="form-control" appLengthValidator [isShowLimiter]="true"
                            [ngClass]="projectConflictValidationMap?.has('comment') ? 'is-invalid d-block' : ''"
                            [limit]="4000" [(ngModel)]="reviewerConflict.comment.comments"></textarea>
                        <div *ngIf="projectConflictValidationMap?.has('comment')" class="invalid-feedback d-block">
                            {{projectConflictValidationMap?.get('comment')}}
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="nego-sumbit-no-btn" type="button" class="btn btn-secondary btn-sm"
                    data-dismiss="modal" (click)="clearConflictModal()">Cancel</button>
                <button type="button" class="btn btn-primary-sub btn-sm" (click)="updateProjectConflictStatus()">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Reviewer Conflict History Modal -->
<div class="modal modal-coi fade mySkinDialog" id="conflict-history-modal" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Reviewer Conflict History
                </h4>
                <button type="button" class="btn-close" data-dismiss="modal" id="dissmiss-btn" aria-label="Close">
                </button>
            </div>
            <div class="modal-body">
                <div *ngIf="conflictHistory?.length; else noHistory" class="p-0 w-100 widget-container">
                    <table class="tableSkin">
                        <caption class="sr-only">List of Reviewer Conflict History</caption>
                        <thead class="sticky-top">
                            <tr class="header-border">
                                <th>Name</th>
                                <th>Conflict Status</th>
                                <th style="width: 30%">Comment</th>
                                <th>Last Updated</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let conflict of conflictHistory">
                                <td>{{conflict?.updateUserFullName}}</td>
                                <td>{{conflict?.coiDisclosureDetailsStatus?.description}}</td>
                                <td>{{conflict?.comment}}</td>
                                <td>{{conflict?.updateTimestamp | dateFormatterWithTimeZone: 'long' }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <ng-template #noHistory>
                    <div class="no-data-container">
                        <span class="no-data-icon-outer">
                            <div class="no-data-icon">
                                <i class="fa fa-file-o" aria-hidden="true"></i>
                                <i class="fa fa-times-circle-o" aria-hidden="true"></i>
                            </div>
                        </span>
                        <h4>There are no reviewer conflicts.</h4>
                    </div>
                </ng-template>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-sm"
                    data-dismiss="modal">close
                </button>
            </div>
        </div>
    </div>
</div>
