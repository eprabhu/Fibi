
<div [id]= selectedProject?.moduleItemId class="left-margin card border shadow mt-2" *ngIf="selectedProject?.moduleCode">
    <div class="card-header px-4 d-flex align-items-center justify-content-between">
      <span class="d-flex mt-3 mb-3">
        <ng-container *ngIf="selectedProject?.moduleCode == 3 ">
          <span class="active-ribbon bg-proposal-clip shadow-sm align-items-center d-flex">Proposal</span>
          <span class="title-text mt-2 word-break-all new-line-property badge-margin">
            <u class="clickable-content" (click)="openModule();"><strong>#{{selectedProject?.moduleItemId}} - {{!readMoreOrLess ? (selectedProject?.title | slice:0:100) :
              selectedProject?.title}}</strong></u>
            <span *ngIf="!readMoreOrLess && selectedProject?.title?.length>100">...
              <span *ngIf="!readMoreOrLess" (click)="readMoreOrLess=true">
                <span class="readMore hand-cursor fs-14 fw-medium">Read More</span>
              </span>
            </span>
            <span *ngIf="readMoreOrLess" (click)="readMoreOrLess= false">
              <span class="readMore hand-cursor fs-14 fw-medium">Read Less</span>
            </span>
          </span>
        </ng-container>

        <ng-container *ngIf="selectedProject?.moduleCode == 1">
          <span class="active-ribbon bg-award-clip shadow-sm align-items-center d-flex">Award</span>
          <span class="title-text mt-2 word-break-all new-line-property badge-margin">
            <u class="clickable-content" (click)="openModule();"><strong>#{{selectedProject?.moduleItemKey}} - {{!readMoreOrLess ? (selectedProject?.title | slice:0:100) :
              selectedProject?.title}}</strong></u>
            <span *ngIf="!readMoreOrLess && selectedProject?.title?.length>100">...
              <span *ngIf="!redivdMoreOrLess" (click)="readMoreOrLess=true">
                <span class="readMore hand-cursor fs-14 fw-medium">Read More</span>
              </span>
            </span>
            <span *ngIf="readMoreOrLess" (click)="readMoreOrLess= false">
              <span class="readMore hand-cursor fs-14 fw-medium">Read Less</span>
            </span>
          </span>
        </ng-container>
      </span>

      <span class="align-items-center d-flex">
        <button (click)="openReviewerComment(selectedProject,'RELATIONSHIP')" class="btn btn-primary-icon btn-sm d-flex" id="add-activity" title="Comments" type="button">
          <mat-icon>rate_review</mat-icon>
      </button>
      </span>
    </div>
      <div *ngIf="isCollapsed" class="card-body">
			<div class="row">
				<div class="col ms-3 my-3">
					<div class="row">
						<div class="col-5">
							<label class="label-text">Principal Investigator :</label>
							<span class="ml-2 grey-text">{{selectedProject?.principalInvestigator}}</span>
						</div>
						<div class="col-4">
							<label class="label-text">Project Role : </label>
							<span class="ml-2 grey-text">{{selectedProject?.reporterRole}}</span>
						</div>
						<div class="col-3">
							<label class="label-text">Period :</label>
							<span class="ml-2 grey-text">{{selectedProject?.startDate | dateFormatter}} - {{selectedProject?.endDate
								|
								dateFormatter}}</span>
						</div>
						<div class="col-5">
							<label class="label-text">Sponsor :</label>
							<span class="ml-2 grey-text">{{selectedProject?.sponsor}}</span>
						</div>
						<div class="col-7">
							<label class="label-text">Lead Unit :</label>
							<app-no-data-label [valueToShow]="selectedProject?.unitName">
								<span class="ml-2 grey-text">{{selectedProject?.unitNumber}} - {{selectedProject?.unitName}}</span>
							</app-no-data-label>
						</div>
					</div>
				</div>
				<div class="border-start col-auto p-10 d-flex align-items-center">
                    <div *ngIf="projectRelations.length > 0" class="me-2">
                        <span class="{{_commonService
                        .getProjectDisclosureConflictStatusBadge(worstCaseStatus?.projectConflictStatusCode)}}"></span>
                        <span class="badgeFont">{{worstCaseStatus?.description}}</span>
                    </div>
                    <p *ngIf="projectRelations.length == 0" class="f-14 fw-500 m-0 pe-2">No SFI(s) Attached</p>
				</div>
			</div>
              <table class="table fs-14 fw-medium" *ngIf="projectRelations.length > 0">
                <!-- <caption class="sr-only">List of Awards/Proposal</caption> -->
                <thead>
                    <tr class="header-border table-light">
                      <th style="width: 40%;" class="border-end px-3">Significant Financial Interest</th>
                      <th style="width: 26%;" class="border-end px-3">Relationship between SFIs and Projects</th>
                        <th style="width: 14%;" class="border-end px-3">Conflict Status
                            <button title="Sort conflict Status in ascending order" class="sortable-icon btn p-0"
                                    aria-label=""
                                    *ngIf="isDesc" (click)="sortConflictStatus(true)">
                                <mat-icon>arrow_upward</mat-icon>
                            </button>
                            <button title="Sort conflict Status in descending order" class="sortable-icon btn p-0"
                                    *ngIf="!isDesc" (click)="sortConflictStatus(false)">
                                <mat-icon>arrow_downward</mat-icon>
                            </button>
                        </th>
                      <th style="width: 8%;" class="border-end px-3">Actions</th>
                    </tr>
                </thead>
                <tbody class="white-bg" >
                  <tr *ngFor="let relation of projectRelations; let i = index" class="tr-hover" id="{{relation.disclosureDetailsId}}">
                    <td class="table-data border-end border-top-0 fw-600 px-3" [class.border-0]="i != projectRelations?.length-1">
                        <div class="m-0 mb-2 row py-1">
                            <span class="align-items-center d-flex">
                                <span class="entity-title mr-2 cursor-pointer clickable-content" (click)="openEntityDetails(relation?.personEntityRelationshipDto?.personEntityId)">
                                    <strong tabindex="0" [attr.aria-label]="'entity name'">
                                        <u>{{relation?.coiEntity?.entityName.length > 100 ?
                                            (relation?.coiEntity?.entityName | slice:0:100)+'...' : relation?.coiEntity?.entityName}}
                                        </u></strong>
                                </span>
                            </span>
                        </div>
                        <div class="d-flex flex-wrap fw-medium fs-13">
                            <em class="mt-3" *ngFor="let relation of getEntityRelationTypePills(relation?.personEntityRelationshipDto?.validPersonEntityRelType)">
                                    <span class="border px-3 py-1 rounded-4 me-2">
                                        <span class="fw-medium">{{relation?.relationshipType}} :</span>
                                        <span class="fw-normal">{{relation?.description}}</span>
                                    </span>
                            </em>
                        </div>
                        <div class="row mt-3 fw-medium fs-13">
                            <span class="d-flex align-items-center">
                                <span class="fs-13 mx-3">
                                    <span>Country:</span>&nbsp;{{relation?.personEntityRelationshipDto?.countryName}}</span>
                                <span class="fs-13 mx-3"> <span>Type:</span> &nbsp;{{relation?.personEntityRelationshipDto?.entityType}}
                                </span>
                            </span>
                        </div>
                    </td>
                    <td class="border-end border-top-0 px-3" [class.border-0]="i != projectRelations?.length-1">
                      <div class="p-3 person-card fs-13 grey-text word-break-all new-line-property">
                        <span *ngIf="!isReadMore[i] && relation?.disclComment?.comment?.length > 60; else showFullInfo">
                          <span> {{(relation?.disclComment?.comment | slice:0:60)}}</span>
                          <span (click)="isReadMore[i] = !isReadMore[i]" class="hand-cursor">... <strong><u>Read more</u></strong>
                          </span>
                        </span>
                        <ng-template #showFullInfo>
                          <span>{{relation?.disclComment?.comment}}</span>
                          <span *ngIf="relation?.disclComment?.comment?.length > 60" (click)="isReadMore[i] = !isReadMore[i]"
                            aria-hidden="true" class="hand-cursor"> <strong><u>Read Less</u></strong>
                          </span>
                        </ng-template>
                      </div>
                    </td>
                    <td class="border-end border-top-0 px-3 text-center text-nowrap" [class.border-0]="i != projectRelations?.length-1">
                      <span class="{{_commonService.getProjectDisclosureConflictStatusBadge(relation?.coiProjConflictStatusType?.projectConflictStatusCode)}}"></span>
                      <span class="badgeFont">
                        {{relation?.coiProjConflictStatusType?.description}}
                    </span>
                    </td>
                    <td class="border-0  border-top-0 pt-4 px-3" [class.border-0]="i!= projectRelations?.length-1">
                      <div class="d-flex">
                        <!-- reviewStatusCode-(3-Review In Progress, 4-Review Assigned, 5-Assigned review completed, 6-completed),  dispositionStatusCode(1-pending, 2-Approved)-->
                        <button *ngIf="(['3', '4', '5'].includes(coiDetails?.reviewStatusCode) && coiDetails?.dispositionStatusCode == 1) || (coiDetails?.reviewStatusCode== 6 && coiDetails?.dispositionStatusCode == 2)
                        && (_commonService.getCurrentUserDetail('userName') == coiDetails?.createUser || _commonService.getCurrentUserDetail('personId') == coiDetails?.adminPersonId)"
                        class="btn-primary-icon-svg me-1" type="button" (mouseenter)="isShowHoverWhite[i]= true"
                        (mouseout)="isShowHoverWhite[i]= false" (click)="isOpenSlider = true; setEntityDetails(relation, i);">
                        <span class="btn-secondary-svg"></span>
                      </button>
                      <button (click)="openReviewerComment(selectedProject,'RELATIONSHIP', relation)" class="add-activity-button comment-style align-items-center btn btn-primary-icon btn-sm d-flex p-0 px-2" id="add-activity" title="Comments" type="button">
                        <mat-icon>rate_review</mat-icon>
                      </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div *ngIf="!projectRelations.length">
                <app-no-information> </app-no-information>
              </div>
      </div>
</div>
<app-add-conflict-slider *ngIf="isOpenSlider" (closePage)="closePage($event)" [isOpenSlider]="isOpenSlider" [disclosureMetaData]="{coiPersonFullName: coiDetails?.person?.fullName}"
  [entityDetails]="entityDetails" [isEditMode]="['3','4','5'].includes(coiDetails?.reviewStatusCode) && coiDetails?.dispositionStatusCode == 1 && (_commonService.getCurrentUserDetail('personId') == coiDetails?.adminPersonId)"></app-add-conflict-slider>

