<ng-container *ngIf="isOpenSlider">
    <app-coi-slider (closeSlider)="hideConflictNavBar()" [elementId]="'add-conflict'" [isHeaderNeeded]="true" [isChangedFieldValue]="isFieldValueChanges()">
        <ng-container header id="coi-conflict-slider-header">
            <span>Relationship between SFIs and Projects</span>
            <app-common-help-text [subSectionId]="803" [elementId]="'coi-conflict-slider-header'"></app-common-help-text></ng-container>
        <ng-container content>
            <div class="p-3 coi-box-red border border-secondary border-opacity-50 mx-0 rounded-2 shadow-medium position-sticky z-2 custom-stickytop">
                <div class="row align-items-start">
                    <div class="col-auto col-xxl-9 d-flex">
                        <span
                            class="entity-status shadow-sm align-items-center d-flex text-nowrap {{getColorBadges(coiData?.coiDisclosure?.coiDisclosureFcoiType)}}">
                            <span>{{coiData?.coiDisclosure?.coiDisclosureFcoiType?.description}}</span>
                        </span>
                        <div class="d-flex mb-2 ps-md-1 mt-md-1 mt-xl-0">
                            <h4 class="mb-0 d-flex label-text f-16 coi-ms-n15px align-self-baseline flex-column">
                                <ng-container
                                    *ngIf="coiData?.coiDisclosure?.coiDisclosureFcoiType?.fcoiTypeCode== '2' || coiData?.coiDisclosure?.coiDisclosureFcoiType?.fcoiTypeCode === '3'"
                                    class="ms-1">
                                    <span class="title-text word-break-all new-line-property text-slice" [title]="entityDetails?.title">
                                        #{{entityDetails?.moduleItemId}} - {{entityDetails?.title}}
                                    </span>
                                </ng-container>
                                <div>
                                    <!-- Person Details -->
                                    <div class="d-flex align-items-center flex-wrap">
                                        <!-- Person Name -->
                                        <div *ngIf="disclosureMetaData?.coiPersonFullName" class="d-flex align-items-end me-3 mt-1">
                                            <mat-icon aria-hidden="true" class="fw-bolder coi-text-light flex-shrink-0 coi-mat-icon-size me-1">person</mat-icon>
                                            <span class="coi-text-light fs-14 text-slice" [title]="disclosureMetaData?.coiPersonFullName">
                                                {{disclosureMetaData?.coiPersonFullName}}
                                            </span>
                                        </div>
                                        <!-- Person Title -->
                                        <div *ngIf="coiData?.coiDisclosure?.personPrimaryTitle" class="d-flex align-items-end me-3 mt-1">
                                            <mat-icon aria-hidden="true" class="fw-bolder coi-text-light flex-shrink-0 coi-mat-icon-size me-1">work</mat-icon>
                                            <span class="coi-text-light fs-14 text-slice" [title]="coiData?.coiDisclosure?.personPrimaryTitle">{{coiData?.coiDisclosure?.personPrimaryTitle}}</span>
                                        </div>
                                        <!-- Person Department -->
                                        <div *ngIf="coiData?.coiDisclosure?.unit?.unitDetail" class="d-flex align-items-end me-3 mt-md-2 mt-lg-1">
                                            <mat-icon aria-hidden="true" class="fw-bolder coi-text-light flex-shrink-0 coi-mat-icon-size me-1">home</mat-icon>
                                            <span class="coi-text-light fs-14 text-slice" [title]="coiData?.coiDisclosure?.unit?.unitDetail">{{coiData?.coiDisclosure?.unit?.unitDetail}}</span>
                                        </div>
                                        <!-- Person Email -->
                                        <div *ngIf="coiData?.coiDisclosure?.personEmail" class="d-flex align-items-end mt-md-2 mt-xl-1">
                                            <mat-icon aria-hidden="true" class="fw-bolder coi-text-light flex-shrink-0 coi-mat-icon-size me-1">mail</mat-icon>
                                            <span class="coi-text-light fs-14 text-slice" [title]="coiData?.coiDisclosure?.personEmail">{{coiData?.coiDisclosure?.personEmail}}</span>
                                        </div>
                                    </div>
                                </div>
                            </h4>
                        </div>
                    </div>
                    <div class="col-12 col-xxl-3 d-flex justify-content-end gap-2 mb-md-2 mb-xxl-0">
                        <label class="coi-text-light d-block" for="coi-disclosure-risk-disclosure">Conflict status :</label>
                        <span class="coi-text-light fw-normal">
                            <app-no-data-label [valueToShow]="conflictHistory[0]?.conflictStatusCode">
                                <span class="badge {{_commonService.getProjectDisclosureConflictStatusBadgeForConfiltSliderStyleRequierment(conflictHistory[0]?.conflictStatusCode)}}">
                                    {{conflictHistory[0]?.conflictStatusDescription}}
                            </span>
                            </app-no-data-label>
                        </span>
                    </div>
                    <div class="col-12 mb-2">
                        <label class="d-block coi-text-dark" for="coi-conflict-card-sfi">Significant Financial Interest</label>
                            <app-no-data-label [valueToShow]="entityDetails?.entityName">
                            <span class="grey-text fw-500 text-slice" id="coi-conflict-card-sfi" [title]="entityDetails?.entityName">{{entityDetails?.entityName}}</span>
                        </app-no-data-label> 
                    </div>
                    <div class="col d-flex flex-wrap fw-medium fs-13 gap-2">
                        <ng-container class="mt-2" *ngFor="let relation of coiSummaryService.getEntityRelationTypePills(relationshipType)">
                            <span class="relationship-pill mb-md-2 mb-lg-2 mb-xl-0 px-2 py-1 border rounded-4 d-inline-block">
                                <span class="d-flex coi-purple-text">
                                    <mat-icon aria-hidden="true"
                                    class="flex-shrink-0 me-1">{{coiSummaryService.getIcon(relation?.relationshipType)}}</mat-icon>
                                    <span class="fw-bold">{{relation?.relationshipType}} :</span>
                                    <span class="fw-normal">{{relation?.description}}</span>
                                </span>
                            </span>
                        </ng-container>
                    </div>
                </div>
            </div>
            <div *ngIf="isEditMode" class="card shadow-sm p-3 mt-2">
                <div class="row">
                    <div class="col-md-12 col-xl-4">
                        <label class="fs-14 fw-500" for="select-conflict-status">
                            <span>Conflict Status</span>
                            <app-common-help-text [subSectionId]="803" [elementId]="'select-conflict-status'"></app-common-help-text>
                        </label>
                        <span>
                            <select class="form-control form-select" [(ngModel)]="conflictStatus" id="select-conflict-status"
                                [ngClass]="projectConflictValidationMap?.has('coiConflictStatusCode') || projectConflictValidationMap?.has('duplicateStatus')  ? 'is-invalid d-block' : ''"
                                (ngModelChange)="setCoiProjConflictStatusType()">
                                <option [value]=null>--Select--</option>
                                <option *ngFor="let status of conflictLookUpList" [value]="status.projectConflictStatusCode">
                                    {{status?.description}}</option>
                            </select>
                            <app-common-information [elementId]="'select-conflict-status'" [subSectionId]="803"></app-common-information>
                            <div *ngIf="projectConflictValidationMap?.has('coiConflictStatusCode')"
                                class="invalid-feedback d-block fs-12">
                                {{projectConflictValidationMap?.get('coiConflictStatusCode')}}
                            </div>
                            <div *ngIf="projectConflictValidationMap?.has('duplicateStatus')"
                                class="invalid-feedback d-block fs-12">
                                {{projectConflictValidationMap?.get('duplicateStatus')}}
                            </div>
                        </span>
                    </div>
                    <div class="col-md-12 col-xl-8">
                        <label class="fs-14 fw-500" for="coi-conflict-status-change">
                            <span>Describe the reason for Conflict status change</span>
                            <app-common-help-text [subSectionId]="803" [elementId]="'coi-conflict-status-change'"></app-common-help-text>
                        </label>
                        <textarea id="coi-conflict-status-change" class="form-control fs-14" placeholder="Description" row="1"
                            [(ngModel)]="comment" appAutoGrow rows="1" appLengthValidator [limit]="2000" [isShowLimiter]="true"
                            (ngModelChange)="comment = comment.trim()"
                            [ngClass]="projectConflictValidationMap?.has('comment') ? 'is-invalid d-block' : ''">
                        </textarea>
                        <app-common-information [elementId]="'coi-conflict-status-change'" [subSectionId]="803"></app-common-information>
                        <div *ngIf="projectConflictValidationMap?.has('comment')" class="invalid-feedback d-block fs-12">
                            {{projectConflictValidationMap?.get('comment')}}
                        </div>
                    </div>
                    <div class="col-12 mt-2">
                        <button type="button" class="btn btn-primary float-end fs-14"
                            (click)="updateProjectRelationship()">Save</button>
                        <button type="button" class="btn btn-outline-secondary float-end mr-10"
                            (click)="clearConflictModal()">Clear</button>
                    </div>
                </div>
            </div>

            <!-- Conflict History -->
            <div class="mt-2" id="" tabindex="0">
                <h3 class="d-flex align-items-center fs-16"><strong>Conflict History</strong>
                    <span class="d-inline-block" data-bs-toggle="tooltip" data-bs-placement="top">
                    </span>
                </h3>
            </div>

            <div class="card" id="conflict-history">
                <div class="card-content">
                    <div class="card-body">
                            <ng-container *ngIf="conflictHistory.length > 0;else noData">
                                <ul class="timeline">
                                    <li *ngFor="let historyEntry of conflictHistory;let index = index; let last = last;">
                                        <div tabindex="-1">
                                            <span class="badge me-2 {{_commonService.getProjectDisclosureConflictStatusBadgeForConfiltSliderStyleRequierment(historyEntry?.conflictStatusCode)}}">
                                            {{historyEntry?.conflictStatusDescription}}</span>
                                            <i class="fa fa-user coi-text-light fs-16 me-1" aria-hidden="true"></i>
                                            <span class="fw-700 fs-14">{{historyEntry?.updateUserFullName}}</span>
                                            <span class="coi-text-lighter fs-13"> {{historyEntry?.updateTimestamp | dateFormatterWithTimeZone:'long'}}</span>
                                        </div>
                                        <p class="coi-text-light pt-3 pb-4" tabindex="-1">
                                            <span class="fs-14">
                                                <mat-icon class="format_quote">format_quote</mat-icon>
                                                <span *ngIf="!isReadMore[index] && historyEntry?.comment?.length > 230; else showFullInfo" class="fst-italic">
                                                    <span> {{(historyEntry?.comment | slice:0:230)}}</span>
                                                    <span (click)="isReadMore[index] = !isReadMore[index]" class="hand-cursor"><span
                                                            class="fw-medium">... <u>Read more</u>
                                                            <i aria-hidden="true"></i></span>
                                                    </span>
                                                </span>
                                                <ng-template #showFullInfo>
                                                    <span class="fst-italic">{{historyEntry?.comment}}</span>
                                                    <span *ngIf="historyEntry?.comment?.length > 230"
                                                        (click)="isReadMore[index] = !isReadMore[index]" aria-hidden="true"
                                                        class="hand-cursor"><span class="fw-medium"> <u>Read Less</u>
                                                            <i aria-hidden="true"></i></span>
                                                    </span>
                                                </ng-template>
                                            </span>
                                        </p>
                                    </li>
                                </ul>
                            </ng-container>
                    </div>
                </div>
            </div>
            <!-- <ng-container *ngIf="conflictHistory.length > 0;else noData">
                <ng-container *ngFor="let historyEntry of conflictHistory;let index = index;let last = last;">
                    <div class="row mx-2">
                        <div class="col-1 mr-15" [class.timeline]="!last" style="position: relative">
                            <span
                                class="badge rounded-pill badge-width {{_commonService.getProjectDisclosureConflictStatusBadgeForConfiltSliderStyleRequierment(historyEntry?.conflictStatusCode)}}">
                                {{historyEntry?.conflictStatusDescription}}</span>
                        </div>
                        <div class="col pb-4 mx-auto comment-box-height">
                            <div class="align-items-center ml-5 mx-0">
                                <span class="d-flex align-items-center text-muted">
                                    <i class="fa fa-user grey-text fs-16" aria-hidden="true"></i>
                                    <label class="fw-700 fs-14 ml-2">{{historyEntry?.updateUserFullName}}</label>
                                    <span class="ml-15 fs-12">{{historyEntry?.updateTimestamp |
                                        dateFormatterWithTimeZone:'long'}}</span></span>
                                <div class="coi-text-light">
                                    <mat-icon class="format_quote">format_quote</mat-icon>
                                    <span
                                        *ngIf="!isReadMore[index] && historyEntry?.comment?.length > 230; else showFullInfo">
                                        <span> {{(historyEntry?.comment | slice:0:230)}}</span>
                                        <span (click)="isReadMore[index] = !isReadMore[index]" class="hand-cursor"><span
                                                class="fw-medium">... <u>Read more</u>
                                                <i aria-hidden="true"></i></span>
                                        </span>
                                    </span>
                                    <ng-template #showFullInfo>
                                        <span>{{historyEntry?.comment}}</span>
                                        <span *ngIf="historyEntry?.comment?.length > 230"
                                            (click)="isReadMore[index] = !isReadMore[index]" aria-hidden="true"
                                            class="hand-cursor"><span class="fw-medium"> <u>Read Less</u>
                                                <i aria-hidden="true"></i></span>
                                        </span>
                                    </ng-template>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>
            </ng-container> -->
            <ng-template *ngIf="isEmptyHistory()">
                <app-no-information></app-no-information>
            </ng-template>
        </ng-container>
        <ng-container confirmation-content>
            You have unsaved changes in the <strong>Project - SFI relations</strong>, do you want to leave?
        </ng-container>
    </app-coi-slider>
</ng-container>
