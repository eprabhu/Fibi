<div class="card" #relationShipOverlay [class.overlay]="isShowDetails">
  <div @enterAnimation *ngIf="isShowDetails" class="row fixed-tree">
    <app-slider-close-btn (click)="hideSfiNavBar()"></app-slider-close-btn>
    <div class="relationship-content overflow-visible">
      <div class="col-12 d-flex align-items-center" *ngIf="selectedProject?.moduleCode == 3">
        <span class="active-ribbon shadow-sm align-items-center d-flex ps-2"><span class="px-2">Proposal</span></span>
        <p class="entity-title">
            <span class="fw-600 fs-16">{{selectedProject?.moduleItemId}} - {{selectedProject?.title}} </span>
        </p>
      </div>
      <div class="col-12 d-flex align-items-center" *ngIf="selectedProject?.moduleCode == 1">
        <span class="active-ribbon shadow-sm align-items-center d-flex ps-2">Award</span>
        <p class="entity-title">
            <span class=" fw-600 fs-16">#{{selectedProject?.moduleItemKey}} - {{selectedProject?.title}} </span>
        </p>
      </div>
        <div class="card outer-card scrollable-table">
              <div class="row m-2">
              <div class="col-4">
                <label class="label-text">Principal Investigator :</label>
                <span class="ml-2 grey-text">{{selectedProject?.principalInvestigator}}</span>
              </div>
              <div class="col-8">
                <label class="label-text">Sponsor :</label>
                <span class="ml-2 grey-text">{{selectedProject?.sponsor}}</span>
              </div>
              <div class="col-4">
                <label class="label-text">Period :</label>
                <span class="ml-2 grey-text">{{selectedProject?.startDate | dateFormatter}} - {{selectedProject?.endDate | dateFormatter}}</span>
              </div>
              <div class="col-8">
                <label class="label-text">Prime Sponsor :</label>
              <span *ngIf="selectedProject?.primeSponsor" class="ml-2 grey-text">{{selectedProject?.primeSponsor}}</span>
              <span *ngIf="!selectedProject?.primeSponsor" class="noDataExists">--No Data--</span>
              </div>
              <div class="col-4">
                <label class="label-text">Proposal Status : </label>
                <span class="ml-2 grey-text">{{selectedProject?.moduleStatus}}</span>
              </div>
              <div class="col-8">
                <label class="label-text">Lead Unit :</label>
              <span class="ml-2 grey-text" *ngIf="selectedProject?.unitName">{{selectedProject?.unitNumber}} - {{selectedProject?.unitName}}</span>
              <span *ngIf="!selectedProject?.unitName" class="noDataExists">No Lead Unit exist</span>
              </div>
              </div>
              <div class="inner-card border-0 card m-2" *ngIf="isEditMode">
                <div class="row m-2">
                  <br>
                  <div class="col-2">
                    <span class="mandatory">*</span>
                    <label for="COI_Status_dropdown" class="fw-500 fs-14">COI Status
                      <span class="d-inline-block" data-bs-toggle="tooltip" title="Update your conflict status." data-bs-placement="top">
                        <mat-icon class="me-2 info-icon" data-bs-toggle="tooltip">info</mat-icon>
                      </span>
                    </label>
                    <div>
                      <select id="COI_Status_dropdown" [(ngModel)]="coiStatusCode"
                      class="form-control select-default">
                      <option [value]=null>--Select--</option>
                      <option [value]="status.projectConflictStatusCode" *ngFor="let status of coiStatusList">
                          {{status?.description}}</option>
                      </select>
                    </div>
                    <span class="invalid-feedback" *ngIf="coiValidationMap.get('coiStatus')">
                      {{coiValidationMap.get('coiStatus')}}
                    </span>
                  </div>
                  <div class="col">
                    <label for="coi_description" class="fw-500 fs-14">Define Project - SFI Relation
                      <span class="d-inline-block" data-bs-toggle="tooltip" title="Briefly describe the relationship between the project and SFI." data-bs-placement="top">
                        <mat-icon class="me-2 info-icon" data-bs-toggle="tooltip">info</mat-icon></span>
                    </label>
                    <!-- [(ngModel)]="coiDescription" -->

                    <textarea class="form-control comment-text-box textarea-height" id="coi_description"
                    [(ngModel)]="coiDescription" appAutoGrow rows="2"
                    placeholder="Provide your description here" maxlength="2000" spellcheck="false"></textarea>
                  </div>
                  <div class="col-auto button-align" *ngIf="entityProjectDetails?.length > 0">
                    <!-- data-bs-toggle="modal" data-bs-target="#applyToAllConfirmationModal" -->
                <button type="button" class="btn btn-outline-secondary mr-10 btn-sm" id="clear all entities coi status and description" (click)="openClearConfirmationModal()">Clear All</button>
                <button type="button" class="btn btn-primary btn-sm fs-14" id="apply common coi status and description and save"(click)="openSaveAllConfirmationModal()">Apply & Save</button>
                  </div>
                </div>
              </div>
              <div class="fixed-header mb-5">
                <table class="table tableSkin m-2 fs-14 fw-medium " *ngIf="entityProjectDetails?.length > 0">
                  <!-- <caption class="sr-only">List of Awards/Proposal</caption> -->
                  <thead class="fixed-th">
                      <tr class="header-border table-secondary">
                        <th class="col-4">Significant Financial Interest</th>
                        <th class="col-2"> <span class="mandatory">*</span>COI Status</th>
                        <th class="col-3">Define Project - SFI Relation</th>
                        <th class="col-3"  *ngIf="isEditMode" class="text-center">Actions</th>
                      </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let test of entityProjectDetails; let i = index">
                      <td class="table-data border-end fw-600">
                        <div class="mt-3 fs-15" [title]="test?.personEntity?.coiEntity?.entityName">
                          {{test?.personEntity?.coiEntity?.entityName?.length > 100 ? (test?.personEntity?.coiEntity?.entityName | slice:0:100)+'...' : test?.personEntity?.coiEntity?.entityName}}
                        </div>
                        </td>
                      <td class="border-end">
                        <select [(ngModel)]="test.projectConflictStatusCode"
                        class="form-control select-default" [disabled]="!isEditMode">
                        <option value=null>--Select--</option>
                        <option [value]="status.projectConflictStatusCode" *ngFor="let status of coiStatusList; let i = index">
                            {{status?.description}}</option>
                        </select>
                        <!-- <span class="invalid-feedback" *ngIf="coiTableValidation.get('clear'+i)">
                          {{coiTableValidation.get('clear'+i)}}
                        </span> -->
                        <div>
                          <span class="invalid-feedback" *ngIf="coiTableValidation.get('save'+i)">
                            {{coiTableValidation.get('save'+i)}}
                          </span>
                        </div>
                      </td>
                      <td class="border-end">
                        <textarea class="form-control comment-text-box textarea-height" id="main-panel-comnt"
                        appAutoGrow [(ngModel)]="test.disclComment.comment"
                        [disabled]="!isEditMode" rows="2"
                        placeholder="Provide your description here" maxlength="2000" spellcheck="false"></textarea>
                      </td>
                      <td *ngIf="isEditMode">
                        <button type="button" class="btn btn-outline-secondary btn-sm mr-10" id="clear {{test?.personEntity?.coiEntity?.entityName}} coi status and description" (click)="openClearModal(i)"
                        >Clear</button>
                        <button type="button" class="btn btn-primary btn-sm fs-14" id="save {{test?.personEntity?.coiEntity?.entityName}} coi status and description" (click)="saveSingleEntity(i, test)"
                        >Save</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
                <div *ngIf="entityProjectDetails?.length == 0">
                  <app-no-information> </app-no-information>
                </div>
        </div>
    </div>
  </div>
</div>

<button type="button" class="btn btn-primary btn-sm" hidden=true id="hidden-clear-all-button" data-bs-toggle="modal" data-bs-target="#clearConfirmationModal"></button>
<div class="modal fade" id="clearConfirmationModal" tabindex="-1" aria-labelledby="clearConfirmationModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fs-16" id="exampleModalLabel">Confirmation</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body fs-14">
        <p>Do you want to clear all the data entered?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">No</button>
        <button type="button" class="btn btn-primary fs-14" (click)="clearAll()" data-bs-dismiss="modal">Yes</button>
      </div>
    </div>
  </div>
</div>

<button type="button" class="btn btn-primary btn-sm" hidden=true id="hidden-save-all-button" data-bs-toggle="modal" data-bs-target="#applyToAllConfirmationModal"></button>
<div class="modal fade" id="applyToAllConfirmationModal" tabindex="-1" aria-labelledby="applyToAllConfirmationModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fs-16" id="exampleModalLabel">Confirmation</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="fs-14">Do want to update all your Project - SFI relations?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary w-14" data-bs-dismiss="modal">No</button>
        <button type="button" class="btn btn-primary fs-14" (click)="applyToAll()" data-bs-dismiss="modal">Yes</button>
      </div>
    </div>
  </div>
</div>

<button type="button" class="btn btn-primary btn-sm" hidden=true id="hidden-single-clear-button" data-bs-toggle="modal" data-bs-target="#singleClearConfirmationModal"></button>
<div class="modal fade" id="singleClearConfirmationModal" tabindex="-1" aria-labelledby="singleClearConfirmationModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fs-16" id="exampleModalLabel">Confirmation</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body fs-14">
        <p>Do you want to clear the data of <span class="fw-600"> {{entityProjectDetails && entityProjectDetails[clearIndex] && entityProjectDetails[clearIndex]?.personEntity?.coiEntity?.entityName}} </span> values?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">No</button>
        <button type="button" class="btn btn-primary fs-14" (click)="clearSingleEntity()" data-bs-dismiss="modal">Yes</button>
      </div>
    </div>
  </div>
</div>
