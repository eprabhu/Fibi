<div class="card" #relationShipOverlay [class.overlay]="isShowDetails">
  <div @enterAnimation *ngIf="isShowDetails" class="fixed-tree">
    <app-slider-close-btn (click)="hideSfiNavBar()"></app-slider-close-btn>
    <div class="relationship-content overflow-visible">
      <div class="card">
        <div class="col-12 d-flex" *ngIf="selectedProject?.moduleCode == 3">
          <span class="active-ribbon shadow-sm align-items-center d-flex ps-2"><span class="px-2">Proposal</span></span>
          <p class="entity-title">
              <span class="fw-600 fs-16">{{selectedProject?.moduleItemId}} - {{selectedProject?.title}} </span>
          </p>
        </div>
        <div class="col-12 d-flex" *ngIf="selectedProject?.moduleCode == 1">
          <span class="active-ribbon shadow-sm align-items-center d-flex ps-2">Award</span>
          <p class="entity-title">
              <span class=" fw-600 fs-16">#{{selectedProject?.moduleItemKey}} - {{selectedProject?.title}} </span>
          </p>
        </div>
        <div class="row m-2">
          <div class="col-4">
            <label class="label-text">Principal Investigator :</label>
            <span class="ml-2 grey-text">{{selectedProject?.principalInvestigator}}</span>
          </div>
          <div class="col-8">
            <label class="label-text">Sponsor :</label>
            <span class="ml-2 grey-text">{{selectedProject?.sponsor}}</span>
          </div>
          <div class="col-4">
            <label class="label-text">Period :</label>
            <span class="ml-2 grey-text">{{selectedProject?.startDate | dateFormatter}} - {{selectedProject?.endDate | dateFormatter}}</span>
          </div>
          <div class="col-8">
            <label class="label-text">Prime Sponsor :</label>
          <span *ngIf="selectedProject?.primeSponsor" class="ml-2 grey-text">{{selectedProject?.primeSponsor}}</span>
          <span *ngIf="!selectedProject?.primeSponsor" class="noDataExists">--No Data--</span>
          </div>
          <div class="col-4">
            <label class="label-text">{{selectedProject?.moduleCode == 3 ? 'Proposal' : 'Award'}} Status : </label>
            <span class="ml-2 grey-text">{{selectedProject?.moduleStatus}}</span>
          </div>
          <div class="col-8">
            <label class="label-text">Lead Unit :</label>
          <span class="ml-2 grey-text" *ngIf="selectedProject?.unitName">{{selectedProject?.unitNumber}} - {{selectedProject?.unitName}}</span>
          <span *ngIf="!selectedProject?.unitName" class="noDataExists">No Lead Unit exist</span>
          </div>
          </div>
      </div>
      <div class="row fs-14 mt-2 mx-0 grey-info d-flex position-relative" *ngIf="isEditMode">
        <span data-bs-toggle="tooltip" title="Update your conflict status." data-bs-placement="top" class="d-inline-block ng-tns-c100-5">
          <mat-icon role="img" class="mat-icon notranslate me-2 info-icon ng-tns-c100-5 material-icons mat-ligature-font mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font">info</mat-icon></span>
      <div class="info-text">
        1. For marking all your SFI conflict status/ relationship description use "Apply and Save".
        <br> 2. For marking individual SFI conflict status/ relationship description use "Save".
      </div>
    </div>
        <div class="card outer-card scrollable-table mt-2">
              <div class="fixed-header mb-5">
                <table class="tableSkin fs-14 fw-medium " *ngIf="entityProjectDetails?.length > 0">
                  <caption class="sr-only">List of Awards/Proposal</caption>
                  <thead class="fixed-th">
                      <tr class="header-border table-secondary">
                        <th class="col-4" style="width: 30%;">
                          <div [class.margin-top-23]="isEditMode">
                            Significant Financial Interest
                          </div>
                        </th>
                        <th class="col-2" style="width: 15%;"> 
                          <div [class.mb-20]="isEditMode" [class.mt-2]="isEditMode">
                            <span class="mandatory">*</span>
                            COI Status
                            <select *ngIf="isEditMode" id="COI_Status_dropdown" [(ngModel)]="coiStatusCode"
                            class="form-control select-default">
                            <option [value]=null>--Select--</option>
                            <option [value]="status.projectConflictStatusCode" *ngFor="let status of coiStatusList">
                              {{status?.description}}</option>
                            </select>
                          </div>
                        </th>
                        <th class="col-3" style="width: 30%;">
                          <div [class.mb-2]="isEditMode" [class.mt-2]="isEditMode">
                            Define Project - SFI Relation
                            <textarea *ngIf="isEditMode" class="form-control comment-text-box textarea-height" id="coi_description"
                            [(ngModel)]="coiDescription" appAutoGrow  appLengthValidator rows="2"
                            placeholder="Describe the Project SFI relationship" [limit]=2000 spellcheck="false"></textarea>
                          </div>
                        </th>
                        <th class="col-3" style="width: 9%;"*ngIf="isEditMode" class="text-center">
                          <button type="button" class="btn btn-primary btn-sm fs-14" id="apply common coi status and description and save"(click)="openSaveAllConfirmationModal()">Apply & Save</button>
                        </th>
                      </tr>
                  </thead>
                  <tbody>
                    
                    <tr *ngFor="let test of entityProjectDetails; let i = index">
                      <td class="table-data border-end fw-600">
                        <div class="mt-3 fs-15" [title]="test?.personEntity?.coiEntity?.entityName">
                          {{test?.personEntity?.coiEntity?.entityName?.length > 100 ? (test?.personEntity?.coiEntity?.entityName | slice:0:100)+'...' : test?.personEntity?.coiEntity?.entityName}}
                        </div>
                        </td>
                      <td class="border-end">
                        <select [(ngModel)]="test.projectConflictStatusCode"
                        class="form-control select-default" [disabled]="!isEditMode">
                        <option value=null>--Select--</option>
                        <option [value]="status.projectConflictStatusCode" *ngFor="let status of coiStatusList; let i = index">
                            {{status?.description}}</option>
                        </select>
                        <!-- <span class="invalid-feedback" *ngIf="coiTableValidation.get('clear'+i)">
                          {{coiTableValidation.get('clear'+i)}}
                        </span> -->
                        <div>
                          <span class="invalid-feedback" *ngIf="coiTableValidation.get('save'+i)">
                            {{coiTableValidation.get('save'+i)}}
                          </span>
                        </div>
                      </td>
                      <td class="border-end">
                        <div class="area-position">
                          <textarea  class="form-control comment-text-box textarea-height" id="main-panel-comnt"
                          appAutoGrow [(ngModel)]="test.disclComment.comment"
                          [disabled]="!isEditMode" rows="2" appLengthValidator
                          placeholder="Describe the Project SFI relationship" [limit]=2000 spellcheck="false"></textarea>
                        </div>
                      </td>
                      <td *ngIf="isEditMode">
                        <!-- <button type="button" class="btn btn-outline-secondary btn-sm mr-10" id="clear {{test?.personEntity?.coiEntity?.entityName}} coi status and description" (click)="openClearModal(i)"
                        >Clear</button> -->
                        <button type="button" class="btn btn-primary btn-sm fs-14" id="save {{test?.personEntity?.coiEntity?.entityName}} coi status and description" (click)="saveSingleEntity(i, test)"
                        >Save</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
                <div *ngIf="entityProjectDetails?.length == 0">
                  <app-no-information> </app-no-information>
                </div>
        </div>
    </div>
  </div>
</div>

<button type="button" class="btn btn-primary btn-sm" hidden=true id="hidden-clear-all-button" data-bs-toggle="modal" data-bs-target="#clearConfirmationModal"></button>
<div class="modal fade" id="clearConfirmationModal" tabindex="-1" aria-labelledby="clearConfirmationModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fs-16" id="exampleModalLabel">Confirmation</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body fs-14">
        <p>Do you want to clear all the data entered?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">No</button>
        <button type="button" class="btn btn-primary fs-14" (click)="clearAll()" data-bs-dismiss="modal">Yes</button>
      </div>
    </div>
  </div>
</div>

<button type="button" class="btn btn-primary btn-sm" hidden=true id="hidden-save-all-button" data-bs-toggle="modal" data-bs-target="#applyToAllConfirmationModal"></button>
<div class="modal fade" id="applyToAllConfirmationModal" tabindex="-1" aria-labelledby="applyToAllConfirmationModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fs-16" id="exampleModalLabel">Confirmation</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="fs-14">Do you want to update all your Project - SFI relations?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary w-14" data-bs-dismiss="modal">No</button>
        <button type="button" class="btn btn-primary fs-14" (click)="applyToAll()" data-bs-dismiss="modal">Yes</button>
      </div>
    </div>
  </div>
</div>

<button type="button" class="btn btn-primary btn-sm" hidden=true id="hidden-single-clear-button" data-bs-toggle="modal" data-bs-target="#singleClearConfirmationModal"></button>
<div class="modal fade" id="singleClearConfirmationModal" tabindex="-1" aria-labelledby="singleClearConfirmationModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fs-16" id="exampleModalLabel">Confirmation</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body fs-14">
        <p>Do you want to clear the data of <span class="fw-600"> {{entityProjectDetails && entityProjectDetails[clearIndex] && entityProjectDetails[clearIndex]?.personEntity?.coiEntity?.entityName}} </span> values?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">No</button>
        <button type="button" class="btn btn-primary fs-14" (click)="clearSingleEntity()" data-bs-dismiss="modal">Yes</button>
      </div>
    </div>
  </div>
</div>
