<!-- Location -->
<div class="card mb-3">
    <div class="card-header px-4 py-2 ">
					<h4 class="card-title review-title">
                        <div class="justify-content-between row d-flex align-items-center">
                            <div class="col">Assigned Review</div>
                            <div *ngIf="coiService.isCOIAdministrator && coiDisclosure?.coiReviewStatusType?.reviewStatusCode === '3'" class="col-auto me-2">
                                <button (click)="clearReviewModal()" class="btn btn-primary fs-14 btn-sm mt-0 justify-content-center d-flex align-items-center" data-bs-toggle="modal"
                                    title="Add Review Location" data-bs-target="#add-location-modal">
                                    <mat-icon class="me-2">person_add</mat-icon>
                                    Assign Reviewer
                                </button>
                            </div>    
                            <button (click)="isCollapsed = !isCollapsed" title="Click here to collapse / expand"
                                class="toggle-header-btn align-items-center bg-white border btn d-flex justify-content-center p-0 rounded-5 shadow-sm">
                                <mat-icon>{{!!isCollapsed? 'expand_less' : 'expand_more'}}</mat-icon>
                            </button>
                               
                            <!-- <button class=" updown-arrow mt-1" (click)="isCollapsed = !isCollapsed">
                                <i [ngClass]="!isCollapsed?'fa-large fa fa-angle-double-down':'fa-large fa fa-angle-double-up'"
                                    class="fa-large" aria-hidden="true"></i>
                            </button> -->
                            
                        </div>
                    </h4>
    </div>
    <div class="card-body" *ngIf="isCollapsed">
        <div *ngIf="!reviewerList?.length">
            <div class="noDataExists">
                <div class="no-data-container">
                    <span class="no-data-icon-outer">
                        <div class="no-data-icon">
                            <i aria-hidden="true" class="fa fa-file-o"></i>
                            <i aria-hidden="true" class="fa fa-times-circle-o"></i>
                        </div>
                    </span>
                    <h4>There is no information in this section.</h4>
                </div>
            </div>
        </div>
        <table *ngIf="reviewerList?.length" class=" table tableSkin">
            <caption class="sr-only">Review</caption>
            <thead>
                <tr>
                    <th scope="col-2" class="px-3">
                        Reviewers
                    </th>
                    <th scope="col-3" style="width:30%" class="px-3">
                        Description
                    </th>
                    <th scope="col-2" class="px-3">
                        Assigned On
                    </th>
                    <th scope="col-3" class="px-3">
                        Status
                    </th>
                    <th scope="col-2" class="text-end table-actions-margin">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let reviewer of reviewerList; let index = index">
                    <td class="table-data fw-600">{{reviewer?.assigneePersonName}}</td>
                    <td>
                        <app-no-data-label [valueToShow]="reviewer?.description"></app-no-data-label>
                    </td>
                    <td>{{reviewer?.createTimestamp | dateFormatterWithTimeZone: 'long' }}
                    </td>

                    <td>
                      <span [class.text-black]="reviewer?.reviewStatusTypeCode == '1'" class="fw-medium badge bg-{{getReviewStatusBadge(reviewer?.coiReviewStatus?.reviewStatusCode)}} fs-14 rounded-5">
                      {{reviewer?.coiReviewStatus?.description}}
                      </span>
                    </td>
                    <td class="d-flex align-items-center justify-content-end">
                        <ng-container *ngIf="isMangeReviewAction">
                            <button *ngIf="reviewer.reviewStatusTypeCode == '1'" 
                                class="btn-primary-icon d-flex align-items-center me-3 my-1" title="Start review">
                                <mat-icon id="start-review-btn" title="Start review" class="material-icons-outlined"
                                    (click)="updateCoiReviewStage(index,reviewer,'START')">play_circle_filled</mat-icon>
                            </button>
                            <button *ngIf="reviewer.reviewStatusTypeCode == '3'"
                                class="btn-primary-icon d-flex align-items-center me-3 my-1" title="Start review">
                                <mat-icon id="complete-review-btn" title="Complete Review" class="material-icons-outlined"
                                    (click)="updateCoiReviewStage(index,reviewer,'COMPLETE')">stop_circle</mat-icon>
                            </button>
                        </ng-container>
                            <button class="btn-primary-icon d-flex align-items-center me-3 my-1" [ngClass]="{'review-comment-position':!isMangeReviewAction}" (click)="modifyReviewComment(reviewer.coiReviewId)">
                                <mat-icon title="Click here to add review comment">rate_review</mat-icon>
                            </button>
                            <!-- more actions -->
                            
                            <!-- <ng-container *ngIf="isMangeReviewAction">
                                <button  *ngIf="reviewer.reviewStatusTypeCode == '1'" mat-button [matMenuTriggerFor]="beforeMenu"
                                    class="btn-primary-icon d-flex align-items-center my-1"
                                    type="button" id="dropdownMenuButton" data-bs-toggle="dropdown"
                                    title="More Actions" aria-expanded="false">
                                    <mat-icon class="btn-color">more_vert</mat-icon>
                                </button>
                            </ng-container> -->
                            <!-- <li *ngIf="review.reviewStatusTypeCode == '1'" class="hand-cursor" title="Start Review">
                                                <a class="dropdown-item" data-bs-toggle="modal"
                                                    data-bs-target="#coi-start-review"
                                                    (click)="modifyIndex = index;reviewActionConfirmation = review">
                                                    <i class="fa fa-play-circle me-2 fs-2" aria-hidden="true"> </i>
                                                    <span>Start Review</span>
                                                </a>
                                            </li
                                            <li class="hand-cursor" title="Add Review Comment">
                                                <a class="dropdown-item add-activity-button" (click)="modifyReviewComment()">
                                                    <mat-icon class="me-2" title="Click here to add review comment">rate_review</mat-icon>
                                                    <span>Add Review Comment</span>
                                                </a>
                                            </li>-->
                                            <!-- <li *ngIf="review.reviewStatusTypeCode == '2'" class="hand-cursor" title="Complete Review">
                                              <a class="dropdown-item"
                                                  data-bs-toggle="modal" data-bs-target="#CompleteReviewModal"
                                                  (click)="modifyIndex = index;reviewActionConfirmation = review">
                                                  <i class="fa fa-stop-circle-o me-2 fs-2" aria-hidden="true">
                                                  </i>
                                                  <span>Complete Review</span>
                                              </a>
                                          </li> -->
                            <mat-menu #beforeMenu="matMenu" xPosition="before">
                                <button class=" text-nowrap border-0 rounded-0 btn btn-outline-grey fs-14 d-flex justify-content-start w-100 align-items-center py-2 px-3"
                                    id="edit-location-btn" data-bs-toggle="modal" data-bs-target="#add-location-modal"
                                    (click)="editReview(reviewer, index)">
                                    <mat-icon class="me-2 more-options-icon">edit</mat-icon>
                                    <span>Edit Review</span>
                                </button>
                                <button class="text-nowrap border-0 rounded-0 btn btn-outline-grey fs-14 d-flex justify-content-start w-100 align-items-center py-2 px-3"
                                    id="delete-Review-btn" data-bs-toggle="modal" data-bs-target="#deleteReviewModal"
                                    (click)="modifyIndex = index;reviewActionConfirmation = reviewer">
                                    <mat-icon class="me-2 more-options-icon">delete</mat-icon>
                                    <span>Delete Review</span>
                                </button>
                            </mat-menu> 
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<!-- Review Ends-->
<!-- DELETE MEMBER WARNING MODAL -->
<div class="modal modal-coi modal-coi fade mySkinDialog modal-opacity" tabindex="-1" id="deleteReviewModal"
    tabindex="-1" role="dialog" aria-labelledby="deleteModalTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Review</h5>
                <button aria-label="Close" class="btn-close fs-12" data-bs-dismiss="modal" id="dissmiss-btn"
                    type="button">
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this review?</p>
            </div>
            <div class="modal-footer">
                <button id="prop-project-close-btn" type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal"
                    data-bs-toggle="modal">Cancel</button>
                <button id="prop-project-team-delete-btn" type="button" class="btn btn-primary fs-14"
                    (click)="deleteReview()" data-bs-dismiss="modal">Delete</button>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-coi fade mySkinDialog" id="add-location-modal" role="dialog" aria-labelledby="skippedSchedulesTitle"
    aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{ modifyIndex != -1 ? 'Edit Reviewer' : 'Assign Reviewer' }} for
                  <ng-container  *ngIf="coiDisclosure?.fcoiTypeCode == '1'">
                    #{{coiDisclosure?.disclosureNumber}} : FCOI Disclosure By {{coiDisclosure?.person?.fullName}}
                  </ng-container>
                  <ng-container  *ngIf="coiDisclosure?.fcoiTypeCode !== '1'">
                    #{{coiDisclosure?.disclosureNumber}} : {{coiDisclosure?.coiDisclosureFcoiType?.description}} Disclosure [{{projectDetail?.moduleItemId}} :
                    {{(projectDetail?.title)?.length>20 ?
                    (projectDetail?.title | slice:0: 10)+'...' :
                    projectDetail?.title}}] By {{coiDisclosure?.person?.fullName}}
                  </ng-container></h5>
                <button type="button" title="Close" class="btn-close fs-12" data-bs-dismiss="modal" aria-label="Close"
                    (click)="reviewDetails = {}">
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-12 col-12">
                        <label class="d-block">Reviewer</label>
                        <app-elastic [options]="personElasticOptions" [clearField]="assigneeClearField"
                                     [isError]="validationMap.has('reviewer')"
                            [placeHolder]="'Search Reviewer'" (selectedResult)="assigneeSelect($event)">
                        </app-elastic>
                        <div *ngIf="validationMap?.has('reviewer')" class="invalid-feedback d-block fs-13">
                            {{validationMap?.get('reviewer')}}
                        </div>
                    </div>
                    <div class="ms-2" *ngIf="validationMap.has('general')">
                        <span class="mandatory d-inline-block">{{validationMap.get('general')}}</span>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-12">
                        <label class="block-display">
                            Description</label>
                        <textarea [(ngModel)]="reviewDetails.description" appLengthValidator [isShowLimiter]="true"
                            [limit]="2000" rows="2" class="form-control"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-secondary fs-14" data-bs-dismiss="modal" id="agreement-approve-close"
                    type="button" title="Close" (click)="clearReviewModal();">Close</button>
                <button id="agreement-approve-disapprove-btn" class="btn btn-primary fs-14"
                    (click)="saveOrUpdateCoiReview();" type="button" [title]="modifyIndex != -1 ? 'Update Reviewer' : 'Add Reviewer'">
                    {{ modifyIndex != -1 ? 'Update Reviewer' : 'Add Reviewer' }}
                </button>
            </div>
        </div>
    </div>
</div>
<span (click)="clearReviewModal()" id="add-review-modal-trigger" data-bs-target="#add-location-modal"
    data-bs-toggle="modal" class="d-none"></span>
