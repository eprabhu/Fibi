<!-- Location -->
<div class="card mb-3">
    <div class="card-header px-4 py-2 ">
        <h4 class="card-title review-title">
            <div class="justify-content-between row">
                <div class="col-auto">Review List</div>
                <div class="col-auto">
                    <button *ngIf="coiDisclosure?.reviewStatusTypeCode == '2'" class="btn btn-tertiary btn-sm mt-0 button-right" data-bs-toggle="modal"
                        title="Add Review Location" data-bs-target="#add-location-modal">
                        Add Review
                    </button>
                </div>
                <button class="updown-arrow mt-1" (click)="isCollapsed = !isCollapsed">
                    <i [ngClass]="!isCollapsed?'fa-large fa fa-angle-double-down':'fa-large fa fa-angle-double-up'"
                        class="fa-large" aria-hidden="true"></i>
                </button>
            </div>
        </h4>
    </div>
    <div class="card-body" *ngIf="isCollapsed">
        <div *ngIf="!reviewList?.length">
            <div class="noDataExists">
                <div class="no-data-container">
                    <span class="no-data-icon-outer">
                        <div class="no-data-icon">
                            <i aria-hidden="true" class="fa fa-file-o"></i>
                            <i aria-hidden="true" class="fa fa-times-circle-o"></i>
                        </div>
                    </span>
                    <h4>There is no information in this section.</h4>
                </div>
            </div>
        </div>
        <table *ngIf="reviewList?.length" class=" table tableSkin">
            <caption class="sr-only">Review</caption>
            <thead>
                <tr>
                    <th scope="col">
                        <span>Admin Group</span>
                    </th>
                    <th scope="col">
                        <span>Reviewers</span>
                    </th>
                    <th scope="col" style="width:30%">
                        <span>Description</span>
                    </th>
                    <th scope="col">
                        <span>Assigned On</span>
                    </th>
                    <th scope="col">
                        <span>Status</span>
                    </th>
                    <th scope="col" class="text-right">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let review of reviewList; let index = index">
                    <td>{{review?.adminGroup?.adminGroupName}}</td>
                    <td>{{review?.assigneePersonName}}</td>
                    <td>{{review?.description}}</td>
                    <td>{{review?.createTimestamp | dateFormatterWithTimeZone: 'long' }}
                    </td>
                    <td>
                        <span class="fw-700 text-{{getReviewStatusBadge(review?.coiReviewStatus?.reviewStatusTypeCode)}}">
                            {{review?.coiReviewStatus?.description}}
                        </span>
                    </td>
                    <td class="text-right">
                        <ul class="actionButtonGroup" style="position: relative;">
                            <li *ngIf="review.reviewStatusTypeCode == '1'" class="hand-cursor" title="Start review">
                                <a id="start-review-btn" data-bs-toggle="modal"
                                    data-bs-target="#coi-start-review"
                                    (click)="modifyIndex = index;reviewActionConfirmation = review">
                                    <i class="fa fa-play-circle" aria-hidden="true"> </i>
                                </a>
                            </li>
                            <li *ngIf="review.reviewStatusTypeCode == '2'" class="hand-cursor" title="Complete Review">
                                <a id="complete-review-btn" data-bs-toggle="modal"
                                    data-bs-target="#CompleteReviewModal"
                                    (click)="modifyIndex = index;reviewActionConfirmation = review">
                                    <i class="fa fa-stop-circle-o" aria-hidden="true">
                                    </i>
                                </a>
                            </li>
                            <li class="hand-cursor mx-4 position-relative top-7">
                                <a (click)="modifyReviewComment(review.coiReviewId)">
                                    <mat-icon title="Click here to add review comment">rate_review</mat-icon>
                                </a>
                            </li>

                            <li>
                                <span class="d-inline-block dropdown">
                                    <button class="btn btn-sm dropdown-toggle icons-toggle more-btn list-more-btn ml-1"
                                        type="button" id="dropdownMenuButton" data-bs-toggle="dropdown"
                                        title="More Actions" aria-expanded="false">
                                        <i aria-hidden="true" class="fa fa-ellipsis-v"></i>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-right action-dropdown-menu"
                                        aria-labelledby="dropdownMenuButton">
                                        <ul class="location-options">
                                            <li *ngIf="review.reviewStatusTypeCode == '1'" class="hand-cursor" title="Start Review">
                                                <a class="dropdown-item" data-bs-toggle="modal"
                                                    data-bs-target="#coi-start-review"
                                                    (click)="modifyIndex = index;reviewActionConfirmation = review">
                                                    <i class="fa fa-play-circle mr-2" aria-hidden="true"> </i>
                                                    <span>Start Review</span>
                                                </a>
                                            </li>
                                            <li *ngIf="review.reviewStatusTypeCode == '2'" class="hand-cursor" title="Complete Review">
                                                <a class="dropdown-item"
                                                    data-bs-toggle="modal" data-bs-target="#CompleteReviewModal"
                                                    (click)="modifyIndex = index;reviewActionConfirmation = review">
                                                    <i class="fa fa-stop-circle-o mr-2" aria-hidden="true">
                                                    </i>
                                                    <span>Complete Review</span>
                                                </a>
                                            </li>
                                            <li class="hand-cursor" title="Add Review Comment">
                                                <a class="dropdown-item add-activity-button" (click)="modifyReviewComment()">
                                                    <mat-icon title="Click here to add review comment">rate_review</mat-icon>
                                                    <span>Add Review Comment</span>
                                                </a>
                                            </li>
                                            <li *ngIf="review.reviewStatusTypeCode == '1'" title="Edit Review" class="hand-cursor">
                                                <a class="dropdown-item" id="edit-location-btn"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#add-location-modal"
                                                    (click)="editReview(review, index)">
                                                    <i class="fa fa-pencil mr-2" aria-hidden="true"></i>
                                                    <span>Edit Review</span>
                                                </a>
                                            </li>
                                            <li *ngIf="review.reviewStatusTypeCode == '1'" title="Delete Review" class="hand-cursor">
                                                <a class="dropdown-item" id="delete-Review-btn"
                                                    data-bs-toggle="modal" data-bs-target="#deleteReviewModal"
                                                    (click)="modifyIndex = index;reviewActionConfirmation = review">
                                                    <i class="fa fa-trash-o mr-2" aria-hidden="true"></i>
                                                    <span>Delete Review</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </span>
                            </li>
                        </ul>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<!-- Review Ends-->
<!-- DELETE MEMBER WARNING MODAL -->
<div class="modal modal-coi modal-coi fade mySkinDialog modal-opacity" tabindex="-1" id="deleteReviewModal" tabindex="-1" role="dialog"
    aria-labelledby="deleteModalTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Review</h5>
                <button id="prop-dlt-member-dismiss" type="button" class="close btn m-0" data-bs-dismiss="modal"
                    aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this review?</p>
            </div>
            <div class="modal-footer">
                <button id="prop-project-close-btn" type="button" class=" btn-secondary btn-sm" data-bs-dismiss="modal"
                    data-bs-toggle="modal">Cancel</button>
                <button id="prop-project-team-delete-btn" type="button" class="btn btn-outline-primary fs-14"
                    (click)="deleteReview()" data-bs-dismiss="modal">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Complete review modal -->
<div class="modal modal-coi fade mySkinDialog" id="CompleteReviewModal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Complete Review by {{reviewActionConfirmation?.assigneePersonName ? reviewActionConfirmation?.assigneePersonName : reviewActionConfirmation?.adminGroup?.adminGroupName}}
                </h4>
                <button type="button" class="close btn m-0" data-bs-dismiss="modal" id="dissmiss-btn" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row mt-2 mb-0">
                    <div class="col-lg-12">
                        <p>Are you sure you want to complete this review?</p>
                    </div>
                </div>
                <!-- <div class="row">
                    <div class="col-12 my-0">
                        <label>Comments</label>
                        <textarea class="form-control" appLengthValidator [isShowLimiter]="true" [limit]="4000"
                            [(ngModel)]="completeReviewObject.agreementNote.note"></textarea>
                    </div>
                </div> -->
            </div>
            <div class="modal-footer">
                <button id="nego-sumbit-no-btn" type="button" class="btn btn-outline-secondary fs-14"
                    data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-outline-primary fs-14" (click)="completeReview()"
                    data-bs-dismiss="modal">Complete</button>
            </div>
        </div>
    </div>
</div>

<!-- Start Review Modal -->
<div class="modal modal-coi fade mySkinDialog" id="coi-start-review" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Start Review by {{reviewActionConfirmation?.assigneePersonName ? reviewActionConfirmation?.assigneePersonName : reviewActionConfirmation?.adminGroup?.adminGroupName}}
                </h4>
                <button type="button" class="close btn m-0" data-bs-dismiss="modal" id="dissmiss-btn" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row mt-2 mb-0">
                    <div class="col-lg-12">
                        <p class="f-14">Are you sure you want to start this review?</p>
                    </div>
                </div>
                <!-- <div class="row">
                    <div class="col-12 my-0">
                        <label>Comments</label>
                        <textarea class="form-control" appLengthValidator [isShowLimiter]="true" [limit]="4000"></textarea>
                    </div>
                </div> -->
            </div>
            <div class="modal-footer">
                <button id="nego-sumbit-no-btn" type="button" class="btn btn-outline-secondary fs-14"
                    data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-outline-primary fs-14" (click)="startCOIReview()"
                    data-bs-dismiss="modal">Start Review</button>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-coi fade mySkinDialog" id="add-location-modal" role="dialog" aria-labelledby="skippedSchedulesTitle"
    aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{ modifyIndex != -1 ? 'Edit Review' : 'Add Review' }} for {{coiDisclosure?.coiDisclosureCategoryType?.description}} by {{disclosurePerson?.fullName}}</h5>
                <button type="button" class="close btn m-0" data-bs-dismiss="modal" aria-label="Close"
                    (click)="reviewDetails = {}">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div id="locationId" class="col-lg-6 col-sm-12 col-12">
                        <label class="d-block">Admin Group</label>
                        <app-autocompleter [completerOptions]="adminGroupsCompleterOptions"
                            [clearField]="categoryClearFiled" [placeHolder]="'Search for Admin Group'"
                            (onSelect)="adminGroupSelect($event)">
                        </app-autocompleter>
                    </div>
                    <div class="col-lg-6 col-sm-12 col-12">
                        <label class="d-block">Assignee</label>
                        <app-elastic [options]="personElasticOptions" [clearField]="assigneeClearField"
                            [placeHolder]="'Search Assignee'" (selectedResult)="assigneeSelect($event)">
                        </app-elastic>
                    </div>
                    <div class="ml-2" *ngIf="validationMap.has('reviewer')">
                        <span class="mandatory d-inline-block">{{validationMap.get('reviewer')}}</span>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-12">
                        <label class="block-display">
                            Description</label>
                        <textarea [(ngModel)]="reviewDetails.description" appLengthValidator [isShowLimiter]="true" [limit]="2000"
                            rows="2" class="form-control"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-secondary fs-14" data-bs-dismiss="modal" id="agreement-approve-close" type="button"
                    (click)="reviewDetails = {}; modifyIndex = -1">Close</button>
                <button id="agreement-approve-disapprove-btn" class="btn btn-outline-primary fs-14"
                    (click)="saveOrUpdateCoiReview();" type="button">
                    {{ modifyIndex != -1 ? 'Update' : 'Add' }}
                </button>
            </div>
        </div>
    </div>
</div>
