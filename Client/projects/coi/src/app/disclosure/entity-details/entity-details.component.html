
<app-view-relationship-details [isShowHeader]="true" [updateRelationshipDetails]="updateRelationshipDetails" [entityId]="entityId"
        [isEditMode]="isEditMode" [entityDetails]="entityDetails" [deleteRelationshipEvent]="deleteRelationshipEvent"
        [isTriggeredFromSlider]="isTriggeredFromSlider" (closeEntityInfoCard)="closeSlider($event)"></app-view-relationship-details>

<div class="d-flex">
    <nav class="border-nav bg-white border br-bottom d-flex fs-15 fw-bold mt-3 ms-5 shadow-sm user-dashboard-nav">
      <ng-container *ngIf="entityDetailService.definedRelationships?.length">
        <ng-container *ngFor="let coiFinancialEntityDetail of entityDetailService.definedRelationships;let last = last">
          <div
            (click)="openRelationshipQuestionnaire(coiFinancialEntityDetail);"
            class="text-secondary p-10 border-end" role="button"
            [ngClass]="(entityDetailService.selectedTab === 'QUESTIONNAIRE') && 
            (entityDetailService.activeRelationship === coiFinancialEntityDetail?.validPersonEntityRelType?.personEntityRelType.relationshipTypeCode) ? 'navigation-icons':''">
            <span title="Click to view {{coiFinancialEntityDetail?.validPersonEntityRelType?.personEntityRelType?.description}} Questionnaire"
              [ngClass]="entityDetailService.selectedTab === 'QUESTIONNAIRE' && entityDetailService.activeRelationship === coiFinancialEntityDetail?.validPersonEntityRelType?.personEntityRelType.relationshipTypeCode?'active fw-500':''"
              class="active r-title px-3 py-3">
              {{coiFinancialEntityDetail?.validPersonEntityRelType?.personEntityRelType?.description}}
              <span id="qnr-complete-msg"
                *ngIf="entityDetailService.relationshipCompletedObject[coiFinancialEntityDetail?.validPersonEntityRelType?.relationshipTypeCode]"
                class="fa fa-check" title="Completed">
              </span>
              <span id="qnr-incomplete-msg"
                *ngIf="!entityDetailService.relationshipCompletedObject[coiFinancialEntityDetail?.validPersonEntityRelType?.relationshipTypeCode]"
                class="fa fa-exclamation-circle" title="Incomplete">
              </span>
            </span>
            </div>
        </ng-container>
      </ng-container>
      <div *ngIf="isEditMode && entityDetailService.canMangeSfi" class="pt-1 mt-2 px-4 border-end"  
      [ngClass]="isHoverAddRelationship?'text-primary':'text-secondary'"
      (mouseover)="isHoverAddRelationship = true" (mouseout)="isHoverAddRelationship = false"  role="button" (click)="saveOrAddRelationshipModal()">
        <span class="px-2 d-flex align-items-center">
          <mat-icon class="material-icons-outlined mr-2">add_circle_outline</mat-icon>
          <span>Add Relationship</span>
        </span>
      </div>  
    </nav>
    <nav class="border-nav bg-white border br-bottom d-flex fs-15 fw-bold mt-3 ms-auto shadow-sm user-dashboard-nav">
      <div class="text-secondary navigation-icons p-10 border-end cursor-pointer" (click)="openRelationDetails()">
        <span title="Click to view Relationship Details" class="r-title px-3 py-3 fw-500" [class.active]="entityDetailService.selectedTab === 'RELATIONSHIP_DETAILS'">
          Relationship Details
        </span>
        </div>
        <div class="text-secondary navigation-icons p-10 cursor-pointer" (click)="entityDetailService.selectedTab = 'HISTORY'">
          <span title="Click to view History" class="r-title px-3 py-3 fw-500" [class.active]="entityDetailService.selectedTab == 'HISTORY'">
          History        
          </span>
          </div>
    </nav>
  </div>
  <app-sfi-history *ngIf="entityDetailService.selectedTab === 'HISTORY'" [entityId]="entityId"></app-sfi-history>

<div *ngIf="entityDetailService.selectedTab === 'RELATIONSHIP_DETAILS'">
    <app-view-relationship-details [isShowHeader]="false" [updateRelationshipDetails]="updateRelationshipDetails" [entityId]="entityId"
        [isEditMode]="isEditMode" [entityDetails]="entityDetails" [deleteRelationshipEvent]="deleteRelationshipEvent"
        [isTriggeredFromSlider]="isTriggeredFromSlider" (closeEntityInfoCard)="closeSlider($event)"></app-view-relationship-details>
</div>
<div *ngIf="entityDetailService.selectedTab === 'QUESTIONNAIRE'">
    <app-entity-questionnaire (mouseout)="entityDetailService.isHoverEntityCard = false" [entityId]="entityId"
        id="focusQuestionnaire" (updateRelationship)="updateRelationship($event)" [isEditMode]="isEditMode"
        (positionsToView)="scrollPosition($event)" (emitLeaveModal)="showQuestionnaireLeaveConfirmationModal($event)"
        [isSwitchCurrentTab]="isSwitchCurrentTab"
        (deleteRelationshipEvent)="emittedDeletedRelationship($event)">
    </app-entity-questionnaire>
</div>

<button type="button" class="btn btn-primary btn-sm" hidden=true id="hidden-unsaved-changes-button" data-bs-toggle="modal"
    data-bs-target="#hiddenUnsavedChanges"></button>
<div class="modal modal-coi fade mySkinDialog" id="hiddenUnsavedChanges" role="dialog" aria-labelledby="hiddenUnsavedChanges"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirmation</h5>
                <button type="button" id="prop-saveExit-dismiss-btn" class="btn-close fs-12"
                data-bs-dismiss="modal"
                    aria-label="Close" (click)="closeUnsavedChangesModal()">
                </button>
            </div>
            <div class="modal-body">
                <p>You have unsaved changes in 
                <strong> 
                    <ng-container *ngFor="let section of entityDetailService.unSavedSections; let isLast = last;">{{section}} <ng-container *ngIf="!isLast">, </ng-container></ng-container>
                </strong>.
                </p>
                <span class="fs-14"><p>Do you want to leave the page?</p></span>
            </div>
            <div class="modal-footer mx-2">
                <button type="button" class="btn btn-outline-secondary" (click)="fullPageNavigationLeavePage();">Leave Page</button>
                <button type="button" class="btn btn-primary btn-sm fs-14" (click)="closeUnsavedChangesModal()">Stay On Page</button>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-coi fade mySkinDialog" id="questionnaireUnsavedChanges" role="dialog" aria-labelledby="hiddenUnsavedChanges"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirmation</h5>
                <button type="button" id="prop-saveExit-dismiss-btn" class="btn-close fs-12"
                data-bs-dismiss="modal" aria-label="Close">
                </button>
            </div>
            <div class="modal-body">
                <p>You have unsaved changes in <strong>{{questionnaireSection}}</strong>.
                </p>
                <span class="fs-14"><p>Do you want to leave the page?</p></span>
            </div>
            <div class="modal-footer mx-2">
                <button type="button" class="btn btn-outline-secondary" (click)="questionnaireChangeModalLeaveTab();">Leave Page</button>
                <button type="button" class="btn btn-primary btn-sm fs-14" data-bs-dismiss="modal">Stay On Page</button>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-coi fade mySkinDialog" id="relationDetailsUnSavedChanges" role="dialog" aria-labelledby="hiddenUnsavedChanges"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirmation</h5>
                <button type="button" id="prop-saveExit-dismiss-btn" class="btn-close fs-12"
                data-bs-dismiss="modal" aria-label="Close">
                </button>
            </div>
            <div class="modal-body">
                <p>You have unsaved changes in <strong>Relationship Details</strong>.
                </p>
                <span class="fs-14"><p>Do you want to leave the page?</p></span>
            </div>
            <div class="modal-footer mx-2">
                <button type="button" class="btn btn-outline-secondary" (click)="relationDetailsLeavePage();">Leave Page</button>
                <button type="button" class="btn btn-primary btn-sm fs-14" data-bs-dismiss="modal">Stay On Page</button>
            </div>
        </div>
    </div>
</div>

<app-concurrency-warning-modal *ngIf="entityDetailService.concurrentUpdateAction" [sectionName]="entityDetailService.concurrentUpdateAction" (closePage)="cancelConcurrency()"></app-concurrency-warning-modal>
