<div class="row mx-0 sticky-0 px-4" id="sfi-top-card">
    <div class="card shadow-sm" [ngClass]="!isTriggeredFromSlider ? 'col-9' : 'col-12'">
        <div class="d-flex" >
            <span class="entity-status shadow-sm align-items-center d-flex ps-2 mt-4" tabindex="0"
                (mouseout)="entityDetailsServices.isHoverEntityCard = false"
                [ngClass]="sfiStatus ==='Active'?'':(sfiStatus === 'Inactive'?'inactive-pill':'draft-pill')">
                <span class="px-2">{{sfiStatus}}</span></span>
            <div class="fw-bold fs-18 mt-2 px-3 cursor-pointer d-flex align-items-center" tabindex="0"
                [ngClass]="{'text-primary':entityDetailsServices.isHoverEntityCard}"
                (mouseover)="entityDetailsServices.isHoverEntityCard = true">
                <span>{{entityDetails?.entityName}}</span>
                <mat-icon class="cursor-pointer hyper-link py-1 entity-down-arrow">arrow_drop_down</mat-icon>
            </div>
            <div class="info-text fs-14 ms-auto italian px-3 py-0 mt-4 mb-2 cursor-pointer" tabindex="0"
                title="Click to view latest version" *ngIf="relationshipsDetails?.versionStatus == 'ARCHIVE'"
                (click)="openRelationDetails()">
                <i class="fa fa-exclamation-triangle mr-2" aria-hidden="true"></i>
                SFI modified
            </div>
        </div>
        <hr>
        <div class="row my-3 px-4" (mouseout)="entityDetailsServices.isHoverEntityCard = false">
            <div class="col-4" tabindex="0">
                <label class="d-block fw-500 fs-14 pb-1 label-text" aria-label="Start Date of Involvement">Start Date Of Involvement</label>
                <app-no-data-label [classesToApply]="'fs-14'" [valueToShow]="relationshipsDetails.involvementStartDate">
                    <span class="text-color fs-14" aria-label="relationshipsDetails.involvementStartDate | dateFormatterWithTimeZone">{{relationshipsDetails.involvementStartDate |
                        dateFormatterWithTimeZone}}</span>
                </app-no-data-label>
            </div>
            <div class="col-4" tabindex="0">
                <label class="d-block fw-500 fs-14 pb-1 label-text">End Date Of Involvement</label>
                <app-no-data-label [classesToApply]="'fs-14'" [valueToShow]="relationshipsDetails.involvementEndDate">
                    <span class="text-color fs-14">{{relationshipsDetails.involvementEndDate |
                        dateFormatterWithTimeZone}}</span>
                </app-no-data-label>
            </div>
            <div class="col-4" tabindex="0">
                <label class="d-block fw-500 fs-14 pb-1 label-text">Sponsors Research</label>
                <span class="text-color fs-14">{{relationshipsDetails?.sponsorsResearch?'Yes':'No'}}</span>
            </div>
            <div class="col-12" tabindex="0">
                <label class="d-block fw-500 fs-14 pb-1 label-text mt-3">Relationship</label>
                <app-no-data-label [valueToShow]="entityDetailsServices.definedRelationships">
                    <span class="pill-container">
                        <em *ngFor="let coiFinancialEntityDetail of entityDetailsServices.definedRelationships;let isLast = last">
                            <span class="relationship-pill border px-3 py-1 rounded-4 me-2 fs-14">
                                <span>
                                    {{coiFinancialEntityDetail?.validPersonEntityRelType?.description}}
                                    <span id="qnr-complete-msg"
                                        *ngIf="entityDetailsServices.relationshipCompletedObject[coiFinancialEntityDetail?.validPersonEntityRelType?.validPersonEntityRelTypeCode]"
                                        class="fa fa-check" title="Completed">
                                    </span>
                                    <span id="qnr-incomplete-msg"
                                        *ngIf="!entityDetailsServices.relationshipCompletedObject[coiFinancialEntityDetail?.validPersonEntityRelType?.validPersonEntityRelTypeCode]"
                                        class="fa fa-exclamation-circle" title="Incomplete">
                                    </span>
                                </span>
                            </span>
                        </em>
                    </span>
                </app-no-data-label>
            </div>
        </div>
        <div *ngIf="entityDetailsServices.isHoverEntityCard" class="row entity-box shadow-lg  fs-13 rounded m-0">
            <div class="py-1">
                <span class="d-flex px-3 pb-2" tabindex="0">
                    <span class="fw-500 col-custom-width">Entity</span>:
                    <app-no-data-label [classesToApply]="'fs-13 px-3'" [valueToShow]="entityDetails?.entityName">
                        <span class="px-3 d-flex">{{entityDetails?.entityName}}</span>
                    </app-no-data-label>
                </span>
                <span class="d-flex px-3 pb-2" tabindex="0">
                    <span class="fw-500 col-custom-width">Country</span>:
                    <app-no-data-label [classesToApply]="'fs-13 px-3'"
                        [valueToShow]="entityDetails?.country?.countryName">
                        <span class="px-3 d-flex">{{entityDetails?.country?.countryName}}</span>
                    </app-no-data-label>
                </span>
                <span class="d-flex px-3 pb-2" tabindex="0">
                    <span class="fw-500 col-custom-width">City</span>:
                    <app-no-data-label [classesToApply]="'fs-13 px-3'" [valueToShow]="entityDetails?.city">
                        <span class="px-3 d-flex">
                            {{entityDetails?.city}}
                        </span>
                    </app-no-data-label>
                </span>
                <span class="d-flex px-3 pb-2" tabindex="0">
                    <span class="fw-500 col-custom-width">Website</span>:
                    <app-no-data-label [classesToApply]="'fs-13 px-3'" [valueToShow]="entityDetails?.webURL">
                        <a class="px-3 anchor-link d-flex"
                            (click)="redirectUrl(entityDetails?.webURL)">{{entityDetails?.webURL}}</a>
                    </app-no-data-label>
                </span>
                <span class="d-flex px-3 pb-2" tabindex="0">
                    <span class="fw-500 col-custom-width">Email</span>:
                    <app-no-data-label [classesToApply]="'fs-13 px-3'" [valueToShow]="entityDetails?.emailAddress">
                        <span class="px-3 d-flex">
                            {{entityDetails?.emailAddress}}
                        </span>
                    </app-no-data-label>
                </span>
                <span class="d-flex px-3" tabindex="0">
                    <span class="fw-500 col-custom-width">Phone</span>:
                    <app-no-data-label [classesToApply]="'fs-13 px-3'" [valueToShow]="entityDetails?.phone">
                        <span class="px-3 d-flex">
                            {{entityDetails?.phone}}
                        </span>
                    </app-no-data-label>
                </span>
            </div>
            <div *ngIf="commonService.getAvailableRight(['MANAGE_ENTITY', 'VIEW_ENTITY'], 'SOME')"
                class="d-flex justify-content-end align-items-end ml-15" tabindex="0">
                <span class="d-flex" [class.text-primary]="isHoverCardViewMore" (mouseover)="isHoverCardViewMore = true"
                    (mouseout)="isHoverCardViewMore = false" (click)="viewEntityDetails()">
                    <span class="anchor-link">View</span>
                    <mat-icon class="fs-13 pt-2 hand-cursor">arrow_forward_ios</mat-icon>
                </span>
            </div>
        </div>
    </div>
    <div class="col-3 card px-0 shadow-sm" *ngIf="!isTriggeredFromSlider"
        [ngClass]="isEditMode?'':'side-action-bar'"
        (mouseout)="entityDetailsServices.isHoverEntityCard = false"
        [class.custom-margin]="isQuestionnaireCompleted && sfiStatus == 'Draft'">
        <div class="d-flex flex-column p-0 h-100">
            <div class="flex-fill action-bar-border bg-white shadow-sm">
                <div *ngIf="entityDetailsServices.canMangeSfi && relationshipsDetails.versionStatus !== 'ARCHIVE' ;else noMangeRights"
                    class="mt-3 mx-3 d-flex justify-content-around"
                    [class.px-1]="(sfiStatus =='Draft' || sfiStatus =='Inactive') && isEditMode">
                    <button *ngIf="sfiStatus =='Active' && !isEditMode;else noRightDesign2" tabindex="0"
                        class="btn btn-outline-grey pb-0 col-2" title="Go to COI home page" (click)="goToHome()">
                        <mat-icon>home</mat-icon>
                    </button>
                    <ng-template #noRightDesign2>
                        <button class="btn btn-outline-grey pb-0 col-6 me-2" title="Go to COI home page" tabindex="0"
                            (click)="goToHome()">
                            <mat-icon>home</mat-icon>
                            <span class="fs-14 mx-1 btn-content-home">Home</span>
                        </button>
                    </ng-template>
                    <button *ngIf="sfiStatus =='Active' && !isEditMode && entityDetailsServices.canMangeSfi"
                        id="btn-sfi-modify"
                        class="fs-14 btn btn-outline-grey d-flex justify-content-center w-100 align-items-center mx-3"
                        title="Click to Modify SFI" (click)="modifySfi()">
                        <mat-icon class="pencil-sfi">mode</mat-icon>
                        <span class="btn-sfi-position">Modify SFI</span>
                    </button>
                    <button *ngIf="sfiStatus =='Active' && !isEditMode;else noRightDesign3"
                        class="btn btn-outline-grey fs-14 col-2 pb-0" (click)="navigateBack()" title="Back">
                        <i class="fa fa-reply justify-content-center align-items-center fs-14"></i>
                    </button>
                    <ng-template #noRightDesign3>
                        <button class="btn btn-outline-grey fs-14 col-6 py-2" (click)="navigateBack()" tabindex="0"
                            title="Click to go back to Entity list">
                            <i class="fa fa-reply justify-content-center align-items-center fs-14"></i>
                            <span class="fs-14 mx-2 btn-content-back">Back</span>
                        </button>
                    </ng-template>
                </div>
                <ng-template #noMangeRights>
                    <div class="mt-3 mx-3 d-flex justify-content-around px-1">
                        <button class="btn btn-outline-grey pb-0 col-6 me-2" title="Go to COI home page" tabindex="0"
                            (click)="goToHome()">
                            <mat-icon>home</mat-icon>
                            <span class="fs-14 mx-1 btn-content-home">Home</span>
                        </button>
                        <button class="btn btn-outline-grey fs-14 col-6 py-2" (click)="navigateBack()" tabindex="0"
                            title="Click to go back to Entity list">
                            <i class="fa fa-reply justify-content-center align-items-center fs-14"></i>
                            <span class="fs-14 mx-2 btn-content-back">Back</span>
                        </button>
                    </div>
                </ng-template>
                <div *ngIf="isEditMode" class="d-flex justify-content-around mt-3 mx-3">
                    <button (click)="saveRelationship()" tabindex="0"
                        class="fs-14 btn btn-outline-grey d-flex justify-content-center w-100 align-items-center"
                        title="Click to save">
                        <mat-icon class="me-2">save</mat-icon>
                        <span>Save</span>
                    </button>
                </div>
                <ng-container *ngIf="relationshipsDetails.versionStatus !== 'ARCHIVE'" tabindex="0">
                    <div *ngIf="entityDetailsServices.canMangeSfi && sfiStatus ==='Active' && !isEditMode"
                        class="d-flex justify-content-around mt-3 mx-3">
                        <button id="btn-inactivate"
                            class="fs-14 btn btn-outline-grey d-flex justify-content-center w-100 align-items-center"
                            title="Click to Inactivate Sfi'" (click)="activateInactivateSfi()">
                            <mat-icon class="mx-1 icon-schedule-position">schedule</mat-icon>
                            <span class="btn-inactivate-content">
                                Inactivate
                            </span>
                        </button>
                    </div>
                    <div *ngIf="entityDetailsServices.canMangeSfi && isQuestionnaireCompleted &&  
          (sfiStatus ==='Inactive' || sfiStatus == 'Draft')" class="d-flex justify-content-around mt-3 mx-3" tabindex="0">
                        <button id="btn-activate"
                            class="fs-14 btn btn-outline-grey d-flex justify-content-center w-100 align-items-center"
                            title="Click to activate Sfi" (click)="activateInactivateSfi()">
                            <i class="fa fa-bolt fs-18 fw-700  py-1" aria-hidden="true"
                                [ngClass]="isEditMode ? 'pl-15': 'icon-activate-position'"></i>
                            <span [ngClass]="isEditMode ?'btn-activate-edit-content':'btn-activate-content'">
                                Activate
                            </span>
                        </button>
                    </div>
                </ng-container>
                <div class="my-2 ml-2 fs-14 ash-text wrapping-text px-2" tabindex="0">
                    <div><span class="fw-medium me-1">Last Updated By :</span></div>
                    <app-no-data-label [classesToApply]="'fs-14'" [valueToShow]="relationshipsDetails?.updateTimestamp">
                        <span class=" fs-14"> {{relationshipsDetails?.updateUserFullName}} On
                            {{(relationshipsDetails?.updateTimestamp|dateFormatterWithTimeZone:'long')}} </span>
                    </app-no-data-label>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="d-flex nav-sticky pl-15 ml-15 mb-3 pt-0" id="sfi-nav-bar" [class.slider-background]="isTriggeredFromSlider">
    <nav class="border-nav bg-white border br-bottom d-flex fs-14 fw-bold shadow-sm user-dashboard-nav
        d-flex align-items-center mt-3 py-1 d-inline-block w-100">
        <div class="text-secondary header-icons border-end cursor-pointer" (click)="openRelationShipSection()"
            tabindex="0">
            <span title="Click to view SFI Details" class="px-4 fw-500"
                [class.active]="entityDetailsServices.selectedTab === 'RELATIONSHIP_DETAILS'"
                [attr.aria-label]="entityDetailsServices.selectedTab === 'RELATIONSHIP_DETAILS' ? 'Selected tab is SFI details' : 'Click to view SFI Details'">
                SFI Details
            </span>
        </div>
        <div class="text-secondary header-icons border-end cursor-pointer"
            (click)="entityDetailsServices.selectedTab = 'QUESTIONNAIRE'" tabindex="0">
            <span title="Click to view Relationship Details" class="px-4 fw-500"
                [class.active]="entityDetailsServices.selectedTab === 'QUESTIONNAIRE'"
                [attr.aria-label]="entityDetailsServices.selectedTab === 'QUESTIONNAIRE' ? 'Selected tab is Relationship Details' : 'Click to view Relationship Details'">
                Relationship Details
            </span>
        </div>
        <div class="text-secondary header-icons border-end cursor-pointer" tabindex="0">
            <span title="Click to view History" class="px-4 fw-500" (click)="openHistorySection();"
                [class.active]="entityDetailsServices.selectedTab === 'HISTORY'"
                [attr.aria-label]="entityDetailsServices.selectedTab === 'HISTORY' ? 'Selected tab is SFI History' : 'Click to view SFI History'">
                History
            </span>
        </div>
    </nav>
</div>

<div *ngIf="entityDetailsServices.selectedTab === 'QUESTIONNAIRE'">
    <div class="row" *ngIf="entityDetailsServices.definedRelationships?.length">
        <div class="col-3 pe-0 ps-4">
            <div class="card side-panel-margin">
                <div class="card-body p-0">
                        <div *ngIf="isEditMode && entityDetailsServices.canMangeSfi && entityDetailsServices.availableRelationships?.length" 
                            class="py-3 border-bottom" tabindex="0" [ngClass]="isHoverAddRelationship?'text-primary':'text-secondary'"
                            role="button">
                            <span class="px-2 d-flex align-items-center active fw-500 justify-content-end"
                                (mouseover)="isHoverAddRelationship = true" (mouseout)="isHoverAddRelationship = false"
                                (click)="saveOrAddRelationshipModal()">
                                <mat-icon class="material-icons-outlined mr-2">add</mat-icon>
                                <span class="mr-2 fs-15">Add Relationship</span>
                            </span>
                        </div>
            
                <ng-container
                    *ngFor="let coiFinancialEntityDetail of entityDetailsServices.definedRelationships;let isLast = last">
                    <div (click)="openRelationshipQuestionnaire(coiFinancialEntityDetail);"
                        class="text-secondary nav-options row mx-0 border-bottom" role="button" [class.border-end]="!isLast"
                        [ngClass]="(entityDetailsServices.selectedTab === 'QUESTIONNAIRE') && 
              (entityDetailsServices.activeRelationship === coiFinancialEntityDetail?.validPersonEntityRelType?.validPersonEntityRelTypeCode) ? 'navigation-icons':''">
                        <span
                            title="Click to view {{coiFinancialEntityDetail?.validPersonEntityRelType?.description}} Questionnaire"
                            [ngClass]="entityDetailsServices.selectedTab === 'QUESTIONNAIRE' && entityDetailsServices.activeRelationship === coiFinancialEntityDetail?.validPersonEntityRelType?.validPersonEntityRelTypeCode?'relation-active fw-500':''"
                            class="relation-border-left r-title px-3 py-3 d-flex justify-content-between align-items-center">
                            <span class="fs-14" tabindex="0">
                                <span id="qnr-complete-msg"
                                    *ngIf="entityDetailsServices.relationshipCompletedObject[coiFinancialEntityDetail?.validPersonEntityRelType?.validPersonEntityRelTypeCode]"
                                    class="fa fa-check me-2" title="Completed">
                                </span>
                                <span id="qnr-incomplete-msg"
                                    *ngIf="!entityDetailsServices.relationshipCompletedObject[coiFinancialEntityDetail?.validPersonEntityRelType?.validPersonEntityRelTypeCode]"
                                    class="fa fa-exclamation-circle me-2" title="Incomplete">
                                </span>
                                {{coiFinancialEntityDetail?.validPersonEntityRelType?.description}}
                            </span>
                            <span *ngIf="isEditMode && entityDetailsServices.canMangeSfi" class="delete_outline justify-content-center d-inline-flex align-items-center"
                                tabindex="0" aria-label="delete" role="button">
                                <mat-icon data-bs-toggle="modal" data-bs-target="#deleteRelationModal" 
                                (click)="deleteRelationshipDetails = coiFinancialEntityDetail">delete_outline</mat-icon>
                        </span>
                        </span>
                    </div>
                </ng-container>
                <app-no-information *ngIf="!entityDetailsServices.definedRelationships.length"></app-no-information>
                </div>
            </div>
        </div>
        <div class="col-9">
            <app-entity-questionnaire (mouseout)="entityDetailsServices.isHoverEntityCard = false" [entityId]="entityId"
                id="focusQuestionnaire" (updateRelationship)="updateRelationship($event)" [isEditMode]="isEditMode"
                (positionsToView)="scrollPosition($event)" [isSwitchCurrentTab]="isSwitchCurrentTab">
            </app-entity-questionnaire>
        </div>
    </div>
    <ng-container *ngIf="!entityDetailsServices.definedRelationships?.length">
        <div class="card mx-4">
          <div class="border pi-info-text p-3 mx-4 mt-4 rounded-1">
            <p class="fs-14 m-0">
              <span title="Expand Policy Text" aria-describedby="Expand Policy Text">
                You currently do not have any relationship questionnaires associated with this SFI. Click on the <strong>Add Relationship</strong>
                button for adding questionnaires.
              </span>
            </p>
          </div>
          <span *ngIf="isEditMode && entityDetailsServices.canMangeSfi && entityDetailsServices.availableRelationships?.length" class="create-button">
            <button class="btn btn-primary btn-sm d-flex align-items-center mt-4 fs-15 mb-3 hand-cursor" (click)="saveOrAddRelationshipModal()"
            title="Add Relationship">
                <mat-icon class="material-icons-outlined mr-2">add</mat-icon>
                <span class="mr-2 fs-15">Add Relationship</span>
            </button>
        </span>
        </div>
      </ng-container>
</div>

<div class="d-flex mx-0 px-4" *ngIf="entityDetailsServices.selectedTab === 'RELATIONSHIP_DETAILS'">
    <div class="col">
        <div *ngIf="!isEditMode" class="card mb-3 shadow-medium"
            (mouseout)="entityDetailsServices.isHoverEntityCard = false">
            <div class="row d-flex px-4 mb-3 mt-4">
                <div class="col-3" tabindex="0">
                    <label class="d-block pb-1 label-text">Relationship Type</label>
                    <app-no-data-label [classesToApply]="'fs-14'" [valueToShow]="personEntityRelationships.length>0">
                        <span class="text-color  fs-14">{{'Financial'}}</span>
                    </app-no-data-label>
                </div>
                <div class="col-3" tabindex="0">
                    <label class="d-block fw-500 fs-14 pb-1 label-text">Sponsors Research</label>
                    <span class="text-color fs-14">{{relationshipsDetails?.sponsorsResearch?'Yes':'No'}}</span>
                </div>
                <div class="col-3" tabindex="0">
                    <label class="d-block fw-500 fs-14 pb-1 label-text" aria-label="Start Date Of Involvement">Start Date Of Involvement</label>
                    <app-no-data-label [classesToApply]="'fs-14'"
                        [valueToShow]="involvementDate.involvementStartDate">
                        <span class="text-color fs-14" aria-label="involvementDate.involvementStartDate | dateFormatterWithTimeZone">
                            {{involvementDate.involvementStartDate | dateFormatterWithTimeZone}}</span>
                    </app-no-data-label>
                </div>
                <div class="col-3" tabindex="0">
                    <label class="d-block fw-500 fs-14 pb-1 label-text">End Date Of Involvement</label>
                    <app-no-data-label [classesToApply]="'fs-14'"
                        [valueToShow]="involvementDate.involvementEndDate">
                        <span class="text-color fs-14">{{involvementDate.involvementEndDate |
                            dateFormatterWithTimeZone}}</span>
                    </app-no-data-label>
                </div>
            </div>
            <div class="row d-flex px-4 mb-3 mt-4">
                <div class="col-12" tabindex="0">
                    <label class="d-block fw-500 fs-14 pb-1 label-text">Relationship With Entity</label>
                    <app-no-data-label [classesToApply]="'fs-14'"
                        [valueToShow]="relationshipsDetails?.staffInvolvement">
                        <span *ngIf="!isReadMoreRelationWith;else more1"
                            class="text-color fs-14">{{(relationshipsDetails?.staffInvolvement?.length>145)?(relationshipsDetails?.staffInvolvement|slice:0:142)
                            :relationshipsDetails?.staffInvolvement}}
                            <span *ngIf="relationshipsDetails?.staffInvolvement?.length>145">...<span
                                    class="collapse-text fw-medium"
                                    (click)="isReadMoreRelationWith =!isReadMoreRelationWith">Read
                                    more</span></span>
                        </span>
                        <ng-template #more1>
                            <span class="text-color text-break fs-14">{{ relationshipsDetails?.staffInvolvement}}
                            </span><span (click)="isReadMoreRelationWith =!isReadMoreRelationWith"
                                class="collapse-text fw-medium fs-14">Read Less</span>
                        </ng-template>
                    </app-no-data-label>
                </div>
            </div>
            <div class="row d-flex px-4 mb-3 mt-4">
                <div class="col-12" tabindex="0">
                    <label class="d-block fw-500 fs-14 pb-1 label-text">Principal Business Area Of Entity</label>
                    <app-no-data-label [classesToApply]="'fs-14'"
                        [valueToShow]="relationshipsDetails?.studentInvolvement">
                        <span *ngIf="!isReadMoreBusinessArea;else more2" class="text-color fs-14">
                            {{(relationshipsDetails?.studentInvolvement?.length>145)?(relationshipsDetails?.studentInvolvement|slice:0:142)
                            :relationshipsDetails?.studentInvolvement}}
                            <span *ngIf="relationshipsDetails?.studentInvolvement?.length>145">...<span
                                    class="collapse-text fw-medium"
                                    (click)="isReadMoreBusinessArea = !isReadMoreBusinessArea">Read
                                    more</span></span>
                        </span>
                        <ng-template #more2>
                            <span class="text-color text-break fs-14">{{relationshipsDetails?.studentInvolvement}}
                            </span><span (click)="isReadMoreBusinessArea = !isReadMoreBusinessArea"
                                class="collapse-text fs-14 fw-medium">Read Less</span>
                        </ng-template>
                    </app-no-data-label>
                </div>
            </div>
            <div class="row d-flex px-4 mt-3 mb-15">
                <div class="col-12" tabindex="0">
                    <label class="d-block fw-500 fs-14 pb-1 label-text">Relationship Of Entity To Your University
                        Responsibilities</label>
                    <app-no-data-label [classesToApply]="'fs-14'"
                        [valueToShow]="relationshipsDetails?.instituteResourceInvolvement">
                        <span *ngIf="!isReadMoreUniversity;else more3"
                            class="text-color fs-14">{{(relationshipsDetails?.instituteResourceInvolvement?.length>145)?(relationshipsDetails?.instituteResourceInvolvement|slice:0:142)
                            :relationshipsDetails?.instituteResourceInvolvement}}
                            <span *ngIf="relationshipsDetails?.instituteResourceInvolvement?.length>145">...<span
                                    class="collapse-text fw-medium"
                                    (click)="isReadMoreUniversity =!isReadMoreUniversity">Read
                                    more</span></span>
                        </span>
                        <ng-template #more3>
                            <span class="text-color text-break fs-14">{{
                                relationshipsDetails?.studentInvolvement}}
                            </span><span (click)="isReadMoreUniversity =!isReadMoreUniversity"
                                class="collapse-text fs-14 fw-medium">Read Less</span>
                        </ng-template>
                    </app-no-data-label>
                </div>
            </div>
        </div>
        <div *ngIf="isEditMode" class="card mb-3 shadow-medium" tabindex="-1"
            (mouseout)="entityDetailsServices.isHoverEntityCard = false">
            <div class="card-body px-0 pt-2">
                <div class="row d-flex px-4 mb-3 mt-4">
                    <div class="col" tabindex="0">
                        <div class="d-flex">
                            <label class="d-block fw-500 fs-14 row pb-1 label-text" title="Click to select date"
                                for="Start date of involvement"><span class="mandatory">*</span>Start Date of
                                Involvement
                            </label>
                        </div>
                        <div>
                            <span class="dateField w-100" [attr.aria-label]="involvementDate.involvementStartDate">
                                <input matInput [matDatepicker]="startDate" id="start-date-involvement"
                                    placeholder="{{datePlaceHolder}}" (click)="startDate.open()" autocomplete="off"
                                    class="d-inline-block form-control w-100"
                                    [(ngModel)]="involvementDate.involvementStartDate"
                                    (keypress)="commonService._keyPress($event, 'date')"
                                    (ngModelChange)="addUnSavedChanges();endDateValidation()"
                                    [ngClass]="(mandatoryList?.has('date')) ? 'is-invalid d-block' : ''" />
                                <i (click)="startDate.open()" [class.date-field-error]="mandatoryList?.has('date')"
                                    class="fa fa-calendar fa-large insidePicker hand-cursor"
                                    title="Click to select date"></i>
                                <mat-datepicker #startDate>
                                </mat-datepicker>
                            </span>
                            <div *ngIf="mandatoryList?.has('date')" class="invalid-feedback d-block fs-13">
                                {{mandatoryList?.get('date')}}
                            </div>
                        </div>
                    </div>
                    <div class="col px-5" tabindex="0">
                        <label class="d-block fs-14 fw-500 px-1 pb-1 label-text" title="Click to select Start date"
                            for="End date of involvement">End Date of Involvement
                        </label>
                        <div>
                            <span class="dateField" [attr.aria-label]="involvementDate.involvementEndDate">
                                <input matInput [matDatepicker]="endDate" id="end-date-involvement"
                                    placeholder="{{datePlaceHolder}}" (click)="endDate.open()" autocomplete="off"
                                    class="d-inline-block form-control w-100"
                                    [(ngModel)]="involvementDate.involvementEndDate"
                                    (ngModelChange)="endDateValidation(); addUnSavedChanges();"
                                    [ngClass]="(mandatoryList?.has('endDate')) ? 'is-invalid d-block' : ''"
                                    (keypress)="commonService._keyPress($event, 'date')" />
                                <i (click)="endDate.open()" [class.date-field-error]="mandatoryList?.has('endDate')"
                                class="fa fa-calendar fa-large insidePicker hand-cursor"
                                    title="Click to select end date"></i>
                                <mat-datepicker #endDate>
                                </mat-datepicker>
                            </span>
                            <div *ngIf="(mandatoryList.get('endDate'))" class="fs-13 invalid-feedback d-block">
                                {{mandatoryList.get('endDate')}}
                            </div>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="d-flex px-3" tabindex="0">
                            <label class="d-block fs-14 fw-500 px-1 pb-1 row label-text">Sponsors Research</label>
                        </div>
                        <div class="col d-flex px-2" title="Click to toggle Yes/No" tabindex="0">
                            <span class="py-1" role="switch">
                                <a *ngIf="additionalDetails.sponsorsResearch" class="pl-2">
                                    <label class="switch"
                                        (click)="additionalDetails.sponsorsResearch = false;addUnSavedChanges()">
                                        <input type="checkbox" checked>
                                        <span class="slider round"><small class="fs-12 mt-1">Yes</small></span>
                                    </label>
                                </a>
                                <a *ngIf="!additionalDetails.sponsorsResearch" class="pl-2">
                                    <label class="switch"
                                        (click)="additionalDetails.sponsorsResearch = true;addUnSavedChanges()">
                                        <input type="checkbox">
                                        <span class="slider round"><small
                                                class="deactivate-text fs-12 mt-1">No</small></span>
                                    </label>
                                </a>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="row px-4 mb-3">
                    <span tabindex="0">
                        <label class="fs-14 fw-500 py-2 position-relative label-text">
                            <span class="mandatory">*</span>
                            Relationship with Entity
                        </label>
                        <textarea appAutoGrow class="form-control" id="releationship-entity" rows="1"
                            [(ngModel)]="additionalDetails.staffInvolvement"
                            (ngModelChange)="addUnSavedChanges();additionalDetails.staffInvolvement = additionalDetails.staffInvolvement.trim();"
                            [ngClass]="(mandatoryList?.has('staff')) ? 'is-invalid d-block' : ''" appLengthValidator
                            [limit]=2000 [position]="'ABOVE'" [styleList]="'mt-2 float-end word-count'">
                                      </textarea>
                        <div class="help-text">
                            This description is presented in the Relationship section to help you relate this entity
                            to your research projects. Please enter an adequate description of the organization, and
                            of your role with them,to aid both you, and a reviewers' understanding of the
                            association between the entity and work.
                        </div>
                        <div *ngIf="mandatoryList?.has('staff')" class="invalid-feedback d-block fs-13">
                            {{mandatoryList?.get('staff')}}
                        </div>
                    </span>
                </div>
                <div class="row px-4 mb-3">
                    <span tabindex="0">
                        <label class="fs-14 fw-500 py-2 position-relative label-text">
                            <span class="mandatory">*</span>
                            Principle Business Area of Entity
                        </label>
                        <textarea appAutoGrow class="form-control" id="releationship-entity" rows="1"
                            [(ngModel)]="additionalDetails.studentInvolvement"
                            (ngModelChange)="addUnSavedChanges();additionalDetails.studentInvolvement = additionalDetails.studentInvolvement.trim()"
                            [ngClass]="(mandatoryList?.has('student')) ? 'is-invalid d-block' : ''" appLengthValidator
                            [limit]=2000 [position]="'ABOVE'" [styleList]="'mt-2 float-end word-count'">
                                  </textarea>
                        <div class="help-text">
                            Please enter an adequate description of the entity's principal are of business.
                        </div>
                        <div *ngIf="mandatoryList?.has('student')" class="invalid-feedback d-block fs-13">
                            {{mandatoryList?.get('student')}}
                        </div>
                    </span>
                </div>
                <div class="row px-4 mb-3">
                    <span tabindex="0">
                        <label class="fs-14 fw-500 py-2 position-relative label-text">
                            <span class="mandatory">*</span>
                            Relationship of Entity to your
                            University responsibilities
                        </label>
                        <textarea appAutoGrow class="form-control" id="releationship-entity" rows="1"
                            [(ngModel)]="additionalDetails.instituteResourceInvolvement"
                            (ngModelChange)="isChangesInFieldValue = true;addUnSavedChanges()"
                            [ngClass]="(mandatoryList?.has('resource')) ? 'is-invalid d-block' : ''" appLengthValidator
                            [limit]=2000 [position]="'ABOVE'" [styleList]="'mt-2 float-end word-count'">
                                    </textarea>
                        <div class="help-text">
                            Please enter an adequate description of the entity's relationship to your University
                            responsibilities.
                        </div>
                        <div *ngIf="mandatoryList?.has('resource')" class="invalid-feedback d-block fs-13">
                            {{mandatoryList?.get('resource')}}
                        </div>
                    </span>
                </div>
            </div>
        </div>
    </div>

</div>

<app-sfi-history *ngIf="entityDetailsServices.selectedTab === 'HISTORY'" [entityId]="entityId"></app-sfi-history>


<app-activate-inactivate-sfi-modal *ngIf="isEnableActivateInactivateSfiModal" [entityName]="entityDetails.entityName"
    [personEntityId]="entityId" [isRelationshipActive]="isRelationshipActive"
    (closeModal)="closeActivateInactivateSfiModal($event)" [isFinalizeApi]="isFinalizeApi"
    [personEntityNumber]="relationshipsDetails.personEntityNumber">
</app-activate-inactivate-sfi-modal>

<!-- DELETE RELATIONSHIP MODAL -->
<div class="modal modal-coi modal-coi fade mySkinDialog modal-opacity" tabindex="-1" id="deleteRelationModal"
    tabindex="-1" role="dialog" aria-labelledby="deleteModalTitle" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Relationship</h5>
                <button aria-label="Close" class="btn-close fs-12" data-bs-dismiss="modal" id="dissmiss-btn"
                    type="button" (click)="deleteRelationshipDetails = null">
                </button>
            </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete <strong>{{deleteRelationshipDetails?.validPersonEntityRelType?.description}}</strong></p>
                </div>
            <div class="modal-footer">
                <button id="prop-project-close-btn" type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal"
                    data-bs-toggle="modal" (click)="deleteRelationshipDetails = null">Cancel</button>
                <button id="prop-project-team-delete-btn" type="button" class="btn btn-primary fs-14"
                    (click)="deleteRelationship()">Delete</button>
            </div>
        </div>
    </div>
</div>
