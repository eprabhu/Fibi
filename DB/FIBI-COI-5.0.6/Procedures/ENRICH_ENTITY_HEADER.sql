DELIMITER //
CREATE PROCEDURE ENRICH_ENTITY_HEADER(
	IN AV_ENTITY_ID INT,
    IN AV_PRIMARY_NAME VARCHAR(500),
    IN AV_FOREIGN_NAME VARCHAR(500),
    IN AV_PRIOR_NAME VARCHAR(200),
    IN AV_SHORT_NAME VARCHAR(200),
    IN AV_DUNS_NUMBER VARCHAR(20),
    IN AV_UEI_NUMBER VARCHAR(20),
    IN AV_CAGE_NUMBER VARCHAR(20),
    IN AV_ENTITY_OWNERSHIP_TYPE_CODE VARCHAR(10),
    IN AV_OPERATING_STATUS_TYPE_CODE VARCHAR(10),
    IN AV_BUSINESS_TYPE_CODE VARCHAR(10),
    IN AV_WEBSITE_ADDRESS VARCHAR(500),
    IN AV_START_DATE VARCHAR(10),
    IN AV_INCORPORATION_DATE VARCHAR(10),
    IN AV_NUMBER_OF_EMPLOYEES INT,
    IN AV_CERTIFIED_EMAIL VARCHAR(200),
    IN AV_ACTIVITY_TEXT VARCHAR(1000),
    IN AV_CURRENCY_CODE VARCHAR(3),
    IN AV_PHONE_NUMBER VARCHAR(15),
    IN AV_PRIMARY_ADDRESS_LINE_1 VARCHAR(500),
    IN AV_PRIMARY_ADDRESS_LINE_2 VARCHAR(500),
    IN AV_CITY VARCHAR(30),
    IN AV_STATE VARCHAR(30),
    IN AV_POST_CODE VARCHAR(15),
    IN AV_COUNTRY_CODE VARCHAR(3),
    IN AV_HUMAN_SUB_ASSURANCE VARCHAR(50),
    IN AV_ANIMAL_WELFARE_ASSURANCE VARCHAR(50),
    IN AV_ANIMAL_ACCREDITATION VARCHAR(50),
	IN AV_PERSON_ID VARCHAR(40)
)
    DETERMINISTIC
BEGIN
 
     DECLARE v_country_code VARCHAR(3);
		
        SELECT COUNTRY_CODE INTO v_country_code 
		FROM country 
		WHERE COUNTRY_CODE_ISO2 = AV_COUNTRY_CODE;
	 
        UPDATE entity 
        SET PRIMARY_NAME = AV_PRIMARY_NAME,
            FOREIGN_NAME = AV_FOREIGN_NAME,
            PRIOR_NAME = AV_PRIOR_NAME,
            SHORT_NAME = AV_SHORT_NAME,
            DUNS_NUMBER = AV_DUNS_NUMBER,
            UEI_NUMBER = AV_UEI_NUMBER,
            CAGE_NUMBER = AV_CAGE_NUMBER,
            ENTITY_OWNERSHIP_TYPE_CODE = AV_ENTITY_OWNERSHIP_TYPE_CODE,
            OPERATING_STATUS_TYPE_CODE = AV_OPERATING_STATUS_TYPE_CODE,
            BUSINESS_TYPE_CODE = AV_BUSINESS_TYPE_CODE,
            WEBSITE_ADDRESS = AV_WEBSITE_ADDRESS,
            START_DATE = AV_START_DATE,
            INCORPORATION_DATE = AV_INCORPORATION_DATE,
            NUMBER_OF_EMPLOYEES = AV_NUMBER_OF_EMPLOYEES,
            CERTIFIED_EMAIL = AV_CERTIFIED_EMAIL,
            ACTIVITY_TEXT = AV_ACTIVITY_TEXT,
            CURRENCY_CODE = AV_CURRENCY_CODE,
            PHONE_NUMBER = AV_PHONE_NUMBER,
            PRIMARY_ADDRESS_LINE_1 = AV_PRIMARY_ADDRESS_LINE_1,
            PRIMARY_ADDRESS_LINE_2 = AV_PRIMARY_ADDRESS_LINE_2,
            CITY = AV_CITY,
            STATE = AV_STATE,
            POST_CODE = AV_POST_CODE,
            COUNTRY_CODE = v_country_code,
            HUMAN_SUB_ASSURANCE = AV_HUMAN_SUB_ASSURANCE,
            ANIMAL_WELFARE_ASSURANCE = AV_ANIMAL_WELFARE_ASSURANCE,
            ANIMAL_ACCREDITATION = AV_ANIMAL_ACCREDITATION,
			UPDATED_BY = AV_PERSON_ID,
            UPDATE_TIMESTAMP = NOW(),
            IS_DUNS_MATCHED = 'Y'
        WHERE ENTITY_ID = AV_ENTITY_ID;
END
//