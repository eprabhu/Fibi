DELIMITER //
CREATE FUNCTION FN_INT_CAN_MARK_DISCL_VOID(
AV_PROPOSAL_NUMBER  VARCHAR(20),
AV_PERSON_ID VARCHAR(40),
AV_QUESTIONNAIRE_ID INT

) RETURNS TINYINT
    DETERMINISTIC
BEGIN

DECLARE LS_COUNT INT;

SELECT COUNT(*) INTO LS_COUNT 
FROM COI_INT_STAGE_DEV_QNR_ANSWER T1
INNER JOIN FIBI_COI_QNR_QSTN_MAPPING T2 ON T2.SOURCE_QSTN_ID = T1.QUESTION_ID
WHERE PROPOSAL_NUMBER = AV_PROPOSAL_NUMBER
AND KEY_PERSON_ID = AV_PERSON_ID
AND QUESTIONNAIRE_ID = AV_QUESTIONNAIRE_ID
AND QUESTION_ID IN (1005,1006,1007) -- hardcoded question Ids 
AND UPPER(ANSWER) = 'NO'; 

IF LS_COUNT = 0 THEN

	RETURN 0;

END IF;

RETURN 1;


END
//
